!function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=219)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2f=e.Matrix4f=e.Matrix3f=e.Vector3f=e.Vector4f=void 0;var r=i(4);Object.defineProperty(e,"Vector4f",{enumerable:!0,get:function(){return r.Vector4f}});var o=i(1);Object.defineProperty(e,"Vector3f",{enumerable:!0,get:function(){return o.Vector3f}});var n=i(31);Object.defineProperty(e,"Matrix3f",{enumerable:!0,get:function(){return n.Matrix3f}});var s=i(20);Object.defineProperty(e,"Matrix4f",{enumerable:!0,get:function(){return s.Matrix4f}});var a=i(26);Object.defineProperty(e,"Vector2f",{enumerable:!0,get:function(){return a.Vector2f}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3f=void 0;class r{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}mult(t){return new r(this.x*t,this.y*t,this.z*t)}sub(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}sub2(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}mul(t){return new r(this.x*t,this.y*t,this.z*t)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}add2(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}cross(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}cross2(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){const t=1/this.length();return this.mul(t)}normalize2(){const t=1/this.length();this.x*=t,this.y*=t,this.z*=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}}e.Vector3f=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Framebuffer=void 0;const r=i(29),o=i(7),n=i(8),s=i(24),a=i(0),h=i(11),l=i(32),c=i(33),u=i(13),f=i(21),d=i(30),m=i(16),p=i(40),x=i(15),M=i(14),w=i(17),g=i(9),b=i(3);class y{constructor(t,e){this.cullMode=n.CullFace.BACK,this.triangleRasterizer=new h.FlatShadingTriangleRasterizer(this),this.texturedTriangleRasterizer=new u.TexturedTriangleRasterizer(this),this.scaleClipBlitter=new r.ScaleClipBlitter(this),this.renderingPipeline=new f.FlatShadingRenderingPipeline(this),this.texturedRenderingPipeline=new d.TexturingRenderingPipeline(this),this.lineRasterizer=new l.LineRasterizerDda(this),this.lineRasterizerNo=new c.LineRasterizerNoZ(this),this.lensFlareVisible=!1,this.lensFlareStart=0,this.lensFlareEnd=0,this.torus=new s.Torus,this.linerClipper=new p.CohenSutherlandLineClipper(this),this.width=t,this.height=e,this.imageData=new ImageData(t,e),this.wBuffer=new Float32Array(t*e);const i=new ArrayBuffer(this.width*this.height*y.PIXEL_SIZE_IN_BYTES);this.unsignedIntArray=new Uint8ClampedArray(i),this.framebuffer=new Uint32Array(i),this.tmpGlitch=new Uint32Array(t*e),y.minWindow=new a.Vector2f(0,0),y.maxWindow=new a.Vector2f(t-1,e-1)}setCullFace(t){this.cullMode=t}setTexture(t){this.bob=t}precompute(){}getImageData(){return this.imageData.data.set(this.unsignedIntArray),this.imageData}clear(){const t=o.Color.BLACK.toPackedFormat(),e=this.width*this.height;for(let i=0;i<e;i++)this.framebuffer[i]=t}clearColorBuffer(t){this.framebuffer.fill(t)}drawPixel(t,e,i){this.framebuffer[t+e*this.width]=i}drawPixel4(t,e,i,r){const o=t+e*this.width,n=1-r,s=(this.framebuffer[o]>>0&255)*n+(i>>0&255)*r|0,a=(this.framebuffer[o]>>8&255)*n+(i>>8&255)*r|0,h=(this.framebuffer[o]>>16&255)*n+(i>>16&255)*r|0;this.framebuffer[t+e*this.width]=s|a<<8|h<<16|255<<24}drawPixel3(t,e,i,r){const o=t+e*this.width,n=(i>>24&255)/255*r,s=1-n,a=(this.framebuffer[o]>>0&255)*s+(i>>0&255)*n|0,h=(this.framebuffer[o]>>8&255)*s+(i>>8&255)*n|0,l=(this.framebuffer[o]>>16&255)*s+(i>>16&255)*n|0;this.framebuffer[o]=a|h<<8|l<<16|255<<24}readPixel(t,e){return this.framebuffer[t+e*this.width]}drawRect(t,e,i,r){let o=t+e*this.width;for(let t=0;t<i;t++)this.framebuffer[o++]=r}drawRect2(t,e,i,r,o){let n=t+e*this.width;for(let t=0;t<r;t++){for(let t=0;t<i;t++)this.framebuffer[n++]=o;n+=this.width-i}}drawText(t,e,i,r){let o=t;const n=" ".charCodeAt(0);for(let t=0;t<i.length;t++){const s=i.charCodeAt(t)-n,a=8*Math.floor(s%32),h=8*Math.floor(s/32);this.drawTextureRectFastAlpha(o,e,a,h,8,8,r),o+=8}}addReflections(){for(let t=0;t<50;t++)for(let e=0;e<this.width;e++)this.framebuffer[(150+t)*this.width+e]=this.framebuffer[(150-3*t-1)*this.width+e+this.interpolate(0,50,t)*(10*Math.sin(.002*Date.now()+.2*t))|0]}drawTextureRect2(t,e,i,r,o,n,s,a){for(let h=0;h<o;h++)for(let o=0;o<n;o++){const n=i+h+(r+o)*s.width,l=t+h+(e+o)*this.width,c=(s.texture[n]>>24&255)/255*a,u=1-c,f=(this.framebuffer[l]>>0&255)*u+(s.texture[n]>>0&255)*c|0,d=(this.framebuffer[l]>>8&255)*u+(s.texture[n]>>8&255)*c|0,m=(this.framebuffer[l]>>16&255)*u+(s.texture[n]>>16&255)*c|0;this.framebuffer[l]=f|d<<8|m<<16|255<<24}}drawTextureRectFastAlpha(t,e,i,r,o,n,s){let a=i+r*s.width,h=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<o;t++){const t=s.texture[a];4278190080&t&&(this.framebuffer[h]=t),a++,h++}a+=s.width-o,h+=this.width-o}}drawTextureRectNoAlpha(t,e,i,r,o,n,s){let a=i+r*s.width,h=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<o;t++)this.framebuffer[h]=s.texture[a],a++,h++;a+=s.width-o,h+=this.width-o}}blend(t,e,i){if(0===i)return t;if(255===i)return e;const r=255-i;return 4278190080|((16711680&e)>>16)*i+((16711680&t)>>16)*r>>8<<16|((65280&e)>>8)*i+((65280&t)>>8)*r>>8<<8|(255&e)*i+(255&t)*r>>8}drawTextureRect(t,e,i,r,o,n,s,a){let h=i+r*s.width,l=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<o;t++){const t=(s.texture[h]>>24&255)/255*a,e=1-t,i=this.framebuffer[l],r=s.texture[h],o=(i>>0&255)*e+(r>>0&255)*t,n=(i>>8&255)*e+(r>>8&255)*t,c=(i>>16&255)*e+(r>>16&255)*t;this.framebuffer[l]=o|n<<8|c<<16|255<<24,h++,l++}h+=s.width-o,l+=this.width-o}}drawTextureRectAdd(t,e,i,r,o,n,s,a){let h=i+r*s.width,l=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<o;t++){const t=(s.texture[h]>>24&255)/255*a,e=this.framebuffer[l],i=s.texture[h],r=Math.min(255,(e>>0&255)+(i>>0&255)*t),o=Math.min(255,(e>>8&255)+(i>>8&255)*t),n=Math.min(255,(e>>16&255)+(i>>16&255)*t);this.framebuffer[l]=r|o<<8|n<<16|255<<24,h++,l++}h+=s.width-o,l+=this.width-o}}pixelate(){for(let t=0;t<10;t++)for(let e=0;e<10;e++)this.drawBox2(10*t+20,10*e+50,10,10,this.readPixel(10*t+20,10*e+50));this.drawLineDDA(new a.Vector3f(20,50,-.3),new a.Vector3f(120,50,-.3),4294967295),this.drawLineDDA(new a.Vector3f(20,150,-.3),new a.Vector3f(120,150,-.3),4294967295),this.drawLineDDA(new a.Vector3f(20,50,-.3),new a.Vector3f(20,150,-.3),4294967295),this.drawLineDDA(new a.Vector3f(120,50,-.3),new a.Vector3f(120,150,-.3),4294967295)}interpolate(t,e,i){return i<=t?0:i>=e?1:(i-t)/(e-t)}fastFramebufferCopyOffset(t,e,i=0){let r=this.width*this.height/32+1,o=this.width*this.height,n=this.width*(this.height-i);for(;--r;)t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n],t[--o]=e[--n]}fastFramebufferCopy(t,e){t.set(e)}drawPolarDistotion2(t,e){let i=0;const r=1.355*(.4+.3*(1+Math.sin(17e-5*t)));for(let t=0;t<this.height;t++)for(let o=0;o<this.width;o++){const n=o-this.width/2,s=t-this.height/2,a=Math.sqrt(n*n+s*s)*r,h=Math.atan2(n,s)/(2*Math.PI)*256,l=e.texture[(255&a)+256*(255&h)];this.framebuffer[i++]=l}}drawPolarDistotion3(t,e){let i=0;for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++){const n=o-this.width/2,s=r-this.height/2,a=.8*Math.sqrt(n*n+s*s)-.017*t,h=Math.atan2(n,s)/(2*Math.PI)*256+.017*t,l=e.texture[(255&a)+256*(255&h)];this.framebuffer[i++]=l}}noise(t,e,i=.07){for(let t=0;t<this.height;t++)this.drawTextureRect(0,t,Math.floor(Math.random()*(e.texture.length-this.width)),0,this.width,1,e,i)}drawTexturedBillboard(t,e,i,r,o,n){const s=o.width/i,a=o.height/r;let h,l,c,u,f,d=0,m=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(m=a*-e,h=r+e-Math.max(e+r-this.height,0),c=0):(c=e,h=r-Math.max(e+r-this.height,0)),t<0?(f=d=s*-t,l=i+t-Math.max(t+i-this.width,0),u=0):(f=0,u=t,l=i-Math.max(t+i-this.width,0));let p=u+c*this.width;for(let t=0;t<h;t++){for(let t=0;t<l;t++){if(this.wBuffer[p]>n){this.wBuffer[p]=n;const t=Math.min(0|d,o.width-1)+Math.min(0|m,o.height-1)*o.width,e=(this.framebuffer[p]>>0&255)+(o.texture[t]>>0&255),i=(this.framebuffer[p]>>8&255)+(o.texture[t]>>8&255),r=(this.framebuffer[p]>>16&255)+(o.texture[t]>>16&255);this.framebuffer[p]=e|i<<8|r<<16|255<<24}d+=a,p++}m+=a,d=f,p+=-l+this.width}}drawParticle(t,e,i,r,o,n,s){const a=o.width/i,h=o.height/r;let l,c,u,f,d,m=0,p=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=h*-e,l=r+e-Math.max(e+r-this.height,0),u=0):(u=e,l=r-Math.max(e+r-this.height,0)),t<0?(d=m=a*-t,c=i+t-Math.max(t+i-this.width,0),f=0):(d=0,f=t,c=i-Math.max(t+i-this.width,0));const x=1/255*s;let M=f+u*this.width;for(let t=0;t<l;t++){for(let t=0;t<c;t++){if(this.wBuffer[M]>n){const t=Math.min(0|m,o.width-1)+Math.min(0|p,o.height-1)*o.width,e=(o.texture[t]>>24&255)*x,i=1-e,r=this.framebuffer[M],n=o.texture[t],s=(r>>0&255)*i+(n>>0&255)*e,a=(r>>8&255)*i+(n>>8&255)*e,h=(r>>16&255)*i+(n>>16&255)*e;this.framebuffer[M]=s|a<<8|h<<16|255<<24}m+=a,M++}p+=h,m=d,M+=-c+this.width}}drawParticle2(t,e,i,r,o,n,s,a=0,h){const l=o.width/i,c=h/r;let u,f,d,m,p,x=0,M=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(M=c*-e,u=r+e-Math.max(e+r-this.height,0),d=0):(d=e,u=r-Math.max(e+r-this.height,0)),t<0?(p=x=l*-t,f=i+t-Math.max(t+i-this.width,0),m=0):(p=0,m=t,f=i-Math.max(t+i-this.width,0));const w=1/255*s;let g=m+d*this.width;for(let t=0;t<u;t++){for(let t=0;t<f;t++){if(this.wBuffer[g]>n){const t=Math.min(0|x,o.width-1)+Math.min(0|M,h-1)*o.width+h*o.width*a,e=(o.texture[t]>>24&255)*w,i=1-e,r=this.framebuffer[g],n=o.texture[t],s=(r>>0&255)*i+(n>>0&255)*e,l=(r>>8&255)*i+(n>>8&255)*e,c=(r>>16&255)*i+(n>>16&255)*e;this.framebuffer[g]=s|l<<8|c<<16|255<<24}x+=l,g++}M+=c,x=p,g+=-f+this.width}}drawParticle2Sub(t,e,i,r,o,n,s,a=0,h){const l=o.width/i,c=h/r;let u,f,d,m,p,x=0,M=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(M=c*-e,u=r+e-Math.max(e+r-(this.height-1),0),d=0):(d=e,u=r-Math.max(e+r-(this.height-1),0)),t<0?(p=x=l*-t,f=Math.ceil(i+t-Math.max(t+i-(this.width-1),0)),m=0):(p=0,m=t,f=Math.ceil(i-Math.max(t+i-(this.width-1),0))),p+=(Math.ceil(t)-t)*l,M+=(Math.ceil(e)-e)*c;const w=1/255*s;let g=Math.ceil(m)+Math.ceil(d)*this.width;for(let t=0;t<u;t++){for(let t=0;t<f;t++){if(this.wBuffer[g]>n){const t=Math.min(0|Math.round(x),o.width-1)+Math.min(0|Math.round(M),h-1)*o.width+h*o.width*a,e=(o.texture[t]>>24&255)*w,i=1-e,r=this.framebuffer[g],n=o.texture[t],s=(r>>0&255)*i+(n>>0&255)*e,l=(r>>8&255)*i+(n>>8&255)*e,c=(r>>16&255)*i+(n>>16&255)*e;this.framebuffer[g]=s|l<<8|c<<16|255<<24}x+=l,g++}M+=c,x=p,g+=-f+this.width}}drawParticleNoDepth(t,e,i,r,o,n){const s=o.width/i,a=o.height/r;let h,l,c,u,f,d=0,m=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(m=a*-e,h=r+e-Math.max(e+r-this.height,0),c=0):(c=e,h=r-Math.max(e+r-this.height,0)),t<0?(f=d=s*-t,l=i+t-Math.max(t+i-this.width,0),u=0):(f=0,u=t,l=i-Math.max(t+i-this.width,0));const p=1/255*n;let x=u+c*this.width;for(let t=0;t<h;t++){for(let t=0;t<l;t++){const t=Math.min(0|d,o.width-1)+Math.min(0|m,o.height-1)*o.width,e=(o.texture[t]>>24&255)*p,i=1-e,r=this.framebuffer[x],n=o.texture[t],a=(r>>0&255)*i+(n>>0&255)*e,h=(r>>8&255)*i+(n>>8&255)*e,l=(r>>16&255)*i+(n>>16&255)*e;this.framebuffer[x]=a|h<<8|l<<16|255<<24,d+=s,x++}m+=a,d=f,x+=-l+this.width}}drawSoftParticle(t,e,i,r,o,n,s){const a=o.width/i,h=o.height/r;let l,c,u,f,d,m=0,p=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=h*-e,l=r+e-Math.max(e+r-this.height,0),u=0):(u=e,l=r-Math.max(e+r-this.height,0)),t<0?(d=m=a*-t,c=i+t-Math.max(t+i-this.width,0),f=0):(d=0,f=t,c=i-Math.max(t+i-this.width,0));const x=1/255*s;let M=f+u*this.width;for(let t=0;t<l;t++){for(let t=0;t<c;t++){if(this.wBuffer[M]>n){const t=Math.min(Math.max(1/n-1/this.wBuffer[M],0),1),e=Math.min(0|m,o.width-1)+Math.min(0|p,o.height-1)*o.width,i=(o.texture[e]>>24&255)*x*t,r=1-i,s=(this.framebuffer[M]>>0&255)*r+(o.texture[e]>>0&255)*i,a=(this.framebuffer[M]>>8&255)*r+(o.texture[e]>>8&255)*i,h=(this.framebuffer[M]>>16&255)*r+(o.texture[e]>>16&255)*i;this.framebuffer[M]=s|a<<8|h<<16|255<<24}m+=a,M++}p+=h,m=d,M+=-c+this.width}}drawFog(t,e,i){const r=this.width*this.height,o=-e;for(let e=0;e<r;e++){const r=Math.max(Math.min(o*(1/this.wBuffer[e]+i),1),0),n=1-r,s=(this.framebuffer[e]>>0&255)*n+t.r*r,a=(this.framebuffer[e]>>8&255)*n+t.g*r,h=(this.framebuffer[e]>>16&255)*n+t.b*r;this.framebuffer[e]=s|a<<8|h<<16|255<<24}}drawRadialBlur(){this.fastFramebufferCopy(this.tmpGlitch,this.framebuffer);const t=new g.Texture;t.texture=this.tmpGlitch,t.width=this.width,t.height=this.height;let e=this.width,i=this.height;for(let r=0;r<16;r++)e+=.09*this.width,i+=.09*this.height,this.scaleClipBlitter.drawScaledTextureClip(this.width/2-e/2,this.height/2-i/2,e,i,t,.19*(15-r)/15),this.fastFramebufferCopy(this.tmpGlitch,this.framebuffer)}drawScaledTextureClipBi(t,e,i,r,o,n){const s=o.width/i,a=o.height/r;let h,l,c,u,f,d=0,m=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(m=a*-e,h=r+e-Math.max(e+r-this.height,0),c=0):(c=e,h=r-Math.max(e+r-this.height,0)),t<0?(f=d=s*-t,l=i+t-Math.max(t+i-this.width,0),u=0):(f=0,u=t,l=i-Math.max(t+i-this.width,0));const p=1/255*n;let x=u+c*this.width;for(let t=0;t<h;t++){for(let t=0;t<l;t++){const t=o.getBilinearFilteredPixel2(d,m),e=255*p,i=1-e,r=this.framebuffer[x],n=(r>>0&255)*i+(t>>0&255)*e,a=(r>>8&255)*i+(t>>8&255)*e,h=(r>>16&255)*i+(t>>16&255)*e;this.framebuffer[x]=n|a<<8|h<<16|255<<24,d+=s,x++}m+=a,d=f,x+=-l+this.width}}drawScaledTextureClipBiAdd(t,e,i,r,o,n){const s=o.width/i,a=o.height/r;let h,l,c,u,f,d=0,m=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(m=a*-e,h=r+e-Math.max(e+r-this.height,0),c=0):(c=e,h=r-Math.max(e+r-this.height,0)),t<0?(f=d=s*-t,l=i+t-Math.max(t+i-this.width,0),u=0):(f=0,u=t,l=i-Math.max(t+i-this.width,0));let p=u+c*this.width;for(let t=0;t<h;t++){for(let t=0;t<l;t++){const t=o.getBilinearFilteredPixel2(d,m),e=this.framebuffer[p],i=t,r=Math.min((e>>0&255)+(i>>0&255)*n,255),a=Math.min((e>>8&255)+(i>>8&255)*n,255),h=Math.min((e>>16&255)+(i>>16&255)*n,255);this.framebuffer[p]=r|a<<8|h<<16|255<<24,d+=s,p++}m+=a,d=f,p+=-l+this.width}}drawScaledTextureClipAdd(t,e,i,r,o,n=1){const s=o.width/i,a=o.height/r;let h,l,c,u,f,d=0,m=0;if(e+r<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(m=a*-e,h=r+e-Math.max(e+r-this.height,0),c=0):(c=e,h=r-Math.max(e+r-this.height,0)),t<0?(f=d=s*-t,l=i+t-Math.max(t+i-this.width,0),u=0):(f=0,u=t,l=i-Math.max(t+i-this.width,0));let p=u+c*this.width;for(let t=0;t<h;t++){for(let t=0;t<l;t++){const t=Math.min(0|d,o.width-1)+Math.min(0|m,o.height-1)*o.width,e=this.framebuffer[p],i=o.texture[t],r=Math.min((e>>0&255)+(i>>0&255)*n,255),a=Math.min((e>>8&255)+(i>>8&255)*n,255),h=Math.min((e>>16&255)+(i>>16&255)*n,255);this.framebuffer[p]=r|a<<8|h<<16|255<<24,d+=s,p++}m+=a,d=f,p+=-l+this.width}}drawTexture(t,e,i,r){const o=this.width,n=this.height;let s=Math.max(t,0)+Math.max(e,0)*this.width,a=Math.max(0,0-t)+Math.max(0,0-e)*i.width;const h=Math.min(i.width,o-t)-Math.max(0,0-t),l=Math.min(i.height,n-e)-Math.max(0,0-e),c=i.width-h,u=this.width-h,f=1/255*r;for(let t=0;t<l;t++){for(let t=0;t<h;t++){const t=(i.texture[a]>>24&255)*f,e=1-t,r=(this.framebuffer[s]>>0&255)*e+(i.texture[a]>>0&255)*t,o=(this.framebuffer[s]>>8&255)*e+(i.texture[a]>>8&255)*t,n=(this.framebuffer[s]>>16&255)*e+(i.texture[a]>>16&255)*t;this.framebuffer[s]=r|o<<8|n<<16|255<<24,s++,a++}a+=c,s+=u}}drawTextureFullscreen(t,e){let i=0;const r=1-e;for(let o=0;o<this.width*this.height;o++){const o=(this.framebuffer[i]>>0&255)*r+(t.texture[i]>>0&255)*e,n=(this.framebuffer[i]>>8&255)*r+(t.texture[i]>>8&255)*e,s=(this.framebuffer[i]>>16&255)*r+(t.texture[i]>>16&255)*e;this.framebuffer[i]=o|n<<8|s<<16|255<<24,i++}}drawTexture3(t,e,i,r,o){const n=this.width,s=this.height;let a=Math.max(t,0)+Math.max(e,0)*this.width,h=Math.max(0,0-t)+Math.max(0,0-e)*i.width;const l=Math.min(i.width,n-t)-Math.max(0,0-t),c=Math.min(i.height,s-e)-Math.max(0,0-e),u=i.width-l,f=this.width-l,d=1/255*r,m=Math.floor(c*Math.max(Math.min(1,o),0));for(let t=0;t<m;t++){for(let t=0;t<l;t++){const t=(i.texture[h]>>24&255)*d,e=1-t,r=(this.framebuffer[a]>>0&255)*e+(i.texture[h]>>0&255)*t,o=(this.framebuffer[a]>>8&255)*e+(i.texture[h]>>8&255)*t,n=(this.framebuffer[a]>>16&255)*e+(i.texture[h]>>16&255)*t;this.framebuffer[a]=r|o<<8|n<<16|255<<24,a++,h++}h+=u,a+=f}}drawTextureNoClipAlpha(t,e,i){let r=t+e*this.width,o=0;const n=this.width-i.width;for(let t=0;t<i.height;t++){for(let t=0;t<i.width;t++){const t=i.texture[o];4278190080&t&&(this.framebuffer[r]=t),r++,o++}r+=n}}scene8(t){const e=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4],i=[new a.Vector3f(1,1,-1),new a.Vector3f(-1,1,-1),new a.Vector3f(-1,1,1),new a.Vector3f(1,1,1),new a.Vector3f(1,-1,1),new a.Vector3f(-1,-1,1),new a.Vector3f(-1,-1,-1),new a.Vector3f(1,-1,-1)];let r=a.Matrix3f.constructScaleMatrix(.8,.8,.8).multiplyMatrix(a.Matrix3f.constructYRotationMatrix(.05*t));r=r.multiplyMatrix(a.Matrix3f.constructXRotationMatrix(.05*t));const o=new Array;i.forEach(e=>{const i=r.multiply(e),n=i.x,s=i.y,h=i.z-4+2*Math.sin(.09*t);o.push(new a.Vector3f(n,s,h))});for(let t=0;t<e.length;t+=2){const i=-16776961;this.nearPlaneClipping(o[e[t]],o[e[t+1]],i)}}project(t){return new a.Vector3f(Math.round(this.width/2+292*t.x/-t.z),Math.round(this.height/2-292*t.y/-t.z),t.z)}nearPlaneClipping(t,e,i){if(t.z<-1.7&&e.z<-1.7)this.linerClipper.cohenSutherlandLineClipper(this.project(t),this.project(e),i);else{if(t.z>-1.7&&e.z>-1.7)return;if(t.z<-1.7){const r=(-1.7-t.z)/(e.z-t.z),o=new a.Vector3f(r*(e.x-t.x)+t.x,r*(e.y-t.y)+t.y,-1.7);this.linerClipper.cohenSutherlandLineClipper(this.project(t),this.project(o),i)}else if(e.z<-1.7){const r=(-1.7-e.z)/(t.z-e.z),o=new a.Vector3f(r*(t.x-e.x)+e.x,r*(t.y-e.y)+e.y,-1.7);this.linerClipper.cohenSutherlandLineClipper(this.project(e),this.project(o),i)}}}clearDepthBuffer(){this.wBuffer.fill(-1/900)}drawBox(){const t=y.maxWindow.y-y.minWindow.y+1,e=y.maxWindow.x-y.minWindow.x+1;let i=y.minWindow.y*this.width+y.minWindow.x;for(let r=0;r<t;r++)this.framebuffer.fill(-13158601,i,i+e),i+=this.width}drawBox2(t,e,i,r,o){let n=e*this.width+t;for(let t=0;t<r;t++)this.framebuffer.fill(o,n,n+i),n+=this.width}wireFrameSphereClipping(t){this.wBuffer.fill(100);const e=[];for(let t=0;t<=16;t++)for(let i=0;i<16;i++)e.push(this.sphereFunction2(-t*Math.PI/16-Math.PI/2,2*-i*Math.PI/16));const i=[];for(let t=0;t<16;t++)for(let e=0;e<16;e++)i.push(16*t+(1+e)%16),i.push(16*t+(0+e)%16),i.push(16*t+16+(1+e)%16),i.push(16*t+16+(0+e)%16),i.push(16*t+16+(1+e)%16),i.push(16*t+(0+e)%16);const r=10.8+5*(Math.sin(.16*t)+1)/2;let o=a.Matrix4f.constructScaleMatrix(r,r,r).multiplyMatrix(a.Matrix4f.constructYRotationMatrix(.08*t));o=o.multiplyMatrix(a.Matrix4f.constructXRotationMatrix(.08*t)),o=a.Matrix4f.constructTranslationMatrix(0+20*Math.sin(.04*t),5*Math.sin(.06*t),-22).multiplyMatrix(o);const n=new Array;for(let t=0;t<e.length;t++){const i=o.multiplyHom(e[t]),r=i.x,s=i.y,h=i.z,l=.5*this.width+r/(.0078*-h),c=.5*this.height+s/(.0078*-h);n.push(new a.Vector3f(l,c,h))}const s=-1703936|this.height<<16|this.height;this.drawLineDDA(new a.Vector3f(y.minWindow.x-1,y.minWindow.y-1,0),new a.Vector3f(y.minWindow.x-1,y.maxWindow.y+1,0),s),this.drawLineDDA(new a.Vector3f(y.maxWindow.x+1,y.minWindow.y-1,0),new a.Vector3f(y.maxWindow.x+1,y.maxWindow.y+1,0),s),this.drawLineDDA(new a.Vector3f(y.minWindow.x-1,y.minWindow.y-1,0),new a.Vector3f(y.maxWindow.x+1,y.minWindow.y-1,0),s),this.drawLineDDA(new a.Vector3f(y.minWindow.x-1,y.maxWindow.y+1,0),new a.Vector3f(y.maxWindow.x+2,y.maxWindow.y+1,0),s),this.drawBox();for(let t=0;t<i.length;t+=3){const e=n[i[t]],r=n[i[t+1]],o=n[i[t+2]],s=-1;this.isTriangleCCW(e,r,o)&&(this.linerClipper.cohenSutherlandLineClipper(e,r,s),this.linerClipper.cohenSutherlandLineClipper(e,o,s),this.linerClipper.cohenSutherlandLineClipper(o,r,s))}}isTriangleCCW(t,e,i){const r=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*t.y-t.x*i.y;return this.cullMode===n.CullFace.BACK?r<0:r>0}drawBoundingSphere(t,e,i){const r=[];for(let e=0;e<=8;e++)for(let i=0;i<8;i++){const o=this.sphereFunction2(-e*Math.PI/8-Math.PI/2,2*-i*Math.PI/8).mul(t.getRadius()+.01).add(t.getCenter());o.w=1,r.push(o)}const o=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)o.push(8*t+(1+e)%8),o.push(8*t+(0+e)%8),o.push(8*t+8+(1+e)%8),o.push(8*t+8+(0+e)%8),o.push(8*t+8+(1+e)%8),o.push(8*t+(0+e)%8);const n=e,s=new Array;for(let t=0;t<r.length;t++){const e=n.multiplyHom(r[t]);s.push(new a.Vector3f(e.x,e.y,e.z))}for(let t=0;t<o.length;t+=3){const e=s[o[t]],r=s[o[t+1]],n=s[o[t+2]];this.nearPlaneClipping(e,r,i),this.nearPlaneClipping(e,n,i),this.nearPlaneClipping(n,r,i)}}drawPlanedeformationTunnelAnim(t,e){let i=0;for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++){const n=o-this.width/2,s=r-this.height/2,a=51.2/Math.max(1,Math.sqrt(n*n+s*s)),h=a+.002*t,l=16*(Math.atan2(n,s)/Math.PI+1)+69e-5*t,c=e.texture[(31&h)+32*(31&l)],u=1-this.cosineInterpolate(1,6,a),f=(c>>0&255)*u|(c>>8&255)*u<<8|(c>>16&255)*u<<16;this.framebuffer[i++]=f}}drawPlanedeformationTunnelV2(t,e){let i=0;for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++){const n=1.2,s=o-this.width/2+80*Math.sin(1e-4*t)*n,a=r-this.height/2+80*Math.cos(1e-4*t)*n,h=o-this.width/2+80*Math.sin(1e-4*t+Math.PI)*n,l=r-this.height/2+80*Math.cos(1e-4*t+Math.PI)*n;let c=5120/Math.max(1,Math.sqrt(s*s+a*a));c+=8*Math.sin(5*Math.atan2(s,a));let u=5120/Math.max(1,Math.sqrt(h*h+l*l));u+=8*Math.sin(5*Math.atan2(h,l));const f=c-u+.019*t;let d=128.5*(Math.atan2(s,a)/Math.PI+1)+.0069*t;d-=128.5*(Math.atan2(h,l)/Math.PI+1)+.0069*t;const m=e.texture[(255&f)+255*(255&d)],p=Math.min(60/(2*c),1)*Math.min(60/(2*u),1),x=(255&m)*p,M=(m>>8&255)*p,w=(m>>16&255)*p;this.framebuffer[i++]=x|M<<8|w<<16|255<<24}}drawLedTunnel(t,e){for(let i=0;i<25;i++)for(let r=0;r<40;r++){const o=160/(1.4*Math.sqrt((r-20)*(r-20)+(i-12.5)*(i-12.5))),n=(15*(.5*(Math.sin(o+.005*t)+1)*(1-Math.min(.003*o,1)))|0)%16;this.drawTextureRectNoAlpha(8*r,8*i,0,8*n,8,8,e)}}drawParticleWaves(t,e,i=!1){i||this.clearColorBuffer(-13617080),this.clearDepthBuffer();const r=new Array;for(let e=0;e<50;e++)for(let i=0;i<50;i++){const o=2*(i-25),n=4*(Math.sin(.09*i*2+8e-4*t)+Math.cos(.08*e*2+9e-4*t)),s=2*(e-25);r.push(new a.Vector3f(o,n,s))}const o=a.Matrix4f.constructTranslationMatrix(0,-0,-49).multiplyMatrix(a.Matrix4f.constructXRotationMatrix(.1*Math.PI).multiplyMatrix(a.Matrix4f.constructYRotationMatrix(6e-5*t))),n=new Array(r.length);r.forEach(t=>{const e=this.project(o.multiply(t));n.push(e)}),n.sort((t,e)=>t.z-e.z),n.forEach(t=>{const i=-1.3*192/t.z;this.drawParticle(Math.round(t.x-i/2),Math.round(t.y-i/2),Math.round(i),Math.round(i),e,1/t.z,this.interpolate(-60,-25,t.z))})}drawScreenBounds(t){const e=o.Color.WHITE.toPackedFormat(),i=this.width/2,r=this.height/2;t.drawLineDDANoZ(new a.Vector3f(i/2,r/2,0),new a.Vector3f(i/2+i,r/2,-100),e),t.drawLineDDANoZ(new a.Vector3f(i/2,r/2,0),new a.Vector3f(i/2,r/2+r,-100),e),t.drawLineDDANoZ(new a.Vector3f(i/2+i,r/2,0),new a.Vector3f(i/2+i,r/2+r,-100),e),t.drawLineDDANoZ(new a.Vector3f(i/2,r/2+r,0),new a.Vector3f(i/2+i,r/2+r,-100),e)}drawBlenderScene5(t,e,i){this.clearDepthBuffer();const r=a.Matrix4f.constructTranslationMatrix(0,0,9*(.5*Math.sin(6e-4*t)+.5)-54).multiplyMatrix(a.Matrix4f.constructXRotationMatrix(.8*(.5*Math.sin(14e-5*t)+.5)-.1).multiplyMatrix(a.Matrix4f.constructYRotationMatrix(2e-4*-t).multiplyMatrix(a.Matrix4f.constructTranslationMatrix(0,-13,0))));let o=r.multiplyMatrix(a.Matrix4f.constructScaleMatrix(9,9,9));for(let t=0;t<this.blenderObj4.length;t++){const e=this.blenderObj4[t];0!==t&&2!==t&&this.renderingPipeline.draw(e,o),0===t&&this.renderingPipeline.draw(e,o),2===t&&this.renderingPipeline.draw(e,o)}o=r.multiplyMatrix(a.Matrix4f.constructTranslationMatrix(0,14.2,-4).multiplyMatrix(a.Matrix4f.constructScaleMatrix(7,7,9).multiplyMatrix(a.Matrix4f.constructXRotationMatrix(2*Math.PI*this.cosineInterpolate(0,1300,Math.floor(.7*t)%4e3)))));const n=this.blenderObj5[0];this.renderingPipeline.draw(n,o);o=r.multiplyMatrix(a.Matrix4f.constructTranslationMatrix(0,19,0).multiplyMatrix(a.Matrix4f.constructScaleMatrix(8,8,8)));const s=this.project(r.multiply(new a.Vector3f(20,19,-90)));this.drawLensFlare(s,.15*t,e,i)}drawPlaneDeformation(t,e){const i=e.width,r=e.height;let o=0;for(let n=0;n<this.height;n++){const s=2*n/this.height-1;for(let n=0;n<this.width;n++){const a=(2*n/this.width-1)/Math.abs(s)*i*.05|0,h=1/Math.abs(s)*r*.05+.008*t|0,l=1-Math.max(Math.min(1/Math.abs(s)*.2,1),0);let c=e.texture[(255&a)+(255&h)*i];c=255<<24|(c>>16&255)*l<<16|(c>>8&255)*l<<8|(c>>0&255)*l<<0,this.framebuffer[o++]=c}}}shadingSphereClip(t){this.clearDepthBuffer();let e=a.Matrix4f.constructYRotationMatrix(.1*t).multiplyMatrix(a.Matrix4f.constructScaleMatrix(1.6,1.6,1.6));e=a.Matrix4f.constructZRotationMatrix(.02*-t).multiplyMatrix(a.Matrix4f.constructTranslationMatrix(0,0,-21).multiplyMatrix(e)),this.renderingPipeline.draw(this.torus.getMesh(),e)}torusFunction(t){return new a.Vector3f(10*Math.sin(t),0,10*Math.cos(t))}cosineInterpolate(t,e,i){let r;return i<=t?0:i>=e?1:(r=(i-t)/(e-t),(1-Math.cos(r*Math.PI))/2)}createPlane(){const t={points:[]};for(let e=0;e<60;e++)for(let i=0;i<100;i++)t.points.push(new a.Vector3f(0+i,0+e,0)),t.points.push(new a.Vector3f(0+i,1+e,0)),t.points.push(new a.Vector3f(1+i,0+e,0)),t.points.push(new a.Vector3f(1+i,0+e,0)),t.points.push(new a.Vector3f(0+i,1+e,0)),t.points.push(new a.Vector3f(1+i,1+e,0));const e=[],i=[],r=[],o=[],n=[];return t.points.forEach(t=>{const i=t,r=e.find(t=>t.sub(i).length()<.001);if(r){const t=e.indexOf(r);n.push(t)}else n.push(e.push(i)-1)}),e.forEach(()=>{r.push(new a.Vector3f(0,0,0)),o.push(new a.Vector3f(0,0,0)),i.push(new a.Vector3f(0,0,0))}),{points:e,points2:i,normals:r,normals2:o,index:n}}createCylinder(){const t={points:[]};for(let e=0;e<110;e++)for(let i=0;i<50;i++){const r=30*Math.sin(2*Math.PI/50*i),o=30*Math.sin(2*Math.PI/50*(i+1)),n=30*Math.cos(2*Math.PI/50*i),s=30*Math.cos(2*Math.PI/50*(i+1));t.points.push(new a.Vector3f(r,0+e,n)),t.points.push(new a.Vector3f(r,1+e,n)),t.points.push(new a.Vector3f(o,0+e,s)),t.points.push(new a.Vector3f(o,0+e,s)),t.points.push(new a.Vector3f(r,1+e,n)),t.points.push(new a.Vector3f(o,1+e,s))}const e=[],i=[],r=[],o=[],n=[],s=[];return t.points.forEach(t=>{const i=t,r=e.find(t=>t.sub(i).length()<.001);if(r){const t=e.indexOf(r);s.push(t)}else s.push(e.push(i)-1)}),e.forEach(()=>{r.push(new a.Vector3f(0,0,0)),o.push(new a.Vector3f(0,0,0)),i.push(new a.Vector3f(0,0,0)),n.push(new b.TextureCoordinate)}),{points:e,points2:i,normals:r,normals2:o,index:s,texture:n}}createCylinder2(t){const e={points:[]};for(let i=0;i<110;i++)for(let r=0;r<50;r++){const o=r/50*256&255,n=(r+1)/50*256&255,s=.9*i/110*256&255,h=.9*(i+1)/110*256&255,l=1+(255&t.texture[o+256*s])/255*.9,c=1+(255&t.texture[n+256*s])/255*.9,u=1+(255&t.texture[o+256*h])/255*.9,f=1+(255&t.texture[n+256*h])/255*.9,d=30*Math.sin(2*Math.PI/50*r),m=30*Math.cos(2*Math.PI/50*r),p=30*Math.sin(2*Math.PI/50*(r+1)),x=30*Math.cos(2*Math.PI/50*(r+1));e.points.push(new a.Vector3f(d*l,0+i,m*l)),e.points.push(new a.Vector3f(d*u,1+i,m*u)),e.points.push(new a.Vector3f(p*c,0+i,x*c)),e.points.push(new a.Vector3f(p*c,0+i,x*c)),e.points.push(new a.Vector3f(d*u,1+i,m*u)),e.points.push(new a.Vector3f(p*f,1+i,x*f))}const i=[],r=[],o=[],n=[],s=[];return e.points.forEach(t=>{const e=t,r=i.find(t=>t.sub(e).length()<.001);if(r){const t=i.indexOf(r);s.push(t)}else s.push(i.push(e)-1)}),i.forEach(()=>{o.push(new a.Vector3f(0,0,0)),n.push(new a.Vector3f(0,0,0)),r.push(new a.Vector3f(0,0,0))}),{points:i,points2:r,normals:o,normals2:n,index:s}}fakeSphere(t,e){e.textureCoordinate.u=.5+Math.asin(t.x)/Math.PI,e.textureCoordinate.v=.5-Math.asin(t.y)/Math.PI}fakeSphere2(t,e){e.u=.5+Math.asin(t.x)/Math.PI,e.v=.5-Math.asin(t.y)/Math.PI}drawLensFlare(t,e,i,r){const o=t;o.z<0&&o.x>0&&o.x<this.width&&o.y>0&&o.y<this.height&&this.wBuffer[o.x+o.y*this.width]>1/o.z?this.lensFlareVisible||(this.lensFlareVisible=!0,this.lensFlareStart=e):this.lensFlareVisible&&(this.lensFlareVisible=!1,this.lensFlareEnd=e);let n=this.interpolate(this.lensFlareStart,this.lensFlareStart+100,e);!0!==this.lensFlareVisible&&(n*=1-this.interpolate(this.lensFlareEnd,this.lensFlareEnd+100,e));const s=new a.Vector3f(this.width/2,this.height/2,0).sub(o);if(n>0)for(let t=0;t<i.length;t++){const e=o.add(s.mul(i[t].scale));this.drawTexture(Math.round(e.x)-i[t].tex.width/2,Math.round(e.y)-i[t].tex.height/2,i[t].tex,i[t].alpha*n)}this.drawTextureRectAdd(0,0,0,0,this.width,this.height,r,.03+.15*n)}drawLineDDA(t,e,i){this.lineRasterizer.drawLineDDA(t,e,i)}drawLineDDANoZ(t,e,i){this.lineRasterizerNo.drawLineDDANoZ(t,e,i)}sphereFunction2(t,e){return new a.Vector4f(Math.cos(t)*Math.cos(e),Math.cos(t)*Math.sin(e),Math.sin(t),1)}}e.Framebuffer=y,y.PIXEL_SIZE_IN_BYTES=4,y.clipRegion=new Array(new M.RightClipEdge,new x.LeftClipEdge,new m.BottomClipEdge,new w.TopClipEdge)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextureCoordinate=void 0;e.TextureCoordinate=class{constructor(t,e){this.u=t,this.v=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector4f=void 0;class r{constructor(t,e,i,r=1){this.x=t,this.y=e,this.z=i,this.w=r}sub(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}cross(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,0)}normalize(){const t=1/this.length();return this.mul(t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}mul(t){return new r(this.x*t,this.y*t,this.z*t,this.w)}componentWiseMul(t){return new r(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}}e.Vector4f=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vertex=void 0;e.Vertex=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractClipEdge=void 0;e.AbstractClipEdge=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;class r{constructor(t=0,e=0,i=0,r=255){this.r=t,this.g=e,this.b=i,this.a=r}toPackedFormat(){return this.r|this.g<<8|this.b<<16|this.a<<24}sub(t){return new r(this.r-t.r,this.g-t.g,this.b-t.b,255)}add(t){return new r(this.r+t.r,this.g+t.g,this.b+t.b,255)}div(t){return new r(this.r/t,this.g/t,this.b/t,255)}mul(t){return new r(this.r*t,this.g*t,this.b*t,255)}}e.Color=r,r.BLACK=new r(0,0,0,255),r.WHITE=new r(255,255,255,255),r.RED=new r(255,0,0,255),r.GREEN=new r(0,255,0,255),r.LIME=new r(0,255,0,255),r.BLUE=new r(0,0,255,255),r.DARK_BLUE=new r(0,0,64,255),r.YELLOW=new r(255,255,0,255),r.CYAN=new r(0,255,255,255),r.MAGENTA=new r(255,0,255,255),r.SLATE_GRAY=new r(112,128,144,255),r.DARK_GRAY=new r(19,19,20,255)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CullFace=void 0,function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK"}(e.CullFace||(e.CullFace={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Texture=void 0;e.Texture=class{constructor(t,e,i){this.texture=t,this.width=e,this.height=i}getPixel(t,e,i){return t.texture[(255&e)+256*(255&i)]}getBilinearFilteredPixel(t,e){const i=((0|t)%256+256)%256,r=((t+1|0)%256+256)%256,o=((0|e)%256+256)%256,n=((e+1|0)%256+256)%256,s=255&this.getPixel(this,i,o),a=255&this.getPixel(this,r,o),h=255&this.getPixel(this,i,n),l=255&this.getPixel(this,r,n),c=s*(1-(t-Math.floor(t)))+a*(t-Math.floor(t)),u=h*(1-(t-Math.floor(t)))+l*(t-Math.floor(t));return c*(1-(e-Math.floor(e)))+u*(e-Math.floor(e))}getBilinearFilteredPixel2(t,e){const i=Math.min(0|t,this.width-1),r=Math.min(1+(0|t),this.width-1),o=Math.min(0|e,this.height-1),n=Math.min(1+(0|e),this.height-1),s=this.getPixel2(this,i,o),a=this.getPixel2(this,r,o),h=this.getPixel2(this,i,n),l=this.getPixel2(this,r,n);return this.interpolateComp(t,e,255&s,255&a,255&h,255&l)|this.interpolateComp(t,e,s>>8&255,a>>8&255,h>>8&255,l>>8&255)<<8|this.interpolateComp(t,e,s>>16&255,a>>16&255,h>>16&255,l>>16&255)<<16}getPixel2(t,e,i){return this.texture[e+i*this.width]}getPixel3(t,e,i){return this.texture[(e%this.width+this.width)%this.width+(i%this.height+this.height)%this.height*this.width]}interpolateComp(t,e,i,r,o,n){const s=i*(1-(t-Math.floor(t)))+r*(t-Math.floor(t)),a=o*(1-(t-Math.floor(t)))+n*(t-Math.floor(t));return s*(1-(e-Math.floor(e)))+a*(e-Math.floor(e))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;const r=i(2),o=i(41);class n{constructor(t,e,i){this.scene=i,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas.id="aisa-canvas",this.canvas.style.cssText="image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -o-crisp-edges;image-rendering: -webkit-crisp-edges;image-rendering: crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: pixelated; -ms-interpolation-mode: nearest-neighbor;",this.canvas.style.width=2*t+"px",this.canvas.style.height=2*e+"px",this.context=this.canvas.getContext("2d"),this.context.oImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.framebuffer=new r.Framebuffer(t,e),this.boundRenderLoop=this.renderLoop.bind(this)}init(){this.appendTo(document.getElementById("aisa")),this.canvas.addEventListener("click",t=>{t.preventDefault(),o.FullscreenUtils.toggleFullscreen(this.canvas)}),this.scene.init(this.framebuffer).then(()=>{this.scene.onInit(),this.renderLoop(0)})}renderLoop(t){this.scene.render(this.framebuffer,t),this.flipBackbuffer(),requestAnimationFrame(this.boundRenderLoop)}flipBackbuffer(){this.context.putImageData(this.framebuffer.getImageData(),0,0)}appendTo(t){t.appendChild(this.canvas)}}e.Canvas=n,n.WIDTH=320,n.HEIGHT=200},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlatShadingTriangleRasterizer=void 0;const r=i(12);class o extends r.AbstractTriangleRasterizer{constructor(t){super(),this.framebuffer=t,this.temp=null}drawTriangleDDA(t,e,i){if(t.projection.y>i.projection.y&&(this.temp=t,t=i,i=this.temp),t.projection.y>e.projection.y&&(this.temp=t,t=e,e=this.temp),e.projection.y>i.projection.y&&(this.temp=e,e=i,i=this.temp),t.projection.y!==i.projection.y)if(e.projection.y===i.projection.y)e.projection.x>i.projection.x&&(this.temp=e,e=i,i=this.temp),this.fillBottomFlatTriangle(t,e,i);else if(t.projection.y===e.projection.y)t.projection.x>e.projection.x&&(this.temp=t,t=e,e=this.temp),this.fillTopFlatTriangle(t,e,i);else{(i.projection.x-t.projection.x)*(e.projection.y-t.projection.y)/(i.projection.y-t.projection.y)+t.projection.x>e.projection.x?this.fillLongRightTriangle(t,e,i):this.fillLongLeftTriangle(t,e,i)}}fillBottomFlatTriangle(t,e,i){const r=t.color.toPackedFormat(),o=i.projection.y-t.projection.y,n=(e.projection.x-t.projection.x)/o,s=(i.projection.x-t.projection.x)/o,a=(1/e.projection.z-1/t.projection.z)/o,h=(1/i.projection.z-1/t.projection.z)/o;let l=1/t.projection.z,c=1/t.projection.z,u=t.projection.x,f=t.projection.x,d=t.projection.y;for(let t=0;t<o;t++){const t=Math.round(f)-Math.round(u);let e=Math.round(d)*this.framebuffer.width+Math.round(u);const i=(c-l)/t;let o=l;for(let n=0;n<t;n++)o<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=o,this.framebuffer.framebuffer[e]=r),e++,o+=i;u+=n,f+=s,d++,l+=a,c+=h}}fillTopFlatTriangle(t,e,i){const r=t.color.toPackedFormat(),o=i.projection.y-t.projection.y,n=(i.projection.x-t.projection.x)/o,s=(i.projection.x-e.projection.x)/o,a=(1/i.projection.z-1/t.projection.z)/o,h=(1/i.projection.z-1/e.projection.z)/o;let l=1/t.projection.z,c=1/e.projection.z,u=t.projection.x,f=e.projection.x,d=t.projection.y;for(let t=0;t<o;t++){const t=Math.round(f)-Math.round(u);let e=Math.round(d)*this.framebuffer.width+Math.round(u);for(let i=0;i<t;i++){const o=(c-l)/t*i+l;o<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=o,this.framebuffer.framebuffer[e]=r),e++}u+=n,f+=s,d++,l+=a,c+=h}}fillLongRightTriangle(t,e,i){const r=t.color.toPackedFormat();let o=e.projection.y-t.projection.y;const n=i.projection.y-t.projection.y;let s=(e.projection.x-t.projection.x)/o;const a=(i.projection.x-t.projection.x)/n;let h=(1/e.projection.z-1/t.projection.z)/o;const l=(1/i.projection.z-1/t.projection.z)/n;let c=1/t.projection.z,u=1/t.projection.z,f=t.projection.x,d=t.projection.x,m=t.projection.y;for(let t=0;t<o;t++){const t=Math.round(d)-Math.round(f);let e=Math.round(m)*this.framebuffer.width+Math.round(f);const i=(u-c)/t;let o=c;for(let n=0;n<t;n++)o<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=o,this.framebuffer.framebuffer[e]=r),e++,o+=i;f+=s,d+=a,m++,c+=h,u+=l}o=i.projection.y-e.projection.y,s=(i.projection.x-e.projection.x)/o,h=(1/i.projection.z-1/e.projection.z)/o,f=e.projection.x,m=e.projection.y;for(let t=0;t<o;t++){const t=Math.round(d)-Math.round(f);let e=Math.round(m)*this.framebuffer.width+Math.round(f);const i=(u-c)/t;let o=c;for(let n=0;n<t;n++)o<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=o,this.framebuffer.framebuffer[e]=r),e++,o+=i;f+=s,d+=a,m++,c+=h,u+=l}}fillLongLeftTriangle(t,e,i){const r=t.color.toPackedFormat();let o=e.projection.y-t.projection.y;const n=i.projection.y-t.projection.y;let s=(e.projection.x-t.projection.x)/o;const a=(i.projection.x-t.projection.x)/n;let h=(1/e.projection.z-1/t.projection.z)/o;const l=(1/i.projection.z-1/t.projection.z)/n;let c=1/t.projection.z,u=1/t.projection.z,f=t.projection.x,d=t.projection.x,m=t.projection.y;for(let t=0;t<o;t++){const t=Math.round(d)-Math.round(f);let e=Math.round(m)*this.framebuffer.width+Math.round(f);const i=(u-c)/t;let o=c;for(let n=0;n<t;n++)o<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=o,this.framebuffer.framebuffer[e]=r),e++,o+=i;f+=a,d+=s,m++,c+=l,u+=h}o=i.projection.y-e.projection.y,s=(i.projection.x-e.projection.x)/o,h=(1/i.projection.z-1/e.projection.z)/o,u=1/e.projection.z,d=e.projection.x,m=e.projection.y;for(let t=0;t<o;t++){const t=Math.round(d)-Math.round(f);let e=Math.round(m)*this.framebuffer.width+Math.round(f);const i=(u-c)/t;let o=c;for(let n=0;n<t;n++)o<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=o,this.framebuffer.framebuffer[e]=r),e++,o+=i;f+=a,d+=s,m++,c+=l,u+=h}}}e.FlatShadingTriangleRasterizer=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractTriangleRasterizer=void 0;e.AbstractTriangleRasterizer=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TexturedTriangleRasterizer=void 0;const r=i(1);e.TexturedTriangleRasterizer=class{constructor(t){this.framebuffer=t,this.temp=null}drawTriangleDDA(t,e,i){if(t.position.y>i.position.y&&(this.temp=t,t=i,i=this.temp),t.position.y>e.position.y&&(this.temp=t,t=e,e=this.temp),e.position.y>i.position.y&&(this.temp=e,e=i,i=this.temp),t.position.y!==i.position.y){if((i.position.x-t.position.x)*(e.position.y-t.position.y)/(i.position.y-t.position.y)+t.position.x>e.position.x)this.fillLongRightTriangle2(t,e,i);else{const o=t.textureCoordinate,n=e.textureCoordinate,s=i.textureCoordinate;this.fillLongLeftTriangle2(t.position,e.position,i.position,new r.Vector3f(o.u,o.v,0),new r.Vector3f(n.u,n.v,0),new r.Vector3f(s.u,s.v,0))}}}fillLongRightTriangle2(t,e,i){let r=e.position.y-t.position.y;const o=i.position.y-t.position.y;let n=(e.position.x-t.position.x)/r;const s=(i.position.x-t.position.x)/o;let a=(e.textureCoordinate.u/e.position.z-t.textureCoordinate.u/t.position.z)/r;const h=(i.textureCoordinate.u/i.position.z-t.textureCoordinate.u/t.position.z)/o;let l=(e.textureCoordinate.v/e.position.z-t.textureCoordinate.v/t.position.z)/r;const c=(i.textureCoordinate.v/i.position.z-t.textureCoordinate.v/t.position.z)/o;let u=(1/e.position.z-1/t.position.z)/r;const f=(1/i.position.z-1/t.position.z)/o;let d=1/t.position.z,m=1/t.position.z,p=t.textureCoordinate.u/t.position.z,x=t.textureCoordinate.v/t.position.z,M=t.textureCoordinate.u/t.position.z,w=t.textureCoordinate.v/t.position.z,g=t.position.x,b=t.position.x,y=t.position.y;for(let t=0;t<r;t++){const t=Math.round(b)-Math.round(g);let e=Math.round(y)*this.framebuffer.width+Math.round(g);const i=(m-d)/t,r=(M-p)/t,o=(w-x)/t;let v=d,P=p,C=x;for(let n=0;n<t;n++){if(v<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=v;const t=1/v,i=0|Math.max(Math.min(P*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(C*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width];this.framebuffer.framebuffer[e]=o}e++,v+=i,P+=r,C+=o}g+=n,b+=s,y++,d+=u,m+=f,p+=a,M+=h,x+=l,w+=c}if(r=i.position.y-e.position.y,0!==r){n=(i.position.x-e.position.x)/r,u=(1/i.position.z-1/e.position.z)/r,a=(i.textureCoordinate.u/i.position.z-e.textureCoordinate.u/e.position.z)/r,l=(i.textureCoordinate.v/i.position.z-e.textureCoordinate.v/e.position.z)/r,d=1/e.position.z,p=e.textureCoordinate.u/e.position.z,x=e.textureCoordinate.v/e.position.z,g=e.position.x,y=e.position.y;for(let t=0;t<r;t++){const t=Math.round(b)-Math.round(g);let e=Math.round(y)*this.framebuffer.width+Math.round(g);const i=(m-d)/t,r=(M-p)/t,o=(w-x)/t;let v=d,P=p,C=x;for(let n=0;n<t;n++){if(v<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=v;const t=1/v,i=0|Math.max(Math.min(P*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(C*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width];this.framebuffer.framebuffer[e]=o}e++,v+=i,P+=r,C+=o}g+=n,b+=s,y++,d+=u,m+=f,p+=a,M+=h,x+=l,w+=c}}}fillLongLeftTriangle2(t,e,i,r,o,n){let s=e.y-t.y;const a=i.y-t.y;let h=(e.x-t.x)/s;const l=(i.x-t.x)/a,c=(n.x/i.z-r.x/t.z)/a;let u=(o.x/e.z-r.x/t.z)/s;const f=(n.y/i.z-r.y/t.z)/a;let d=(o.y/e.z-r.y/t.z)/s,m=(1/e.z-1/t.z)/s;const p=(1/i.z-1/t.z)/a;let x=t.x,M=t.x,w=1/t.z,g=1/t.z,b=r.x/t.z,y=r.y/t.z,v=r.x/t.z,P=r.y/t.z,C=t.x,T=t.x,S=t.y;for(let t=0;t<s;t++){const t=Math.round(T)-Math.round(C);let e=Math.round(S)*this.framebuffer.width+Math.round(C);const i=(g-w)/t,r=(v-b)/t,o=(P-y)/t;let n=w,s=b,a=y;for(let h=0;h<t;h++){if(n<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=n;const t=1/n,i=0|Math.max(Math.min(s*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(a*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width];this.framebuffer.framebuffer[e]=o}e++,n+=i,s+=r,a+=o}C+=l,T+=h,S++,x+=l,M+=h,w+=p,g+=m,b+=c,v+=u,y+=f,P+=d}s=i.y-e.y,h=(i.x-e.x)/s,m=(1/i.z-1/e.z)/s,u=(n.x/i.z-o.x/e.z)/s,d=(n.y/i.z-o.y/e.z)/s,M=e.x,g=1/e.z,v=o.x/e.z,P=o.y/e.z,T=e.x,S=e.y;for(let t=0;t<s;t++){const t=Math.round(T)-Math.round(C);let e=Math.round(S)*this.framebuffer.width+Math.round(C);const i=(g-w)/t,r=(v-b)/t,o=(P-y)/t;let n=w,s=b,a=y;for(let h=0;h<t;h++){if(n<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=n;const t=1/n,i=0|Math.max(Math.min(s*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(a*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width];this.framebuffer.framebuffer[e]=o}e++,n+=i,s+=r,a+=o}C+=l,T+=h,S++,x+=l,M+=h,w+=p,g+=m,b+=c,v+=u,y+=f,P+=d}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RightClipEdge=void 0;const r=i(2),o=i(3),n=i(5),s=i(6),a=i(4),h=i(10);class l extends s.AbstractClipEdge{isInside(t){return t.projection.x<h.Canvas.WIDTH}isInside2(t){return t.position.x<h.Canvas.WIDTH}computeIntersection(t,e){const i=new n.Vertex,o=(r.Framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x);return i.color=e.color.sub(t.color).mul(o).add(t.color),i.projection=new a.Vector4f(r.Framebuffer.maxWindow.x+1,Math.round(t.projection.y+(e.projection.y-t.projection.y)*o),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*o)),i}computeIntersection2(t,e){const i=new n.Vertex;i.position=new a.Vector4f(r.Framebuffer.maxWindow.x+1,Math.round(t.position.y+(e.position.y-t.position.y)*(r.Framebuffer.maxWindow.x+1-t.position.x)/(e.position.x-t.position.x)),1/(1/t.position.z+(1/e.position.z-1/t.position.z)*(r.Framebuffer.maxWindow.x+1-t.position.x)/(e.position.x-t.position.x)));const s=new o.TextureCoordinate,h=i.position.z;return s.u=(t.textureCoordinate.u/t.position.z+(e.textureCoordinate.u/e.position.z-t.textureCoordinate.u/t.position.z)*(r.Framebuffer.maxWindow.x+1-t.position.x)/(e.position.x-t.position.x))*h,s.v=(t.textureCoordinate.v/t.position.z+(e.textureCoordinate.v/e.position.z-t.textureCoordinate.v/t.position.z)*(r.Framebuffer.maxWindow.x+1-t.position.x)/(e.position.x-t.position.x))*h,i.textureCoordinate=s,i}}e.RightClipEdge=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LeftClipEdge=void 0;const r=i(6),o=i(3),n=i(5),s=i(2),a=i(4);class h extends r.AbstractClipEdge{isInside(t){return t.projection.x>=0}isInside2(t){return t.position.x>=0}computeIntersection(t,e){const i=new n.Vertex,r=(s.Framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x);return i.color=e.color.sub(t.color).mul(r).add(t.color),i.projection=new a.Vector4f(s.Framebuffer.minWindow.x,Math.round(t.projection.y+(e.projection.y-t.projection.y)*r),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*r)),i}computeIntersection2(t,e){const i=new n.Vertex;i.position=new a.Vector4f(s.Framebuffer.minWindow.x,Math.round(t.position.y+(e.position.y-t.position.y)*(s.Framebuffer.minWindow.x-t.position.x)/(e.position.x-t.position.x)),1/(1/t.position.z+(1/e.position.z-1/t.position.z)*(s.Framebuffer.minWindow.x-t.position.x)/(e.position.x-t.position.x)));const r=new o.TextureCoordinate,h=i.position.z;return r.u=(t.textureCoordinate.u/t.position.z+(e.textureCoordinate.u/e.position.z-t.textureCoordinate.u/t.position.z)*(s.Framebuffer.minWindow.x-t.position.x)/(e.position.x-t.position.x))*h,r.v=(t.textureCoordinate.v/t.position.z+(e.textureCoordinate.v/e.position.z-t.textureCoordinate.v/t.position.z)*(s.Framebuffer.minWindow.x-t.position.x)/(e.position.x-t.position.x))*h,i.textureCoordinate=r,i}}e.LeftClipEdge=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BottomClipEdge=void 0;const r=i(2),o=i(0),n=i(3),s=i(5),a=i(6);class h extends a.AbstractClipEdge{isInside(t){return t.projection.y>=r.Framebuffer.minWindow.y}isInside2(t){return t.position.y>=r.Framebuffer.minWindow.y}computeIntersection(t,e){const i=new s.Vertex,n=(r.Framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y);return i.color=e.color.sub(t.color).mul(n).add(t.color),i.projection=new o.Vector4f(Math.round(t.projection.x+(e.projection.x-t.projection.x)*n),r.Framebuffer.minWindow.y,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*n)),i}computeIntersection2(t,e){const i=new s.Vertex;i.position=new o.Vector4f(Math.round(t.position.x+(e.position.x-t.position.x)*(r.Framebuffer.minWindow.y-t.position.y)/(e.position.y-t.position.y)),r.Framebuffer.minWindow.y,1/(1/t.position.z+(1/e.position.z-1/t.position.z)*(r.Framebuffer.minWindow.y-t.position.y)/(e.position.y-t.position.y)));const a=new n.TextureCoordinate,h=i.position.z;return a.u=(t.textureCoordinate.u/t.position.z+(e.textureCoordinate.u/e.position.z-t.textureCoordinate.u/t.position.z)*(r.Framebuffer.minWindow.y-t.position.y)/(e.position.y-t.position.y))*h,a.v=(t.textureCoordinate.v/t.position.z+(e.textureCoordinate.v/e.position.z-t.textureCoordinate.v/t.position.z)*(r.Framebuffer.minWindow.y-t.position.y)/(e.position.y-t.position.y))*h,i.textureCoordinate=a,i}}e.BottomClipEdge=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TopClipEdge=void 0;const r=i(2),o=i(0),n=i(3),s=i(5),a=i(6);class h extends a.AbstractClipEdge{isInside(t){return t.projection.y<r.Framebuffer.maxWindow.y+1}isInside2(t){return t.position.y<r.Framebuffer.maxWindow.y+1}computeIntersection(t,e){const i=new s.Vertex,n=(r.Framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y);return i.color=e.color.sub(t.color).mul(n).add(t.color),i.projection=new o.Vector4f(Math.round(t.projection.x+(e.projection.x-t.projection.x)*n),r.Framebuffer.maxWindow.y+1,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*n)),i}computeIntersection2(t,e){const i=new s.Vertex;i.position=new o.Vector4f(Math.round(t.position.x+(e.position.x-t.position.x)*(r.Framebuffer.maxWindow.y+1-t.position.y)/(e.position.y-t.position.y)),r.Framebuffer.maxWindow.y+1,1/(1/t.position.z+(1/e.position.z-1/t.position.z)*(r.Framebuffer.maxWindow.y+1-t.position.y)/(e.position.y-t.position.y)));const a=new n.TextureCoordinate,h=i.position.z;return a.u=(t.textureCoordinate.u/t.position.z+(e.textureCoordinate.u/e.position.z-t.textureCoordinate.u/t.position.z)*(r.Framebuffer.maxWindow.y+1-t.position.y)/(e.position.y-t.position.y))*h,a.v=(t.textureCoordinate.v/t.position.z+(e.textureCoordinate.v/e.position.z-t.textureCoordinate.v/t.position.z)*(r.Framebuffer.maxWindow.y+1-t.position.y)/(e.position.y-t.position.y))*h,i.textureCoordinate=a,i}}e.TopClipEdge=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractRenderingPipeline=void 0;const r=i(8);e.AbstractRenderingPipeline=class{constructor(t){this.framebuffer=t,this.NEAR_PLANE_Z=-1.7,this.cullMode=r.CullFace.BACK}setCullFace(t){this.cullMode=t}setAlpha(t){this.alpha=Math.max(Math.min(t,1),0)}isInFrontOfNearPlane(t){return t.z<this.NEAR_PLANE_Z}isTriangleCCW(t,e,i){const o=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*t.y-t.x*i.y;return this.cullMode===r.CullFace.BACK?o<0:o>0}isTriangleCCW2(t,e,i,o){const n=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*o.y-o.x*i.y+o.x*t.y-t.x*o.y;return this.cullMode===r.CullFace.BACK?n<0:n>0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractScene=void 0;e.AbstractScene=class{init(t){return Promise.all([])}onInit(){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix4f=void 0;const r=i(1),o=i(4);class n{static constructIdentityMatrix(){const t=new n;return t.m11=1,t.m12=0,t.m13=0,t.m14=0,t.m21=0,t.m22=1,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m33=1,t.m34=0,t.m41=0,t.m42=0,t.m43=0,t.m44=1,t}setIdentityMatrix(){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}transpose(){const t=new n;return t.m11=this.m11,t.m12=this.m21,t.m13=this.m31,t.m14=this.m41,t.m21=this.m12,t.m22=this.m22,t.m23=this.m32,t.m24=this.m42,t.m31=this.m13,t.m32=this.m23,t.m33=this.m33,t.m34=this.m43,t.m41=this.m14,t.m42=this.m24,t.m43=this.m34,t.m44=this.m44,t}computeNormalMatrix(){return this.inverse().transpose()}inverse(){const t=n.constructIdentityMatrix();t.m14=-this.m14,t.m24=-this.m24,t.m34=-this.m34;const e=1/Math.sqrt(this.m11*this.m11+this.m12*this.m12+this.m13*this.m13),i=1/Math.sqrt(this.m21*this.m21+this.m22*this.m22+this.m23*this.m23),r=1/Math.sqrt(this.m31*this.m31+this.m32*this.m32+this.m33*this.m33),o=n.constructIdentityMatrix();return o.m11=this.m11*e,o.m21=this.m12*e,o.m31=this.m13*e,o.m12=this.m21*i,o.m22=this.m22*i,o.m32=this.m23*i,o.m13=this.m31*r,o.m23=this.m32*r,o.m33=this.m33*r,o.multiplyMatrix(t)}getInverseRotation(){const t=n.constructIdentityMatrix();return t.m11=1*this.m11,t.m21=1*this.m12,t.m31=1*this.m13,t.m12=1*this.m21,t.m22=1*this.m22,t.m32=1*this.m23,t.m13=1*this.m31,t.m23=1*this.m32,t.m33=1*this.m33,t}getRotation(){const t=n.constructIdentityMatrix();return t.m11=this.m11,t.m21=this.m21,t.m31=this.m31,t.m12=this.m12,t.m22=this.m22,t.m32=this.m32,t.m13=this.m13,t.m23=this.m23,t.m33=this.m33,t}static constructShadowMatrix(t){const e=new r.Vector3f(0,-1.5,0),i=new r.Vector3f(0,1,0),o=new r.Vector3f(0,11,0),s=-e.dot(i),a=i.x*o.x+i.y*o.y+i.z*o.z,h=new n;return h.m11=a+s-o.x*i.x,h.m12=-o.x*i.y,h.m13=-o.x*i.z,h.m14=-o.x*s,h.m21=-o.y*i.x,h.m22=a+s-o.y*i.y,h.m23=-o.y*i.z,h.m24=-o.y*s,h.m31=-o.z*i.x,h.m32=-o.z*i.y,h.m33=a+s-o.z*i.z,h.m34=-o.z*s,h.m41=-i.x,h.m42=-i.y,h.m43=-i.z,h.m44=a,h}static constructTranslationMatrix(t,e,i){const r=new n;return r.m11=1,r.m12=0,r.m13=0,r.m14=t,r.m21=0,r.m22=1,r.m23=0,r.m24=e,r.m31=0,r.m32=0,r.m33=1,r.m34=i,r.m41=0,r.m42=0,r.m43=0,r.m44=1,r}setTranslationMatrix(t,e,i){this.m11=1,this.m12=0,this.m13=0,this.m14=t,this.m21=0,this.m22=1,this.m23=0,this.m24=e,this.m31=0,this.m32=0,this.m33=1,this.m34=i,this.m41=0,this.m42=0,this.m43=0,this.m44=1}static constructXRotationMatrix(t){const e=new n;return e.m11=1,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=Math.cos(t),e.m23=-Math.sin(t),e.m24=0,e.m31=0,e.m32=Math.sin(t),e.m33=Math.cos(t),e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}setXRotationMatrix(t){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=Math.cos(t),this.m23=-Math.sin(t),this.m24=0,this.m31=0,this.m32=Math.sin(t),this.m33=Math.cos(t),this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setScaleMatrix(t,e,i){this.m11=t,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=e,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=i,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setYRotationMatrix(t){this.m11=Math.cos(t),this.m12=0,this.m13=Math.sin(t),this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=-Math.sin(t),this.m32=0,this.m33=Math.cos(t),this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}static constructYRotationMatrix(t){const e=new n;return e.m11=Math.cos(t),e.m12=0,e.m13=Math.sin(t),e.m14=0,e.m21=0,e.m22=1,e.m23=0,e.m24=0,e.m31=-Math.sin(t),e.m32=0,e.m33=Math.cos(t),e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}static constructZRotationMatrix(t){const e=new n;return e.m11=Math.cos(t),e.m12=-Math.sin(t),e.m13=0,e.m14=0,e.m21=Math.sin(t),e.m22=Math.cos(t),e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=1,e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}static constructScaleMatrix(t,e=t,i=e){const r=new n;return r.m11=t,r.m12=0,r.m13=0,r.m14=0,r.m21=0,r.m22=e,r.m23=0,r.m24=0,r.m31=0,r.m32=0,r.m33=i,r.m34=0,r.m41=0,r.m42=0,r.m43=0,r.m44=1,r}multiplyMatrix(t){const e=new n;return e.m11=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31+this.m14*t.m41,e.m21=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31+this.m24*t.m41,e.m31=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31+this.m34*t.m41,e.m41=this.m41*t.m11+this.m42*t.m21+this.m43*t.m31+this.m44*t.m41,e.m12=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32+this.m14*t.m42,e.m22=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32+this.m24*t.m42,e.m32=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32+this.m34*t.m42,e.m42=this.m41*t.m12+this.m42*t.m22+this.m43*t.m32+this.m44*t.m42,e.m13=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33+this.m14*t.m43,e.m23=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33+this.m24*t.m43,e.m33=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33+this.m34*t.m43,e.m43=this.m41*t.m13+this.m42*t.m23+this.m43*t.m33+this.m44*t.m43,e.m14=this.m11*t.m14+this.m12*t.m24+this.m13*t.m34+this.m14*t.m44,e.m24=this.m21*t.m14+this.m22*t.m24+this.m23*t.m34+this.m24*t.m44,e.m34=this.m31*t.m14+this.m32*t.m24+this.m33*t.m34+this.m34*t.m44,e.m44=this.m41*t.m14+this.m42*t.m24+this.m43*t.m34+this.m44*t.m44,e}multiply2(t,e){this.m11=t.m11*e.m11+t.m12*e.m21+t.m13*e.m31+t.m14*e.m41,this.m21=t.m21*e.m11+t.m22*e.m21+t.m23*e.m31+t.m24*e.m41,this.m31=t.m31*e.m11+t.m32*e.m21+t.m33*e.m31+t.m34*e.m41,this.m41=t.m41*e.m11+t.m42*e.m21+t.m43*e.m31+t.m44*e.m41,this.m12=t.m11*e.m12+t.m12*e.m22+t.m13*e.m32+t.m14*e.m42,this.m22=t.m21*e.m12+t.m22*e.m22+t.m23*e.m32+t.m24*e.m42,this.m32=t.m31*e.m12+t.m32*e.m22+t.m33*e.m32+t.m34*e.m42,this.m42=t.m41*e.m12+t.m42*e.m22+t.m43*e.m32+t.m44*e.m42,this.m13=t.m11*e.m13+t.m12*e.m23+t.m13*e.m33+t.m14*e.m43,this.m23=t.m21*e.m13+t.m22*e.m23+t.m23*e.m33+t.m24*e.m43,this.m33=t.m31*e.m13+t.m32*e.m23+t.m33*e.m33+t.m34*e.m43,this.m43=t.m41*e.m13+t.m42*e.m23+t.m43*e.m33+t.m44*e.m43,this.m14=t.m11*e.m14+t.m12*e.m24+t.m13*e.m34+t.m14*e.m44,this.m24=t.m21*e.m14+t.m22*e.m24+t.m23*e.m34+t.m24*e.m44,this.m34=t.m31*e.m14+t.m32*e.m24+t.m33*e.m34+t.m34*e.m44,this.m44=t.m41*e.m14+t.m42*e.m24+t.m43*e.m34+t.m44*e.m44}multiply(t){return new r.Vector3f(this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34)}multiplyHom(t){return new o.Vector4f(this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w,this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44*t.w)}multiplyHomArr(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w}multiplyHomArr2(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w,e.w=this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44*t.w,e.x/=e.w,e.y/=e.w,e.z/=e.w}multiplyArr(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34}}e.Matrix4f=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlatShadingRenderingPipeline=void 0;const r=i(7),o=i(0),n=i(11),s=i(34),a=i(35),h=i(25),l=i(27),c=i(5),u=i(18),f=i(37);class d extends u.AbstractRenderingPipeline{constructor(t){super(t),this.fog=null,this.lights=null,this.material=null,this.lighting=!0,this.color=r.Color.WHITE,this.triangleRasterizer=null,this.projectedVertices=new Array(new o.Vector4f(0,0,0,1),new o.Vector4f(0,0,0,1),new o.Vector4f(0,0,0,1)),this.vertexArray=new Array(new c.Vertex,new c.Vertex,new c.Vertex);const e=new h.PointLight;e.ambientIntensity=new o.Vector4f(1,1,1,1),e.diffuseIntensity=new o.Vector4f(1,1,1,1),e.specularIntensity=new o.Vector4f(1,1,1,1),e.position=new o.Vector4f(3,0,-2,1);const i=new h.PointLight;i.ambientIntensity=new o.Vector4f(0,0,1,1),i.diffuseIntensity=new o.Vector4f(0,.6,1,1),i.specularIntensity=new o.Vector4f(.8,.8,.8,1),i.position=new o.Vector4f(0,-380,-180,1),this.lights=[e,i];const s=new l.Material;s.ambientColor=new o.Vector4f(.12,.14,.1,0),s.diffuseColor=new o.Vector4f(.38,.4,.4,1),s.specularColor=new o.Vector4f(.8,.5,.5,0),s.shininess=2,this.material=s,this.triangleRasterizer=new n.FlatShadingTriangleRasterizer(this.framebuffer),this.triangleRasterizer=new f.GouraudShadingTriangleRasterizer(this.framebuffer)}setFog(t){this.fog=t}setLights(t){this.lights=t}enableLighting(t){this.lighting=t}setMaterial(t){this.material=t}setColor(t){this.color=t}draw(t,e){const i=e.computeNormalMatrix();for(let e=0;e<t.normals.length;e++)i.multiplyHomArr(t.normals[e],t.transformedNormals[e]);for(let i=0;i<t.points.length;i++)e.multiplyHomArr(t.points[i],t.transformedPoints[i]);for(let e=0;e<t.faces.length;e++){const i=t.transformedPoints[t.faces[e].v1],r=t.transformedPoints[t.faces[e].v2],o=t.transformedPoints[t.faces[e].v3],n=t.transformedNormals[t.faces[e].n1],s=t.transformedNormals[t.faces[e].n2],a=t.transformedNormals[t.faces[e].n3];if(this.isInFrontOfNearPlane(i)&&this.isInFrontOfNearPlane(r)&&this.isInFrontOfNearPlane(o))this.project2(i,this.projectedVertices[0]),this.project2(r,this.projectedVertices[1]),this.project2(o,this.projectedVertices[2]),this.vertexArray[0].position=i,this.vertexArray[0].projection=this.projectedVertices[0],this.vertexArray[0].normal=n,this.vertexArray[1].position=r,this.vertexArray[1].projection=this.projectedVertices[1],this.vertexArray[1].normal=s,this.vertexArray[2].position=o,this.vertexArray[2].projection=this.projectedVertices[2],this.vertexArray[2].normal=a,this.renderConvexPolygon(this.vertexArray,!0);else{if(!(this.isInFrontOfNearPlane(i)||this.isInFrontOfNearPlane(r)||this.isInFrontOfNearPlane(o)))continue;{this.vertexArray[0].position=i,this.vertexArray[1].position=r,this.vertexArray[2].position=o,this.lighting?(this.vertexArray[0].color=this.computeColor(n,i),this.vertexArray[1].color=this.computeColor(s,r),this.vertexArray[2].color=this.computeColor(a,o)):(this.vertexArray[0].color=this.color,this.vertexArray[1].color=this.color,this.vertexArray[2].color=this.color);const t=this.zClipTriangle(this.vertexArray);if(t.length<3)return;for(let e=0;e<t.length;e++)t[e].projection=this.project(t[e].position);this.renderConvexPolygon(t)}}}}project(t){return new o.Vector4f(Math.round(this.framebuffer.width/2+292*t.x/-t.z),Math.round(this.framebuffer.height/2-292*t.y/-t.z),t.z)}project2(t,e){e.x=Math.round(this.framebuffer.width/2+292*t.x/-t.z),e.y=Math.round(this.framebuffer.height/2-292*t.y/-t.z),e.z=t.z}computeNearPlaneIntersection(t,e){const i=(this.NEAR_PLANE_Z-t.position.z)/(e.position.z-t.position.z),r=new c.Vertex;return r.position=new o.Vector4f(i*(e.position.x-t.position.x)+t.position.x,i*(e.position.y-t.position.y)+t.position.y,this.NEAR_PLANE_Z),r.color=e.color.sub(t.color).mul(i).add(t.color),r}zClipTriangle(t){const e=t,i=new Array;let r=e[e.length-1];for(let t=0;t<e.length;t++){const o=e[t];this.isInFrontOfNearPlane(o.position)?(this.isInFrontOfNearPlane(r.position)||i.push(this.computeNearPlaneIntersection(r,o)),i.push(o)):this.isInFrontOfNearPlane(r.position)&&i.push(this.computeNearPlaneIntersection(r,o)),r=o}return i}renderConvexPolygon(t,e=!1){if(3===t.length&&!this.isTriangleCCW(t[0].projection,t[1].projection,t[2].projection))return;if(e&&(this.lighting?(this.vertexArray[0].color=this.computeColor(this.vertexArray[0].normal,this.vertexArray[0].position),this.vertexArray[1].color=this.computeColor(this.vertexArray[1].normal,this.vertexArray[1].position),this.vertexArray[2].color=this.computeColor(this.vertexArray[2].normal,this.vertexArray[2].position)):(this.vertexArray[0].color=this.color,this.vertexArray[1].color=this.color,this.vertexArray[2].color=this.color)),4===t.length&&!this.isTriangleCCW2(t[0].projection,t[1].projection,t[2].projection,t[3].projection))return;const i=s.SutherlandHodgman2DClipper.clipConvexPolygon(t);i.length<3||this.triangulateConvexPolygon(i)}triangulateConvexPolygon(t){for(let e=0;e<t.length-2;e++)this.triangleRasterizer.drawTriangleDDA(t[0],t[1+e],t[2+e])}computeColor(t,e){let i=(new a.PhongLighting).computeColor(this.material,this.lights,t,e);return null!==this.fog&&(i=this.fog.computeVertexColor(i,e)),new r.Color(Math.min(255,255*i.x),Math.min(255,255*i.y),Math.min(255,255*i.z),255)}}e.FlatShadingRenderingPipeline=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractGeometricObject=void 0;const r=i(0);e.AbstractGeometricObject=class{buildMesh(t,e,i=!1){this.inverse=i;const o=new Array;for(let i=0;i<e.length;i+=3){const r=t[e[i+1]].sub(t[e[i]]).cross(t[e[i+2]].sub(t[e[i]]));o.push(this.inverse?r.normalize().mul(-1):r.normalize())}const n=new Array;for(let t=0;t<e.length;t+=3)n.push({n1:t/3,n2:t/3,n3:t/3,v1:e[0+t],v2:e[1+t],v3:e[2+t]});this.mesh={points:t,normals:o,faces:n,transformedPoints:t.map(()=>new r.Vector4f(0,0,0,0)),transformedNormals:o.map(()=>new r.Vector4f(0,0,0,0))}}getMesh(){return this.mesh}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextureUtils=void 0;const r=i(28),o=i(9);e.TextureUtils=class{static generateProceduralNoise(){return new Promise(t=>{const e=new o.Texture;e.texture=new Uint32Array(65536);const i=new r.default;i.setSeed(100);for(let t=0;t<65536;t++){const r=i.getFloat();e.texture[t]=200*r|255*r<<8|205*r<<16|255<<24}e.width=256,e.height=256,t(e)})}static generateProceduralParticleTexture(){return new Promise(t=>{const e=new o.Texture;e.texture=new Uint32Array(65536),(new r.default).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const r=127-i,o=127-t,n=Math.sqrt(r*r+o*o)/127;let s=1-n;s*=s*s,n>1&&(s=0),s=Math.min(1,2.9*s),e.texture[i+256*t]=15466475|255*s<<24}e.width=256,e.height=256,t(e)})}static generateProceduralParticleTexture2(){return new Promise(t=>{const e=new o.Texture;e.texture=new Uint32Array(65536),(new r.default).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const r=127-i,o=127-t,n=Math.sqrt(r*r+o*o)/127;let s=1-n;s*=s,n>1&&(s=0),s=Math.min(1,40*s),e.texture[i+256*t]=16764415|255*s<<24}e.width=256,e.height=256,t(e)})}static load(t,e){return new Promise(i=>{const r=new Image;r.onload=()=>{const t=new o.Texture;t.texture=this.getImageData(r,e),t.width=r.width,t.height=r.height,i(t)},r.onerror=()=>i(),r.src=t.default})}static getImageData(t,e=!1){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0);const o=r.getImageData(0,0,t.width,t.height).data,n=new Uint32Array(o.length/4);let s=0;for(let t=0;t<o.length;t+=4)n[s]=e?o[t+3]<<24|o[t+2]<<16|o[t+1]<<8|o[t+0]:255<<24|o[t+2]<<16|o[t+1]<<8|o[t+0],s++;return n}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Torus=void 0;const r=i(4),o=i(22),n=i(1);class s extends o.AbstractGeometricObject{constructor(t=!1){super();const e=[];this.inverse=t;for(let t=0;t<15;t++){const i=this.torusFunction(2*t*Math.PI/15),o=this.torusFunction(2*t*Math.PI/15+.1),s=new n.Vector3f(0,4,0),a=o.sub(i).cross(s);for(let t=0;t<12;t++){const o=s.mul(Math.sin(2*t*Math.PI/12)).add(a.mul(Math.cos(2*t*Math.PI/12))).add(i);e.push(new r.Vector4f(o.x,o.y,o.z,1))}}const i=[];for(let t=0;t<15;t++)for(let r=0;r<12;r++)i.push((12*t+(1+r)%12)%e.length),i.push((12*t+(0+r)%12)%e.length),i.push((12*t+12+(1+r)%12)%e.length),i.push((12*t+12+(0+r)%12)%e.length),i.push((12*t+12+(1+r)%12)%e.length),i.push((12*t+(0+r)%12)%e.length);this.buildMesh(e,i)}torusFunction(t){return new n.Vector3f(10*Math.sin(t),0,10*Math.cos(t))}}e.Torus=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointLight=void 0;const r=i(36);class o extends r.Light{}e.PointLight=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2f=void 0;class r{constructor(t,e){this.x=t,this.y=e}perp(){return new r(-this.y,this.x)}sub(t){return new r(this.x-t.x,this.y-t.y)}mul(t){return new r(this.x*t,this.y*t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=1/this.length();return this.mul(t)}dot(t){return this.x*t.x+this.y*t.y}}e.Vector2f=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Material=void 0;e.Material=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.seed=6}getFloat(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}setSeed(t){this.seed=t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScaleClipBlitter=void 0;e.ScaleClipBlitter=class{constructor(t){this.framebuffer=t}drawScaledTextureClip(t,e,i,r,o,n){const s=o.width/i,a=o.height/r;let h,l,c,u,f,d=0,m=0;if(e+r<0||e>this.framebuffer.height-1||t+i<0||t>this.framebuffer.width-1)return;e<0?(m=a*-e,h=r+e-Math.max(e+r-this.framebuffer.height,0),c=0):(c=e,h=r-Math.max(e+r-this.framebuffer.height,0)),t<0?(f=d=s*-t,l=i+t-Math.max(t+i-this.framebuffer.width,0),u=0):(f=0,u=t,l=i-Math.max(t+i-this.framebuffer.width,0));const p=1/255*n;let x=u+c*this.framebuffer.width;for(let t=0;t<h;t++){for(let t=0;t<l;t++){const t=Math.min(0|d,o.width-1)+Math.min(0|m,o.height-1)*o.width,e=(o.texture[t]>>24&255)*p,i=1-e,r=this.framebuffer.framebuffer[x],n=o.texture[t],a=(r>>0&255)*i+(n>>0&255)*e,h=(r>>8&255)*i+(n>>8&255)*e,l=(r>>16&255)*i+(n>>16&255)*e;this.framebuffer.framebuffer[x]=a|h<<8|l<<16|255<<24,d+=s,x++}m+=a,d=f,x+=-l+this.framebuffer.width}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TexturingRenderingPipeline=void 0;const r=i(2),o=i(4),n=i(39),s=i(13),a=i(3),h=i(5),l=i(18);class c extends l.AbstractRenderingPipeline{constructor(t){super(t),this.triangleRasterizer=null,this.vertexArray=new Array(new h.Vertex,new h.Vertex,new h.Vertex),this.projectedVertices=new Array(new o.Vector4f(0,0,0,1),new o.Vector4f(0,0,0,1),new o.Vector4f(0,0,0,1)),this.setAlpha(1),this.triangleRasterizer=new s.TexturedTriangleRasterizer(t)}enableAlphaBlending(){this.triangleRasterizer=new n.TexturedAlphaBlendingTriangleRasterizer(this.framebuffer,this)}disableAlphaBlending(){this.triangleRasterizer=new s.TexturedTriangleRasterizer(this.framebuffer)}setModelViewMatrix(t){this.modelViewMatrix=t}drawMeshArray(t){for(let e=0;e<t.length;e++){const i=t[e];this.draw(i)}}draw(t){for(let e=0;e<t.points.length;e++)this.modelViewMatrix.multiplyHomArr(t.points[e],t.points2[e]);for(let e=0;e<t.faces.length;e++){const i=t.points2[t.faces[e].vertices[0]],r=t.points2[t.faces[e].vertices[1]],o=t.points2[t.faces[e].vertices[2]];if(this.isInFrontOfNearPlane(i)&&this.isInFrontOfNearPlane(r)&&this.isInFrontOfNearPlane(o))this.project2(i,this.projectedVertices[0]),this.project2(r,this.projectedVertices[1]),this.project2(o,this.projectedVertices[2]),this.isTriangleCCW(this.projectedVertices[0],this.projectedVertices[1],this.projectedVertices[2])&&(this.vertexArray[0].position=this.projectedVertices[0],this.vertexArray[0].textureCoordinate=t.uv[t.faces[e].uv[0]],this.vertexArray[1].position=this.projectedVertices[1],this.vertexArray[1].textureCoordinate=t.uv[t.faces[e].uv[1]],this.vertexArray[2].position=this.projectedVertices[2],this.vertexArray[2].textureCoordinate=t.uv[t.faces[e].uv[2]],this.clipConvexPolygon2(this.vertexArray));else{if(!(this.isInFrontOfNearPlane(i)||this.isInFrontOfNearPlane(r)||this.isInFrontOfNearPlane(o)))continue;this.vertexArray[0].position=i,this.vertexArray[0].textureCoordinate=t.uv[t.faces[e].uv[0]],this.vertexArray[1].position=r,this.vertexArray[1].textureCoordinate=t.uv[t.faces[e].uv[1]],this.vertexArray[2].position=o,this.vertexArray[2].textureCoordinate=t.uv[t.faces[e].uv[2]],this.zClipTriangle2(this.vertexArray)}}}project(t){return new o.Vector4f(Math.round(this.framebuffer.width/2+292*t.x/-t.z),Math.round(this.framebuffer.height/2-292*t.y/-t.z),t.z)}project2(t,e){e.x=Math.round(this.framebuffer.width/2+292*t.x/-t.z),e.y=Math.round(this.framebuffer.height/2-292*t.y/-t.z),e.z=t.z}computeNearPlaneIntersection2(t,e){const i=(this.NEAR_PLANE_Z-t.position.z)/(e.position.z-t.position.z),r=new h.Vertex;return r.position=new o.Vector4f(i*(e.position.x-t.position.x)+t.position.x,i*(e.position.y-t.position.y)+t.position.y,this.NEAR_PLANE_Z),r.textureCoordinate=new a.TextureCoordinate(i*(e.textureCoordinate.u-t.textureCoordinate.u)+t.textureCoordinate.u,i*(e.textureCoordinate.v-t.textureCoordinate.v)+t.textureCoordinate.v),r}zClipTriangle2(t){const e=t,i=new Array;let r=e[e.length-1];for(let t=0;t<e.length;t++){const o=e[t];this.isInFrontOfNearPlane(o.position)?(this.isInFrontOfNearPlane(r.position)||i.push(this.computeNearPlaneIntersection2(r,o)),i.push(o)):this.isInFrontOfNearPlane(r.position)&&i.push(this.computeNearPlaneIntersection2(r,o)),r=o}if(i.length<3)return;const o=i.map(t=>(t.position=this.project(t.position),t));(3!==i.length||this.isTriangleCCW(o[0].position,o[1].position,o[2].position))&&(4!==i.length||this.isTriangleCCW2(o[0].position,o[1].position,o[2].position,o[3].position))&&this.clipConvexPolygon2(o)}clipConvexPolygon2(t){let e=t;for(let t=0;t<r.Framebuffer.clipRegion.length;t++){const i=r.Framebuffer.clipRegion[t],o=e;e=new Array;let n=o[o.length-1];for(let t=0;t<o.length;t++){const r=o[t];i.isInside2(r)?(i.isInside2(n)||e.push(i.computeIntersection2(n,r)),e.push(r)):i.isInside2(n)&&e.push(i.computeIntersection2(n,r)),n=r}}if(!(e.length<3))for(let t=0;t<e.length-2;t++)this.triangleRasterizer.drawTriangleDDA(e[0],e[1+t],e[2+t])}}e.TexturingRenderingPipeline=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix3f=void 0;const r=i(1);class o{static constructXRotationMatrix(t){const e=new o,i=Math.cos(t),r=Math.sin(t);return e.m11=1,e.m12=0,e.m13=0,e.m21=0,e.m22=i,e.m23=-r,e.m31=0,e.m32=r,e.m33=i,e}static constructYRotationMatrix(t){const e=new o;return e.m11=Math.cos(t),e.m12=0,e.m13=Math.sin(t),e.m21=0,e.m22=1,e.m23=0,e.m31=-Math.sin(t),e.m32=0,e.m33=Math.cos(t),e}static constructZRotationMatrix(t){const e=new o;return e.m11=Math.cos(t),e.m12=-Math.sin(t),e.m13=0,e.m21=Math.sin(t),e.m22=Math.cos(t),e.m23=0,e.m31=0,e.m32=0,e.m33=1,e}static constructScaleMatrix(t,e,i){const r=new o;return r.m11=t,r.m12=0,r.m13=0,r.m21=0,r.m22=e,r.m23=0,r.m31=0,r.m32=0,r.m33=i,r}multiplyMatrix(t){const e=new o;return e.m11=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,e.m21=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,e.m31=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,e.m12=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,e.m22=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,e.m32=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,e.m13=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,e.m23=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,e.m33=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33,e}multiply(t){return new r.Vector3f(this.m11*t.x+this.m12*t.y+this.m13*t.z,this.m21*t.x+this.m22*t.y+this.m23*t.z,this.m31*t.x+this.m32*t.y+this.m33*t.z)}}e.Matrix3f=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LineRasterizerDda=void 0;e.LineRasterizerDda=class{constructor(t){this.framebuffer=t}drawLineDDA(t,e,i){const r=e.x-t.x,o=e.y-t.y;let n,s,a;Math.abs(r)>Math.abs(o)?(n=Math.sign(r),s=o/Math.abs(r),a=Math.abs(r)):(n=r/Math.abs(o),s=Math.sign(o),a=Math.abs(o));let h=t.x,l=t.y,c=1/t.z;const u=(1/e.z-1/t.z)/a;for(let t=0;t<=a;t++)c<this.framebuffer.wBuffer[Math.round(h)+Math.round(l)*this.framebuffer.width]&&(this.framebuffer.wBuffer[Math.round(h)+Math.round(l)*this.framebuffer.width]=c,this.framebuffer.drawPixel(Math.round(h),Math.round(l),i)),h+=n,l+=s,c+=u}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LineRasterizerNoZ=void 0;e.LineRasterizerNoZ=class{constructor(t){this.framebuffer=t}drawLineDDANoZ(t,e,i){const r=e.x-t.x,o=e.y-t.y;let n,s,a;Math.abs(r)>Math.abs(o)?(n=Math.sign(r),s=o/Math.abs(r),a=Math.abs(r)):(n=r/Math.abs(o),s=Math.sign(o),a=Math.abs(o));let h=t.x,l=t.y;for(let t=0;t<=a;t++)this.framebuffer.drawPixel(Math.round(h),Math.round(l),i),h+=n,l+=s}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SutherlandHodgman2DClipper=void 0;const r=i(14),o=i(15),n=i(16),s=i(17);class a{static clipConvexPolygon(t){let e=t;for(let t=0;t<a.clipRegion.length;t++){const i=a.clipRegion[t],r=e;e=new Array;let o=r[r.length-1];for(let t=0;t<r.length;t++){const n=r[t];i.isInside(n)?(i.isInside(o)||e.push(i.computeIntersection(o,n)),e.push(n)):i.isInside(o)&&e.push(i.computeIntersection(o,n)),o=n}}return e}}e.SutherlandHodgman2DClipper=a,a.clipRegion=new Array(new r.RightClipEdge,new o.LeftClipEdge,new n.BottomClipEdge,new s.TopClipEdge)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PhongLighting=void 0;const r=i(0);e.PhongLighting=class{computeColor(t,e,i,o){let n=new r.Vector4f(0,0,0);for(let r=0;r<e.length;r++){const s=e[r],a=this.computeAmbientIntensity(t,s),h=this.computeDiffuseIntensity(t,s,i,o),l=this.computeSpecularIntensity(t,s,i,o);n=n.add(a).add(h).add(l)}return n}computeAmbientIntensity(t,e){return t.ambientColor.componentWiseMul(e.ambientIntensity)}computeDiffuseIntensity(t,e,i,r){const o=e.position.sub(r).normalize(),n=Math.min(Math.max(i.dot(o),0),1);return t.diffuseColor.componentWiseMul(e.diffuseIntensity).mul(n)}computeSpecularIntensity(t,e,i,r){const o=e.position.sub(r).normalize(),n=i.mul(2*i.dot(o)).sub(o),s=r.mul(-1).normalize(),a=Math.pow(Math.max(n.dot(s),0),t.shininess);return t.specularColor.componentWiseMul(e.specularIntensity).mul(a)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Light=void 0;e.Light=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GouraudShadingTriangleRasterizer=void 0;const r=i(12),o=i(38);class n extends r.AbstractTriangleRasterizer{constructor(t){super(),this.framebuffer=t,this.temp=null,this.colorInterpolator1=new o.ColorInterpolator,this.colorInterpolator2=new o.ColorInterpolator,this.colorInterpolator3=new o.ColorInterpolator,this.rowColorInterpolator=new o.ColorInterpolator}drawTriangleDDA(t,e,i){if(t.projection.y>i.projection.y&&(this.temp=t,t=i,i=this.temp),t.projection.y>e.projection.y&&(this.temp=t,t=e,e=this.temp),e.projection.y>i.projection.y&&(this.temp=e,e=i,i=this.temp),t.projection.y!==i.projection.y)if(e.projection.y===i.projection.y)e.projection.x>i.projection.x&&(this.temp=e,e=i,i=this.temp),this.fillBottomFlatTriangle(t,e,i);else if(t.projection.y===e.projection.y)t.projection.x>e.projection.x&&(this.temp=t,t=e,e=this.temp),this.fillTopFlatTriangle(t,e,i);else{(i.projection.x-t.projection.x)*(e.projection.y-t.projection.y)/(i.projection.y-t.projection.y)+t.projection.x>e.projection.x?this.fillLongRightTriangle(t,e,i):this.fillLongLeftTriangle(t,e,i)}}fillBottomFlatTriangle(t,e,i){const r=i.projection.y-t.projection.y,o=(e.projection.x-t.projection.x)/r,n=(i.projection.x-t.projection.x)/r;this.colorInterpolator1.setup(t.color,e.color,r),this.colorInterpolator2.setup(t.color,i.color,r);const s=(1/e.projection.z-1/t.projection.z)/r,a=(1/i.projection.z-1/t.projection.z)/r;let h=1/t.projection.z,l=1/t.projection.z,c=t.projection.x,u=t.projection.x,f=t.projection.y;for(let t=0;t<r;t++){const t=Math.round(u)-Math.round(c);this.rowColorInterpolator.setup(this.colorInterpolator1.startColor,this.colorInterpolator2.startColor,t);let e=Math.round(f)*this.framebuffer.width+Math.round(c);const i=(l-h)/t;let r=h;for(let o=0;o<t;o++)r<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=r,this.framebuffer.framebuffer[e]=this.rowColorInterpolator.startColor.toPackedFormat()),e++,r+=i,this.rowColorInterpolator.startColor.r+=this.rowColorInterpolator.colorSlope.r,this.rowColorInterpolator.startColor.g+=this.rowColorInterpolator.colorSlope.g,this.rowColorInterpolator.startColor.b+=this.rowColorInterpolator.colorSlope.b;c+=o,u+=n,f++,this.colorInterpolator1.startColor.r+=this.colorInterpolator1.colorSlope.r,this.colorInterpolator1.startColor.g+=this.colorInterpolator1.colorSlope.g,this.colorInterpolator1.startColor.b+=this.colorInterpolator1.colorSlope.b,this.colorInterpolator2.startColor.r+=this.colorInterpolator2.colorSlope.r,this.colorInterpolator2.startColor.g+=this.colorInterpolator2.colorSlope.g,this.colorInterpolator2.startColor.b+=this.colorInterpolator2.colorSlope.b,h+=s,l+=a}}fillTopFlatTriangle(t,e,i){const r=i.projection.y-t.projection.y,o=(i.projection.x-t.projection.x)/r,n=(i.projection.x-e.projection.x)/r;this.colorInterpolator1.setup(t.color,i.color,r),this.colorInterpolator2.setup(e.color,i.color,r);const s=(1/i.projection.z-1/t.projection.z)/r,a=(1/i.projection.z-1/e.projection.z)/r;let h=1/t.projection.z,l=1/e.projection.z,c=t.projection.x,u=e.projection.x,f=t.projection.y;for(let t=0;t<r;t++){const t=Math.round(u)-Math.round(c);this.rowColorInterpolator.setup(this.colorInterpolator1.startColor,this.colorInterpolator2.startColor,t);let e=Math.round(f)*this.framebuffer.width+Math.round(c);for(let i=0;i<t;i++){const r=(l-h)/t*i+h;r<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=r,this.framebuffer.framebuffer[e]=this.rowColorInterpolator.startColor.toPackedFormat()),e++,this.rowColorInterpolator.startColor.r+=this.rowColorInterpolator.colorSlope.r,this.rowColorInterpolator.startColor.g+=this.rowColorInterpolator.colorSlope.g,this.rowColorInterpolator.startColor.b+=this.rowColorInterpolator.colorSlope.b}c+=o,u+=n,f++,this.colorInterpolator1.startColor.r+=this.colorInterpolator1.colorSlope.r,this.colorInterpolator1.startColor.g+=this.colorInterpolator1.colorSlope.g,this.colorInterpolator1.startColor.b+=this.colorInterpolator1.colorSlope.b,this.colorInterpolator2.startColor.r+=this.colorInterpolator2.colorSlope.r,this.colorInterpolator2.startColor.g+=this.colorInterpolator2.colorSlope.g,this.colorInterpolator2.startColor.b+=this.colorInterpolator2.colorSlope.b,h+=s,l+=a}}fillLongRightTriangle(t,e,i){let r=e.projection.y-t.projection.y;const o=i.projection.y-t.projection.y;this.colorInterpolator1.setup(t.color,e.color,r),this.colorInterpolator2.setup(t.color,i.color,o);let n=(e.projection.x-t.projection.x)/r;const s=(i.projection.x-t.projection.x)/o;let a=(1/e.projection.z-1/t.projection.z)/r;const h=(1/i.projection.z-1/t.projection.z)/o;let l=1/t.projection.z,c=1/t.projection.z,u=t.projection.x,f=t.projection.x,d=t.projection.y;for(let t=0;t<r;t++){const t=Math.round(f)-Math.round(u);this.rowColorInterpolator.setup(this.colorInterpolator1.startColor,this.colorInterpolator2.startColor,t);let e=Math.round(d)*this.framebuffer.width+Math.round(u);const i=(c-l)/t;let r=l;for(let o=0;o<t;o++)r<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=r,this.framebuffer.framebuffer[e]=this.rowColorInterpolator.startColor.toPackedFormat()),e++,r+=i,this.rowColorInterpolator.startColor.r+=this.rowColorInterpolator.colorSlope.r,this.rowColorInterpolator.startColor.g+=this.rowColorInterpolator.colorSlope.g,this.rowColorInterpolator.startColor.b+=this.rowColorInterpolator.colorSlope.b;u+=n,f+=s,d++,this.colorInterpolator1.startColor.r+=this.colorInterpolator1.colorSlope.r,this.colorInterpolator1.startColor.g+=this.colorInterpolator1.colorSlope.g,this.colorInterpolator1.startColor.b+=this.colorInterpolator1.colorSlope.b,this.colorInterpolator2.startColor.r+=this.colorInterpolator2.colorSlope.r,this.colorInterpolator2.startColor.g+=this.colorInterpolator2.colorSlope.g,this.colorInterpolator2.startColor.b+=this.colorInterpolator2.colorSlope.b,l+=a,c+=h}r=i.projection.y-e.projection.y,this.colorInterpolator3.setup(e.color,i.color,r),n=(i.projection.x-e.projection.x)/r,a=(1/i.projection.z-1/e.projection.z)/r,u=e.projection.x,d=e.projection.y;for(let t=0;t<r;t++){const t=Math.round(f)-Math.round(u);this.rowColorInterpolator.setup(this.colorInterpolator3.startColor,this.colorInterpolator2.startColor,t);let e=Math.round(d)*this.framebuffer.width+Math.round(u);const i=(c-l)/t;let r=l;for(let o=0;o<t;o++)r<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=r,this.framebuffer.framebuffer[e]=this.rowColorInterpolator.startColor.toPackedFormat()),e++,r+=i,this.rowColorInterpolator.startColor.r+=this.rowColorInterpolator.colorSlope.r,this.rowColorInterpolator.startColor.g+=this.rowColorInterpolator.colorSlope.g,this.rowColorInterpolator.startColor.b+=this.rowColorInterpolator.colorSlope.b;u+=n,f+=s,d++,this.colorInterpolator2.startColor.r+=this.colorInterpolator2.colorSlope.r,this.colorInterpolator2.startColor.g+=this.colorInterpolator2.colorSlope.g,this.colorInterpolator2.startColor.b+=this.colorInterpolator2.colorSlope.b,this.colorInterpolator3.startColor.r+=this.colorInterpolator3.colorSlope.r,this.colorInterpolator3.startColor.g+=this.colorInterpolator3.colorSlope.g,this.colorInterpolator3.startColor.b+=this.colorInterpolator3.colorSlope.b,l+=a,c+=h}}fillLongLeftTriangle(t,e,i){let r=e.projection.y-t.projection.y;const o=i.projection.y-t.projection.y;this.colorInterpolator2.setup(t.color,e.color,r),this.colorInterpolator1.setup(t.color,i.color,o);let n=(e.projection.x-t.projection.x)/r;const s=(i.projection.x-t.projection.x)/o;let a=(1/e.projection.z-1/t.projection.z)/r;const h=(1/i.projection.z-1/t.projection.z)/o;let l=1/t.projection.z,c=1/t.projection.z,u=t.projection.x,f=t.projection.x,d=t.projection.y;for(let t=0;t<r;t++){const t=Math.round(f)-Math.round(u);this.rowColorInterpolator.setup(this.colorInterpolator1.startColor,this.colorInterpolator2.startColor,t);let e=Math.round(d)*this.framebuffer.width+Math.round(u);const i=(c-l)/t;let r=l;for(let o=0;o<t;o++)r<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=r,this.framebuffer.framebuffer[e]=this.rowColorInterpolator.startColor.toPackedFormat()),e++,r+=i,this.rowColorInterpolator.startColor.r+=this.rowColorInterpolator.colorSlope.r,this.rowColorInterpolator.startColor.g+=this.rowColorInterpolator.colorSlope.g,this.rowColorInterpolator.startColor.b+=this.rowColorInterpolator.colorSlope.b;u+=s,f+=n,d++,this.colorInterpolator1.startColor.r+=this.colorInterpolator1.colorSlope.r,this.colorInterpolator1.startColor.g+=this.colorInterpolator1.colorSlope.g,this.colorInterpolator1.startColor.b+=this.colorInterpolator1.colorSlope.b,this.colorInterpolator2.startColor.r+=this.colorInterpolator2.colorSlope.r,this.colorInterpolator2.startColor.g+=this.colorInterpolator2.colorSlope.g,this.colorInterpolator2.startColor.b+=this.colorInterpolator2.colorSlope.b,l+=h,c+=a}r=i.projection.y-e.projection.y,this.colorInterpolator3.setup(e.color,i.color,r),n=(i.projection.x-e.projection.x)/r,a=(1/i.projection.z-1/e.projection.z)/r,c=1/e.projection.z,f=e.projection.x,d=e.projection.y;for(let t=0;t<r;t++){const t=Math.round(f)-Math.round(u);this.rowColorInterpolator.setup(this.colorInterpolator1.startColor,this.colorInterpolator3.startColor,t);let e=Math.round(d)*this.framebuffer.width+Math.round(u);const i=(c-l)/t;let r=l;for(let o=0;o<t;o++)r<this.framebuffer.wBuffer[e]&&(this.framebuffer.wBuffer[e]=r,this.framebuffer.framebuffer[e]=this.rowColorInterpolator.startColor.toPackedFormat()),e++,r+=i,this.rowColorInterpolator.startColor.r+=this.rowColorInterpolator.colorSlope.r,this.rowColorInterpolator.startColor.g+=this.rowColorInterpolator.colorSlope.g,this.rowColorInterpolator.startColor.b+=this.rowColorInterpolator.colorSlope.b;u+=s,f+=n,d++,this.colorInterpolator1.startColor.r+=this.colorInterpolator1.colorSlope.r,this.colorInterpolator1.startColor.g+=this.colorInterpolator1.colorSlope.g,this.colorInterpolator1.startColor.b+=this.colorInterpolator1.colorSlope.b,this.colorInterpolator3.startColor.r+=this.colorInterpolator3.colorSlope.r,this.colorInterpolator3.startColor.g+=this.colorInterpolator3.colorSlope.g,this.colorInterpolator3.startColor.b+=this.colorInterpolator3.colorSlope.b,l+=h,c+=a}}}e.GouraudShadingTriangleRasterizer=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColorInterpolator=void 0;const r=i(7);e.ColorInterpolator=class{constructor(){this.startColor=new r.Color,this.colorSlope=new r.Color}setup(t,e,i){this.colorSlope.r=(e.r-t.r)/i,this.colorSlope.g=(e.g-t.g)/i,this.colorSlope.b=(e.b-t.b)/i,this.startColor.r=t.r,this.startColor.g=t.g,this.startColor.b=t.b}advance(){this.startColor.r+=this.colorSlope.r,this.startColor.g+=this.colorSlope.g,this.startColor.b+=this.colorSlope.b}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TexturedAlphaBlendingTriangleRasterizer=void 0;const r=i(1);e.TexturedAlphaBlendingTriangleRasterizer=class{constructor(t,e){this.framebuffer=t,this.pipeline=e,this.temp=null}drawTriangleDDA(t,e,i){if(t.position.y>i.position.y&&(this.temp=t,t=i,i=this.temp),t.position.y>e.position.y&&(this.temp=t,t=e,e=this.temp),e.position.y>i.position.y&&(this.temp=e,e=i,i=this.temp),t.position.y!==i.position.y){if((i.position.x-t.position.x)*(e.position.y-t.position.y)/(i.position.y-t.position.y)+t.position.x>e.position.x)this.fillLongRightTriangle2(t,e,i);else{const o=t.textureCoordinate,n=e.textureCoordinate,s=i.textureCoordinate;this.fillLongLeftTriangle2(t.position,e.position,i.position,new r.Vector3f(o.u,o.v,0),new r.Vector3f(n.u,n.v,0),new r.Vector3f(s.u,s.v,0))}}}fillLongRightTriangle2(t,e,i){let r=e.position.y-t.position.y;const o=i.position.y-t.position.y;let n=(e.position.x-t.position.x)/r;const s=(i.position.x-t.position.x)/o;let a=(e.textureCoordinate.u/e.position.z-t.textureCoordinate.u/t.position.z)/r;const h=(i.textureCoordinate.u/i.position.z-t.textureCoordinate.u/t.position.z)/o;let l=(e.textureCoordinate.v/e.position.z-t.textureCoordinate.v/t.position.z)/r;const c=(i.textureCoordinate.v/i.position.z-t.textureCoordinate.v/t.position.z)/o;let u=(1/e.position.z-1/t.position.z)/r;const f=(1/i.position.z-1/t.position.z)/o;let d=1/t.position.z,m=1/t.position.z,p=t.textureCoordinate.u/t.position.z,x=t.textureCoordinate.v/t.position.z,M=t.textureCoordinate.u/t.position.z,w=t.textureCoordinate.v/t.position.z,g=t.position.x,b=t.position.x,y=t.position.y;for(let t=0;t<r;t++){const t=Math.round(b)-Math.round(g);let e=Math.round(y)*this.framebuffer.width+Math.round(g);const i=(m-d)/t,r=(M-p)/t,o=(w-x)/t;let v=d,P=p,C=x;for(let n=0;n<t;n++){const t=this.framebuffer.framebuffer[e];if(v<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=v;const i=1/v,r=0|Math.max(Math.min(P*i*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),o=0|Math.max(Math.min(C*i*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),n=this.framebuffer.bob.texture[r+o*this.framebuffer.bob.width],s=this.pipeline.alpha*(n>>24&255)/255,a=1-s,h=(t>>0&255)*a+(n>>0&255)*s,l=(t>>8&255)*a+(n>>8&255)*s,c=(t>>16&255)*a+(n>>16&255)*s;this.framebuffer.framebuffer[e]=h|l<<8|c<<16|255<<24}e++,v+=i,P+=r,C+=o}g+=n,b+=s,y++,d+=u,m+=f,p+=a,M+=h,x+=l,w+=c}if(r=i.position.y-e.position.y,0!==r){n=(i.position.x-e.position.x)/r,u=(1/i.position.z-1/e.position.z)/r,a=(i.textureCoordinate.u/i.position.z-e.textureCoordinate.u/e.position.z)/r,l=(i.textureCoordinate.v/i.position.z-e.textureCoordinate.v/e.position.z)/r,d=1/e.position.z,p=e.textureCoordinate.u/e.position.z,x=e.textureCoordinate.v/e.position.z,g=e.position.x,y=e.position.y;for(let t=0;t<r;t++){const t=Math.round(b)-Math.round(g);let e=Math.round(y)*this.framebuffer.width+Math.round(g);const i=(m-d)/t,r=(M-p)/t,o=(w-x)/t;let v=d,P=p,C=x;for(let n=0;n<t;n++){if(v<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=v;const t=1/v,i=0|Math.max(Math.min(P*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(C*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width],n=this.pipeline.alpha*(o>>24&255)/255,s=1-n,a=(this.framebuffer.framebuffer[e]>>0&255)*s+(o>>0&255)*n,h=(this.framebuffer.framebuffer[e]>>8&255)*s+(o>>8&255)*n,l=(this.framebuffer.framebuffer[e]>>16&255)*s+(o>>16&255)*n;this.framebuffer.framebuffer[e]=a|h<<8|l<<16|255<<24}e++,v+=i,P+=r,C+=o}g+=n,b+=s,y++,d+=u,m+=f,p+=a,M+=h,x+=l,w+=c}}}fillLongLeftTriangle2(t,e,i,r,o,n){let s=e.y-t.y;const a=i.y-t.y;let h=(e.x-t.x)/s;const l=(i.x-t.x)/a,c=(n.x/i.z-r.x/t.z)/a;let u=(o.x/e.z-r.x/t.z)/s;const f=(n.y/i.z-r.y/t.z)/a;let d=(o.y/e.z-r.y/t.z)/s,m=(1/e.z-1/t.z)/s;const p=(1/i.z-1/t.z)/a;let x=t.x,M=t.x,w=1/t.z,g=1/t.z,b=r.x/t.z,y=r.y/t.z,v=r.x/t.z,P=r.y/t.z,C=t.x,T=t.x,S=t.y;for(let t=0;t<s;t++){const t=Math.round(T)-Math.round(C);let e=Math.round(S)*this.framebuffer.width+Math.round(C);const i=(g-w)/t,r=(v-b)/t,o=(P-y)/t;let n=w,s=b,a=y;for(let h=0;h<t;h++){if(n<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=n;const t=1/n,i=0|Math.max(Math.min(s*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(a*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width],h=this.pipeline.alpha*(o>>24&255)/255,l=1-h,c=(this.framebuffer.framebuffer[e]>>0&255)*l+(o>>0&255)*h,u=(this.framebuffer.framebuffer[e]>>8&255)*l+(o>>8&255)*h,f=(this.framebuffer.framebuffer[e]>>16&255)*l+(o>>16&255)*h;this.framebuffer.framebuffer[e]=c|u<<8|f<<16|255<<24}e++,n+=i,s+=r,a+=o}C+=l,T+=h,S++,x+=l,M+=h,w+=p,g+=m,b+=c,v+=u,y+=f,P+=d}s=i.y-e.y,h=(i.x-e.x)/s,m=(1/i.z-1/e.z)/s,u=(n.x/i.z-o.x/e.z)/s,d=(n.y/i.z-o.y/e.z)/s,M=e.x,g=1/e.z,v=o.x/e.z,P=o.y/e.z,T=e.x,S=e.y;for(let t=0;t<s;t++){const t=Math.round(T)-Math.round(C);let e=Math.round(S)*this.framebuffer.width+Math.round(C);const i=(g-w)/t,r=(v-b)/t,o=(P-y)/t;let n=w,s=b,a=y;for(let h=0;h<t;h++){if(n<this.framebuffer.wBuffer[e]){this.framebuffer.wBuffer[e]=n;const t=1/n,i=0|Math.max(Math.min(s*t*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(a*t*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),o=this.framebuffer.bob.texture[i+r*this.framebuffer.bob.width],h=this.pipeline.alpha*(o>>24&255)/255,l=1-h,c=(this.framebuffer.framebuffer[e]>>0&255)*l+(o>>0&255)*h,u=(this.framebuffer.framebuffer[e]>>8&255)*l+(o>>8&255)*h,f=(this.framebuffer.framebuffer[e]>>16&255)*l+(o>>16&255)*h;this.framebuffer.framebuffer[e]=c|u<<8|f<<16|255<<24}e++,n+=i,s+=r,a+=o}C+=l,T+=h,S++,x+=l,M+=h,w+=p,g+=m,b+=c,v+=u,y+=f,P+=d}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CohenSutherlandLineClipper=void 0;const r=i(2),o=i(1);class n{constructor(t){this.framebuffer=t}cohenSutherlandLineClipper(t,e,i){let s=new o.Vector3f(t.x,t.y,t.z),a=new o.Vector3f(e.x,e.y,e.z),h=this.computeRegionCode(s),l=this.computeRegionCode(a),c=!1,u=!1;for(;!u;)if(this.isTrivialAccept(h,l))c=!0,u=!0;else if(this.isTrivialReject(h,l))u=!0;else{if(h===n.REGION_CODE_CENTER){const t=h;h=l,l=t;const e=s;s=a,a=e}(h&n.REGION_CODE_TOP)!==n.REGION_CODE_CENTER?(s.x=s.x+(a.x-s.x)*(r.Framebuffer.maxWindow.y-s.y)/(a.y-s.y),s.y=r.Framebuffer.maxWindow.y):(h&n.REGION_CODE_BOTTOM)!==n.REGION_CODE_CENTER?(s.x=s.x+(a.x-s.x)*(r.Framebuffer.minWindow.y-s.y)/(a.y-s.y),s.y=r.Framebuffer.minWindow.y):(h&n.REGION_CODE_RIGHT)!==n.REGION_CODE_CENTER?(s.y=s.y+(a.y-s.y)*(r.Framebuffer.maxWindow.x-s.x)/(a.x-s.x),s.x=r.Framebuffer.maxWindow.x):(h&n.REGION_CODE_LEFT)!==n.REGION_CODE_CENTER&&(s.y=s.y+(a.y-s.y)*(r.Framebuffer.minWindow.x-s.x)/(a.x-s.x),s.x=r.Framebuffer.minWindow.x),h=this.computeRegionCode(s)}c&&this.framebuffer.drawLineDDA(s,a,i)}isTrivialAccept(t,e){return(t|e)===n.REGION_CODE_CENTER}isTrivialReject(t,e){return(t&e)!==n.REGION_CODE_CENTER}computeRegionCode(t){let e=n.REGION_CODE_CENTER;return t.x<r.Framebuffer.minWindow.x?e|=n.REGION_CODE_LEFT:t.x>r.Framebuffer.maxWindow.x&&(e|=n.REGION_CODE_RIGHT),t.y<r.Framebuffer.minWindow.y?e|=n.REGION_CODE_BOTTOM:t.y>r.Framebuffer.maxWindow.y&&(e|=n.REGION_CODE_TOP),e}}e.CohenSutherlandLineClipper=n,n.REGION_CODE_CENTER=0,n.REGION_CODE_LEFT=1,n.REGION_CODE_RIGHT=2,n.REGION_CODE_BOTTOM=4,n.REGION_CODE_TOP=8},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FullscreenUtils=void 0;class r{static toggleFullscreen(t){this.fullscreen?(r.exitFullscreen(),this.fullscreen=!1):(r.enterFullscreen(t),this.fullscreen=!0)}static enterFullscreen(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}static exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}}e.FullscreenUtils=r,r.fullscreen=!1},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextureUtils=e.Texture=void 0;var r=i(9);Object.defineProperty(e,"Texture",{enumerable:!0,get:function(){return r.Texture}});var o=i(23);Object.defineProperty(e,"TextureUtils",{enumerable:!0,get:function(){return o.TextureUtils}})},function(t,e,i){"use strict";i.r(e),e.default=i.p+"7ac69aefeb77efddca4311160ba48eb9.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlenderLoader=void 0;const r=i(46);e.BlenderLoader=class{static load(t){return fetch(t.default).then(t=>t.json()).then(t=>r.BlenderJsonParser.parse(t))}static loadWithTexture(t){return fetch(t.default).then(t=>t.json()).then(t=>r.BlenderJsonParser.getBlenderScene(t,!1))}constructor(){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ComputationalGeometryUtils=void 0;const r=i(0),o=i(47);e.ComputationalGeometryUtils=class{computeBoundingSphere(t){if(0===t.length)throw new Error("More than one vertex required.");if(1===t.length)return new o.Sphere(t[0],0);let e=new r.Vector4f(0,0,0,0),i=0;return t.forEach(t=>{e=e.add(new r.Vector4f(t.x,t.y,t.z,0))}),e=e.mul(1/t.length),t.forEach(t=>{i=Math.max(i,e.sub(t).length())}),new o.Sphere(e,i)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlenderJsonParser=void 0;const r=i(0),o=i(3),n=i(45);e.BlenderJsonParser=class{static parse(t,e=!1){const i=[];return t.forEach(t=>{const o=new Array,n=new Array;t.vertices.forEach(t=>{o.push(new r.Vector4f(t.x,t.y,t.z).mul(2))}),t.normals.forEach(t=>{n.push(e?new r.Vector4f(t.x,t.y,t.z).normalize().mul(-1):new r.Vector4f(t.x,t.y,t.z).normalize())});const s=[];t.faces.forEach(t=>{s.push({n1:t.normals[0],n2:t.normals[1],n3:t.normals[2],v1:t.vertices[0],v2:t.vertices[1],v3:t.vertices[2]})});const a={faces:s,normals:n,points:o,transformedNormals:n.map(()=>new r.Vector4f(0,0,0,0)),transformedPoints:o.map(()=>new r.Vector4f(0,0,0,0))};i.push(a)}),i}static getBlenderScene(t,e=!0,i=!1){const s=[];return t.forEach(t=>{const i=new Array,a=new Array;let h;t.uv&&(h=[],t.uv.forEach(t=>{const e=new o.TextureCoordinate;e.u=t.u,e.v=1-t.v,h.push(e)})),t.vertices.forEach(t=>{e?i.push(new r.Vector4f(t.x,t.y,t.z).mul(2).add(new r.Vector4f(0,-2.7,0,0))):i.push(new r.Vector4f(t.x,t.y,t.z).mul(2))}),t.normals.forEach(t=>{a.push(new r.Vector4f(t.x,t.y,t.z))});const l=(new n.ComputationalGeometryUtils).computeBoundingSphere(i);l.getCenter().w=1;const c={points:i,normals:a,uv:h,faces:t.faces,points2:i.map(()=>new r.Vector4f(0,0,0,0)),normals2:a.map(()=>new r.Vector4f(0,0,0,0)),boundingSphere:l,name:t.name};s.push(c)}),s}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sphere=void 0;e.Sphere=class{constructor(t,e){this.center=t,this.radius=e}isInsidePositiveHalfSpace(t){return t.getNormal().dot(this.center)-t.getDistance()>-this.radius}getTran(t){return t.multiplyHom(this.center)}getRadius(){return this.radius}getCenter(){return this.center}}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"1940711ae250abc4871bf563f44ab585.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=void 0;e.StreamReader=class{constructor(t,e=0){this.dataView=new DataView(t,e),this.position=0}readInt(){const t=this.dataView.getInt32(this.position,!0);return this.position+=4,t}readFloat(){const t=this.dataView.getFloat32(this.position,!0);return this.position+=4,t}readUnsignedInt8(){const t=this.dataView.getUint8(this.position);return this.position+=1,t}readSignedShort(){const t=this.dataView.getInt16(this.position,!0);return this.position+=2,t}readUnsigbnedShort(){const t=this.dataView.getUint16(this.position,!0);return this.position+=2,t}}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"aa2528d7a8a813247c2d2b90b028e437.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"3906531fedff1b81f85f5f9415a1e956.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"5211260c15f95de001ff416d5a098ceb.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;e.Utils=class{static clamp(t,e,i){return Math.min(Math.max(t,e),i)}static map(t,e,i,r,o){return r+(t-e)/(i-e)*(o-r)}static getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Cube=void 0;const r=i(4),o=i(22);class n extends o.AbstractGeometricObject{constructor(){super();const t=.5,e=[new r.Vector4f(-t,-t,-t),new r.Vector4f(t,-t,-t),new r.Vector4f(t,t,-t),new r.Vector4f(-t,t,-t),new r.Vector4f(-t,-t,t),new r.Vector4f(t,-t,t),new r.Vector4f(t,t,t),new r.Vector4f(-t,t,t)];this.buildMesh(e,[0,2,1,0,3,2,5,7,4,5,6,7,1,6,5,1,2,6,4,3,0,4,7,3,4,1,5,4,0,1,3,6,2,3,7,6])}}e.Cube=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlaneDeformationScene=void 0;const r=i(42),o=i(7),n=i(53);e.PlaneDeformationScene=class{constructor(t,e){this.effectStyle=t,this.texturePath=e}onInit(){}init(t){return Promise.all([r.TextureUtils.load(this.texturePath,!1).then(e=>{this.texture=e,this.createLUT(this.effectStyle,t.width,t.height,this.texture.width,this.texture.height)})])}createLUT(t,e,i,r,o){this.mLUT=new Int32Array(3*e*i);let s=0,a=0,h=0,l=0;for(let c=0;c<i;c++){const u=2*c/i-1;for(let i=0;i<e;i++){const c=2*i/e-1,f=Math.sqrt(c*c+u*u),d=Math.atan2(u,c),m=f;switch(t){case 1:a=Math.cos(d)/f,h=Math.sin(d)/f,l=2/(6*m+3*c)*-50;break;case 2:h=Math.sin(d+Math.cos(3*m))/Math.pow(m,.2),a=Math.cos(d+Math.cos(3*m))/Math.pow(m,.2),l=1;break;case 3:h=2/(6*m+3*c),a=3*d/Math.PI,l=25*-h;break;case 4:h=-.4/m+.1*Math.sin(8*d),a=.5+.5*d/Math.PI,l=0;break;case 5:a=(.02*u+.03)*Math.cos(3*d)/m,h=(.02*u+.03)*Math.sin(3*d)/m,l=0;break;case 6:a=1/(m+.5+.5*Math.sin(5*d)),h=3*d/Math.PI,l=0;break;case 7:a=.1*c/(.11+.5*m),h=.1*u/(.11+.5*m),l=0;break;case 8:a=c/Math.abs(u),h=1/Math.abs(u),l=10*-h;break;case 9:a=.5*d/Math.PI,h=Math.sin(2*m),l=0;break;case 10:h=Math.pow(m,.1),a=1*d/Math.PI+m,l=0;break;case 11:h=c*(3-Math.sqrt(4-5*m*m))/(m*m+1),a=u*(3-Math.sqrt(4-5*m*m))/(m*m+1),l=-130.9*(c+u+m*m-(c+u-1)*Math.sqrt(4-5*m*m)/3)/(m*m+1);break;default:a=c,h=u,l=0}this.mLUT[s++]=r*a&r-1,this.mLUT[s++]=o*h&o-1,this.mLUT[s++]=n.Utils.clamp(l,-255,255)}}return Promise.all([])}render(t,e){this.drawPlaneDeformation(t,e>>3,e>>3)}drawPlaneDeformation(t,e,i){for(let r=0;r<t.framebuffer.length;r++){const s=(r<<1)+r,a=this.mLUT[s+0]+i,h=this.mLUT[s+1]+e,l=this.mLUT[s+2];let c=this.texture.texture[this.texture.width*(h&this.texture.height-1)+(a&this.texture.width-1)];if(0!==l){let t=255&c,e=c>>8&255,i=c>>16&255;t+=l,e+=l,i+=l,t=n.Utils.clamp(t,0,255),e=n.Utils.clamp(e,0,255),i=n.Utils.clamp(i,0,255),c=new o.Color(t,e,i,255).toPackedFormat()}t.framebuffer[r]=c}}drawOldPlaneDeformationFloor(t,e){let i=0;for(let r=0;r<t.height;r++){const o=r-t.height/2,n=((1/Math.abs(o/100*.02)+.069*e)%256+256)%256,s=1-Math.min(1,1/Math.abs(o/10));for(let e=0;e<t.width;e++){const r=((e-t.width/2)/t.width/Math.abs(o/100*.02)%256+256)%256,a=this.texture.texture[(0|r)+256*(0|n)],h=(a>>0&255)*s|0,l=(a>>8&255)*s|0,c=(a>>16&255)*s|0;t.framebuffer[i++]=h|l<<8|c<<16|255<<24}}}drawOldPlaneDeformationStar(t,e){let i=0;for(let e=0;e<t.height;e++)for(let r=0;r<t.width;r++){const o=(r-t.width/2)/(t.width/2),n=(e-t.height/2)/(t.height/2),s=1,a=Math.atan2(n,o)+4e-4*Date.now(),h=128*(3*a/Math.PI+4e-4*Date.now())%256,l=(1/(Math.sqrt(o*o+n*n)+.5+.5*Math.sin(5*a))*32+.03*Date.now())%256,c=this.texture.texture[(0|l)+256*(0|h)],u=(c>>0&255)*s|0,f=(c>>8&255)*s|0,d=(c>>16&255)*s|0;t.framebuffer[i++]=u|f<<8|d<<16|255<<24}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Animation=void 0;class r{constructor(t,e,i){this.first=t,this.last=e,this.fps=i}}e.MD2Animation=r,r.STAND=new r(0,39,9),r.RUN=new r(40,45,10),r.ATTACK=new r(46,53,10),r.PAIN_A=new r(54,57,7),r.PAIN_B=new r(58,61,7),r.PAIN_C=new r(62,65,7),r.JUMP=new r(66,71,7),r.FLIP=new r(72,83,7),r.SALUTE=new r(84,94,7),r.FALLBACK=new r(95,111,10),r.WAVE=new r(112,122,7),r.POINTING=new r(123,134,6),r.CROUCH_STAND=new r(135,153,10),r.CROUCH_WALK=new r(154,159,7),r.CROUCH_ATTACK=new r(160,168,10),r.CROUCH_PAIN=new r(196,172,7),r.CROUCH_DEATH=new r(173,177,5),r.DEATH_FALLBACK=new r(178,183,7),r.DEATH_FALLFORWARD=new r(184,189,7),r.DEATH_FALLBACKSLOW=new r(190,197,7),r.BOOM=new r(198,198,5)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FontRenderer=void 0;const r=i(42);e.FontRenderer=class{constructor(t,e,i,r,o){this.framebuffer=t,this.width=e,this.height=i,this.file=o,this.charToIndex=new Map;for(let t=0;t<r.length;t++)this.addCharInex(r.charCodeAt(t),t)}init(){return Promise.all([r.TextureUtils.load(this.file,!0).then(t=>this.fontTexture=t)])}draw(){this.framebuffer.drawTextureRectFastAlpha(0,0,0,0,50,50,this.fontTexture)}drawText2(t,e,i){let r=t;const o=this.fontTexture.width/this.width;for(let t=0;t<i.length;t++){const n=i.charCodeAt(t),s=this.charToIndex.has(n)?this.charToIndex.get(n):0,a=Math.floor(s%o)*this.width,h=Math.floor(s/o)*this.height;this.framebuffer.drawTextureRectFastAlpha(r,e,a,h,this.width,this.height,this.fontTexture),r+=this.width}}drawText(t,e,i,r,o=!0){let n=t;const s=this.fontTexture.width/this.width,a=Math.floor(.07*r)%this.width,h=Math.floor(.07*r/this.width)%i.length;n-=a;for(let t=0;t<Math.floor(this.framebuffer.width/this.width+1);t++){const a=i.charCodeAt((t+h)%i.length),l=this.charToIndex.has(a)?this.charToIndex.get(a):0,c=Math.floor(l%s)*this.width,u=Math.floor(l/s)*this.height;this.drawTextureRectFastAlpha(n,e,c,u,this.width,this.height,this.fontTexture,r,o),n+=this.width}}drawTextureRectFastAlpha(t,e,i,r,o,n,s,a,h=!0){const l=Math.max(0,0-t),c=Math.min(t+o,this.framebuffer.width)-t;for(let o=l;o<c;o++){const l=h?Math.round(30*Math.sin(.004*a+.013*(t+o))):0;let c=i+o+r*s.width,u=t+o+(e+l)*this.framebuffer.width;for(let t=0;t<n;t++){const t=s.texture[c];4278190080&t&&(this.framebuffer.framebuffer[u]=t),c+=s.width,u+=this.framebuffer.width}}}addCharInex(t,e){this.charToIndex.set(t,e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ModelViewMatrix=void 0;const r=i(0);e.ModelViewMatrix=class{constructor(){this.currtentMatrix=new r.Matrix4f,this.tempMatrix=new r.Matrix4f,this.temp=new r.Matrix4f,this.transformation=new r.Matrix4f}getMatrix(){return this.currtentMatrix}setIdentity(){this.currtentMatrix.setIdentityMatrix()}multMatrix(t){this.currtentMatrix=this.currtentMatrix.multiplyMatrix(t)}trans(t,e,i){this.transformation.setTranslationMatrix(t,e,i),this.applyMat()}scal(t,e,i){this.transformation.setScaleMatrix(t,e,i),this.applyMat()}xRotate(t){this.transformation.setXRotationMatrix(t),this.applyMat()}yRotate(t){this.transformation.setYRotationMatrix(t),this.applyMat()}applyMat(){this.tempMatrix.multiply2(this.currtentMatrix,this.transformation),this.temp=this.currtentMatrix,this.currtentMatrix=this.tempMatrix,this.tempMatrix=this.temp}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TexturedMesh=void 0;e.TexturedMesh=class{}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InvalidFileFormatException=void 0;e.InvalidFileFormatException=class{constructor(t){this.message=t}}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"d3a35822a59e861527f48d3949879d6c.jsx"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Loader=void 0;const r=i(65),o=i(67),n=i(68),s=i(69),a=i(70),h=i(71),l=i(49);class c{static load(t){return fetch(t.default).then(t=>t.arrayBuffer()).then(t=>{try{return c.parse(t)}catch(t){console.error(t.message)}})}static parse(t){const e=c.getHeader(t);return new n.MD2Model(c.getTextureCoords(t,e),c.getTriangles(t,e),c.getFrames(t,e),e)}static getHeader(t){return new o.MD2Header(t)}static getSkins(t,e){const i=new Array;for(let r=0;r<e.numberOfSkins;r++){const o=new s.MD2Skin(t,e.skinsOffset+64*r);i.push(o)}return i}static getTextureCoords(t,e){const i=new Array,r=new l.StreamReader(t,e.texCoordsOffset);for(let t=0;t<e.numberOfTexCoords;t++)i.push(new a.MD2TexCoord(r,e));return i}static getTriangles(t,e){const i=new Array,r=new l.StreamReader(t,e.triangleOffset);for(let t=0;t<e.numberOfTriangles;t++)i.push(new h.MD2Triangle(r));return i}static getFrames(t,e){const i=new Array;for(let o=0;o<e.numberOfFrames;o++){const n=new r.MD2Frame(t,e.framesOffset+e.frameSize*o,e);i.push(n)}return i}constructor(){}}e.MD2Loader=c},function(t,e,i){"use strict";i.r(e),e.default=i.p+"83fbf02619944d02f165a5fa0c7b9203.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"1c679046e546d12399509394f8258610.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Frame=void 0;const r=i(0),o=i(66),n=i(49);e.MD2Frame=class{constructor(t,e=0,i){const s=new n.StreamReader(t,e),a=new r.Vector3f(s.readFloat(),s.readFloat(),s.readFloat());this.scale=a;const h=new r.Vector3f(s.readFloat(),s.readFloat(),s.readFloat());this.translate=h;const l=new n.StreamReader(t,e+40),c=new Array;for(let t=0;t<i.numberOfVertices;t++){const t=l.readUnsignedInt8(),e=l.readUnsignedInt8(),i=l.readUnsignedInt8(),n=l.readUnsignedInt8();c.push(new o.MD2Vertex(new r.Vector3f(t*a.x+h.x,e*a.y+h.y,i*a.z+h.z),n))}this.vertices=c}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Vertex=void 0;e.MD2Vertex=class{constructor(t,e){this.vector=t,this.normalIndex=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Header=void 0;const r=i(60),o=i(49);class n{constructor(t){if(!this.isValidMD2File(t))throw new r.InvalidFileFormatException("Not a valid MD2 file.");const e=new o.StreamReader(t);this.identifier=e.readInt(),this.version=e.readInt(),this.skinWidth=e.readInt(),this.skinHeight=e.readInt(),this.frameSize=e.readInt(),this.numberOfSkins=e.readInt(),this.numberOfVertices=e.readInt(),this.numberOfTexCoords=e.readInt(),this.numberOfTriangles=e.readInt(),this.numberOfGlCommands=e.readInt(),this.numberOfFrames=e.readInt(),this.skinsOffset=e.readInt(),this.texCoordsOffset=e.readInt(),this.triangleOffset=e.readInt(),this.framesOffset=e.readInt(),this.glCommandsOffset=e.readInt(),this.endOffset=e.readInt()}toString(){return JSON.stringify(this,null,2)}isValidMD2File(t){const e=new DataView(t,0),i=e.getInt32(0,!0),r=e.getInt32(4,!0);return i===n.IDP2&&r===n.VERSION}}e.MD2Header=n,n.IDP2=844121161,n.VERSION=8},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Model=void 0;const r=i(0),o=i(59),n=i(3),s=i(56);e.MD2Model=class{constructor(t,e,i,a){this.textureCoordinates=t,this.triangles=e,this.frames=i,this.header=a,this.animation=s.MD2Animation.STAND,this.currentFrame=0,this.loop=!1;const h=new o.TexturedMesh,l=new Array;this.textureCoordinates.forEach(t=>{l.push(new n.TextureCoordinate(t.s,t.t))});const c=new Array;for(let t=0;t<a.numberOfVertices;t++)c.push(new r.Vector4f(0,0,0,1));this.points=c,h.points=c,h.points2=c.map(()=>new r.Vector4f(0,0,0,0)),h.uv=l;const u=new Array;this.triangles.forEach(t=>{u.push({uv:t.texCoords,vertices:t.vertices})}),h.faces=u,this.mesh=h}getMesh(t){t*=.006;const e=Math.floor(t)%this.frames.length,i=(e+1)%this.frames.length,r=this.frames[e],o=this.frames[i],n=t-Math.floor(t),s=1-n;for(let t=0;t<r.vertices.length;t++){const e=r.vertices[t],i=o.vertices[t];this.points[t].x=e.vector.x*s+i.vector.x*n,this.points[t].y=e.vector.y*s+i.vector.y*n,this.points[t].z=e.vector.z*s+i.vector.z*n}return this.mesh}setAnim(t,e,i=!1){this.animation=t,this.currentFrame=0,this.loop=i}getMesh2(t){this.currentFrame+=.009*t,this.currentFrame>this.animation.last-this.animation.first&&(this.loop||(this.currentFrame=this.animation.last-this.animation.first));const e=this.animation.last-this.animation.first+1,i=Math.floor(this.currentFrame)%e,r=(i+1)%e,o=this.frames[i+this.animation.first],n=this.frames[r+this.animation.first],s=this.currentFrame-Math.floor(this.currentFrame),a=1-s;for(let t=0;t<o.vertices.length;t++){const e=o.vertices[t],i=n.vertices[t];this.points[t].x=e.vector.x*a+i.vector.x*s,this.points[t].y=e.vector.y*a+i.vector.y*s,this.points[t].z=e.vector.z*a+i.vector.z*s}return this.mesh}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Skin=void 0;const r=i(49);e.MD2Skin=class{constructor(t,e=0){const i=new r.StreamReader(t,e);let o;for(let t=0;t<64;t++){const t=i.readUnsignedInt8();if(0===t)break;o+=String.fromCharCode(t)}this.name=o}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2TexCoord=void 0;e.MD2TexCoord=class{constructor(t,e){this.s=t.readSignedShort()/(e.skinWidth-1),this.t=t.readSignedShort()/(e.skinHeight-1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MD2Triangle=void 0;e.MD2Triangle=class{constructor(t){this.vertices=[t.readUnsigbnedShort(),t.readUnsigbnedShort(),t.readUnsigbnedShort()],this.texCoords=[t.readUnsigbnedShort(),t.readUnsigbnedShort(),t.readUnsigbnedShort()]}}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"29fc676286325d45f7deef5e593b6da6.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"fe1ca8bac15e02a2d14cf9d558c69def.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"780c7edd8a9410b8261fdb12d9d6191d.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"c83bb5502d841707edd4423f41ebcca0.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"8f18731da1a9e273cf0432f3b1c862f1.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"5cf778e15448cf90b764416629d74108.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"dd142c00e8f6db275d9ecc2bda063c04.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SkyBox=void 0;const r=i(0),o=i(42),n=i(3);e.SkyBox=class{init(){return Promise.all([o.TextureUtils.load(i(72),!1).then(t=>this.back=t),o.TextureUtils.load(i(73),!1).then(t=>this.down=t),o.TextureUtils.load(i(74),!1).then(t=>this.front=t),o.TextureUtils.load(i(75),!1).then(t=>this.left=t),o.TextureUtils.load(i(76),!1).then(t=>this.right=t),o.TextureUtils.load(i(77),!1).then(t=>this.up=t)])}draw(t,e){this.drawSkyBox(t,e.getRotation())}drawSkyBox(t,e){const i=[this.back,this.left,this.front,this.right];let o,s,a;const h=[new r.Vector4f(1,1,-1,1),new r.Vector4f(-1,1,-1,1),new r.Vector4f(-1,-1,-1,1),new r.Vector4f(1,1,-1,1),new r.Vector4f(-1,-1,-1,1),new r.Vector4f(1,-1,-1,1)];for(let l=0;l<4;l++)o=e.multiplyMatrix(r.Matrix4f.constructXRotationMatrix(Math.PI).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(2*+Math.PI/4*l))),s=o.multiplyMatrix(r.Matrix4f.constructScaleMatrix(20,20,20)),a={normals:[],normals2:[],points:h,points2:h.map(t=>new r.Vector4f(0,0,0)),uv:[new n.TextureCoordinate(1,1),new n.TextureCoordinate(0,1),new n.TextureCoordinate(0,0),new n.TextureCoordinate(1,1),new n.TextureCoordinate(0,0),new n.TextureCoordinate(1,0)],faces:[{vertices:[0,1,2],uv:[0,1,2]},{vertices:[3,4,5],uv:[3,4,5]}]},t.setTexture(i[l]),t.texturedRenderingPipeline.setModelViewMatrix(s),t.texturedRenderingPipeline.draw(a);o=e.multiplyMatrix(r.Matrix4f.constructXRotationMatrix(Math.PI)).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(0).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(2*Math.PI/4*1).multiplyMatrix(r.Matrix4f.constructXRotationMatrix(2*-Math.PI/4)))),s=o.multiplyMatrix(r.Matrix4f.constructScaleMatrix(20,20,20)),a={normals:[],normals2:[],points:h,points2:h.map(t=>new r.Vector4f(0,0,0)),uv:[new n.TextureCoordinate(0,0),new n.TextureCoordinate(1,0),new n.TextureCoordinate(1,1),new n.TextureCoordinate(0,0),new n.TextureCoordinate(1,1),new n.TextureCoordinate(0,1)],faces:[{vertices:[0,1,2],uv:[0,1,2]},{vertices:[3,4,5],uv:[3,4,5]}]},t.setTexture(this.up),t.texturedRenderingPipeline.setModelViewMatrix(s),t.texturedRenderingPipeline.draw(a),o=e.multiplyMatrix(r.Matrix4f.constructXRotationMatrix(Math.PI)).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(0).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(2*Math.PI/2).multiplyMatrix(r.Matrix4f.constructXRotationMatrix(2*Math.PI/4)))),s=o.multiplyMatrix(r.Matrix4f.constructScaleMatrix(20,20,20)),a={normals:[],normals2:[],points:h,points2:h.map(t=>new r.Vector4f(0,0,0)),uv:[new n.TextureCoordinate(1,1),new n.TextureCoordinate(0,1),new n.TextureCoordinate(0,0),new n.TextureCoordinate(1,1),new n.TextureCoordinate(0,0),new n.TextureCoordinate(1,0)],faces:[{vertices:[0,1,2],uv:[0,1,2]},{vertices:[3,4,5],uv:[3,4,5]}]},t.setTexture(this.down),t.texturedRenderingPipeline.setModelViewMatrix(s),t.texturedRenderingPipeline.draw(a)}}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"3274091b249fafeb95e835d056a0fb34.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"0c5693868dfd1dffcc2d62dff38726f0.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TorusKnot=void 0;const r=i(4),o=i(22);class n extends o.AbstractGeometricObject{constructor(t=!1){super();const e=[];for(let t=0;t<80;t++){const i=this.torusFunction3(2*t*Math.PI/80),r=this.torusFunction3(2*t*Math.PI/80+.1),o=r.sub(i);let n=i.add(r).normalize();const s=o.cross(n).normalize().mul(26.4);n=s.cross(o).normalize().mul(26.4);for(let t=0;t<8;t++){const r=n.mul(Math.sin(2*t*Math.PI/8)).add(s.mul(Math.cos(2*t*Math.PI/8))).add(i);e.push(r.mul(1))}}const i=[];for(let t=0;t<80;t++)for(let r=0;r<8;r++)i.push((8*t+(1+r)%8)%e.length),i.push((8*t+(0+r)%8)%e.length),i.push((8*t+8+(1+r)%8)%e.length),i.push((8*t+8+(0+r)%8)%e.length),i.push((8*t+8+(1+r)%8)%e.length),i.push((8*t+(0+r)%8)%e.length);this.buildMesh(e,i,t)}torusFunction3(t){const e=.5*(2+Math.sin(3*t));return new r.Vector4f(e*Math.cos(2*t),e*Math.cos(3*t),e*Math.sin(2*t)).mul(70)}}e.TorusKnot=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinearFog=void 0;const r=i(0),o=i(100);class n extends o.Fog{constructor(t,e,i){super(),this.zStart=t,this.zEnd=e,this.fogColor=i}computeVertexColor(t,e){if(e.z>=this.zStart)return t;if(e.z<=this.zEnd)return this.fogColor;{const i=(this.zEnd-e.z)/(this.zEnd-this.zStart);return new r.Vector4f(t.x*i+this.fogColor.x*(1-i),t.y*i+this.fogColor.y*(1-i),t.z*i+this.fogColor.z*(1-i))}}}e.LinearFog=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Keyboard=void 0;class r{constructor(){this.pressed=new Array(256),this.pressed.fill(!1),window.addEventListener("keyup",t=>this.onKeyUp(t),!1),window.addEventListener("keydown",t=>this.onKeyDown(t),!1)}isDown(t){return this.pressed[t]}onKeyDown(t){this.pressed[t.keyCode]=!0}onKeyUp(t){this.pressed[t.keyCode]=!1}}e.Keyboard=r,r.LEFT=37,r.UP=38,r.RIGHT=39,r.DOWN=40,r.KEY_A=65,r.KEY_D=68,r.KEY_L=76},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerStandingState=void 0;const r=i(56),o=i(117),n=i(86);class s extends n.PlayerState{entry(){this.context.md2.setAnim(r.MD2Animation.STAND,0,!0)}upButton(){this.context.setState(new o.PlayerRunningState(this.context))}}e.PlayerStandingState=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerState=void 0;e.PlayerState=class{constructor(t){this.context=t}entry(){}exit(){}process(){}upButton(){}upButtonNot(){}}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"f47283da3b866a2856a596bdf1eec1dc.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"f0a2b83a6650a874e43584817f97e82b.md2"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"627a342d6eba738cf103d753bf442a3d.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"190c8de6aade7baacc90bbf521cdd4ba.jsx"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"76ae06b027ad8d3a84d87f9801f62db9.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"8a09527b06eeee9b52984520552f3610.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"59b860b8c26e2787d9a2d2c486ccb637.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"b067dd009dbd8781f1973feed20bb7eb.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"dbfe6f136c603b175357f30c0300be38.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"be59e5e60b44dcb4bb1ccf2535c21d20.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"35e5d4cac5e7ac4f18616422a728392d.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"5a8653ae080594924b2eb7a2dc743876.jpg"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"cb7b144b66415bfbb6f223071a7d23bd.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Fog=void 0;e.Fog=class{}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"f2b01e8ebcd0467bc5ee98bd9745c36b.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"ca65f62320a1c5496be703455da5e09a.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"d3132c4de2ae05ba66ad9637600796c5.png"},,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ThirdPersonCameraScene=void 0;const r=i(113),o=i(7),n=i(8),s=i(114),a=i(0),h=i(59),l=i(30),c=i(19),u=i(23),f=i(3),d=i(84),m=i(62),p=i(58),x=i(115),M=i(116);class w extends c.AbstractScene{constructor(){super(...arguments),this.lastTime=Date.now(),this.keyboard=new d.Keyboard,this.gamepad=new s.AisaGamepad,this.modelViewMatrix=new p.ModelViewMatrix,this.fpsStartTime=Date.now(),this.fpsCount=0,this.fps=0,this.player=new x.Player,this.camera=new r.ThirdPersonCamera,this.oldEye=new a.Vector3f(0,0,0),this.attack=!1,this.jump=!1,this.run=!1}init(t){return this.texturedRenderingPipeline=new l.TexturingRenderingPipeline(t),this.texturedRenderingPipeline.setCullFace(n.CullFace.FRONT),this.startTime=Date.now(),Promise.all([u.TextureUtils.load(i(87),!1).then(t=>this.ogroTexture=t),u.TextureUtils.load(i(118),!1).then(t=>this.weaponTexture=t),m.MD2Loader.load(i(88)).then(t=>this.md2=t),m.MD2Loader.load(i(119)).then(t=>this.weapon=t),u.TextureUtils.load(i(50),!0).then(t=>this.texture4=t),,u.TextureUtils.load(i(120),!0).then(t=>this.fontred=t),,u.TextureUtils.load(i(121),!0).then(t=>this.ground=t),u.TextureUtils.load(i(122),!0).then(t=>this.glow=t)]).then(()=>{this.playerStateMachine=new M.PlayerStateMachine(this.md2,this.player),window.addEventListener("gamepadconnected",t=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length)});const t=new h.TexturedMesh;t.points=[new a.Vector4f(-20,0,20),new a.Vector4f(20,0,20),new a.Vector4f(20,0,-20),new a.Vector4f(-20,0,-20)],t.uv=[new f.TextureCoordinate(0,0),new f.TextureCoordinate(1,0),new f.TextureCoordinate(1,1),new f.TextureCoordinate(0,1)],t.points2=t.points.map(()=>new a.Vector4f(0,0,0,0)),t.faces=[{uv:[0,1,2],vertices:[0,1,2]},{uv:[2,3,0],vertices:[2,3,0]}],this.floor=t})}processInput(t){this.keyboard.isDown(d.Keyboard.UP)&&this.playerStateMachine.upButton(),this.keyboard.isDown(d.Keyboard.UP)||this.playerStateMachine.upButtonNot();(this.keyboard.isDown(d.Keyboard.UP)||this.gamepad.isLeft(1,-1))&&this.player.moveForward(4.1,t),this.gamepad.isLeft(1,-1)&&!this.run&&(this.run=!0),!this.gamepad.isLeft(1,-1)&&this.run&&(this.run=!1),(this.keyboard.isDown(d.Keyboard.DOWN)||this.gamepad.isLeft(1,1))&&this.player.moveBackward(4.1,t),(this.keyboard.isDown(d.Keyboard.LEFT)||this.gamepad.isLeft(0,-1))&&this.player.turnLeft(110,t),(this.keyboard.isDown(d.Keyboard.RIGHT)||this.gamepad.isLeft(0,1))&&this.player.turnRight(110,t),this.gamepad.isButtonPressed(3)&&!this.attack&&(this.attack=!0),!this.gamepad.isButtonPressed(3)&&this.attack&&(this.attack=!1),this.gamepad.isButtonPressed(2)&&!this.jump&&(this.jump=!0),!this.gamepad.isButtonPressed(2)&&this.jump&&(this.jump=!1)}render(t){const e=Date.now(),i=(e-this.lastTime)/1e3;this.lastTime=e,e>this.fpsStartTime+1e3&&(this.fpsStartTime=e,this.fps=this.fpsCount,this.fpsCount=0),this.fpsCount++;Date.now(),this.startTime;this.processInput(i),t.clearColorBuffer(w.CLEAR_COLOR),t.clearDepthBuffer(),t.setTexture(this.ground),this.texturedRenderingPipeline.setCullFace(n.CullFace.BACK),this.computeFloorMovement(i),this.texturedRenderingPipeline.setModelViewMatrix(this.modelViewMatrix.getMatrix()),this.texturedRenderingPipeline.draw(this.floor),this.modelViewMatrix.trans(0,.1,0),this.computeGlowMovement(i,e),t.setTexture(this.glow),this.texturedRenderingPipeline.enableAlphaBlending(),this.texturedRenderingPipeline.setModelViewMatrix(this.modelViewMatrix.getMatrix()),this.texturedRenderingPipeline.draw(this.floor),this.texturedRenderingPipeline.disableAlphaBlending(),this.texturedRenderingPipeline.setCullFace(n.CullFace.FRONT),this.renderPlayer(t,i),t.drawText(8,8,"FPS: "+this.fps.toString(),this.texture4),t.drawText(8,16,"TRIANGELS: "+(this.md2.header.numberOfTriangles+this.weapon.header.numberOfTriangles),this.texture4),e%1e3>500&&t.drawText(8,184,this.gamepad.isAvailable()?"GAMEPAD DETECTED":"NO GAMEPAD DETECTED",this.fontred)}renderPlayer(t,e){this.computePlayerMovement(e),this.texturedRenderingPipeline.setModelViewMatrix(this.modelViewMatrix.getMatrix()),t.setTexture(this.ogroTexture),this.texturedRenderingPipeline.draw(this.md2.getMesh2(1e3*e)),t.setTexture(this.weaponTexture),this.texturedRenderingPipeline.draw(this.weapon.getMesh2(1e3*e))}computeFloorMovement(t){this.modelViewMatrix.setIdentity(),this.modelViewMatrix.multMatrix(this.getCamMatrix(t)),this.modelViewMatrix.trans(0,0,0),this.modelViewMatrix.yRotate(2*Math.PI/360*90)}getCamMatrix(t){const e=.6*t,i=this.oldEye.add(new a.Vector3f(this.player.position.x-5*this.player.getDirection().x,2.2,this.player.position.y-5*this.player.getDirection().y).sub(this.oldEye).mul(e));return this.oldEye=i,this.camera.computeMatrix(i,new a.Vector3f(this.player.position.x,1.8,this.player.position.y),new a.Vector3f(0,1,0))}computePlayerMovement(t){this.modelViewMatrix.setIdentity(),this.modelViewMatrix.multMatrix(this.getCamMatrix(t)),this.modelViewMatrix.trans(this.player.position.x,24*.05,this.player.position.y),this.modelViewMatrix.yRotate(2*Math.PI/360*(90+this.player.angle)),this.modelViewMatrix.xRotate(2*Math.PI/360*-90),this.modelViewMatrix.scal(.05,.05,.05)}computeGlowMovement(t,e){this.modelViewMatrix.setIdentity(),this.modelViewMatrix.multMatrix(this.getCamMatrix(t)),this.modelViewMatrix.trans(this.player.position.x,.03,this.player.position.y);this.modelViewMatrix.scal(.051,.051,.051),this.texturedRenderingPipeline.setAlpha(.7)}}e.ThirdPersonCameraScene=w,w.CLEAR_COLOR=o.Color.SLATE_GRAY.toPackedFormat()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ThirdPersonCamera=void 0;const r=i(0);e.ThirdPersonCamera=class{computeMatrix(t,e,i){const o=r.Matrix4f.constructTranslationMatrix(-t.x,-t.y,-t.z),n=t.sub(e).normalize(),s=i.cross(n).normalize(),a=n.cross(s),h=new r.Matrix4f;return h.m11=s.x,h.m12=s.y,h.m13=s.z,h.m14=0,h.m21=a.x,h.m22=a.y,h.m23=a.z,h.m24=0,h.m31=n.x,h.m32=n.y,h.m33=n.z,h.m34=0,h.m41=0,h.m42=0,h.m43=0,h.m44=1,h.multiplyMatrix(o)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AisaGamepad=void 0;e.AisaGamepad=class{constructor(){this.gamepad=null,window.addEventListener("gamepadconnected",t=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length),this.gamepad=t.gamepad})}isAvailable(){return null!==this.gamepad}isButtonPressed(t){return!!this.gamepad&&this.gamepad.buttons[t].pressed}isLeft(t,e){return!!this.gamepad&&this.gamepad.axes[t]===e}vl(){return this.gamepad.id}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;const r=i(0);e.Player=class{constructor(){this.position=new r.Vector2f(0,0),this.angle=0}moveForward(t,e){const i=t*e;this.position.x+=i*-Math.sin(2*Math.PI/360*this.angle),this.position.y+=i*-Math.cos(2*Math.PI/360*this.angle)}moveBackward(t,e){const i=t*e;this.position.x-=i*-Math.sin(2*Math.PI/360*this.angle),this.position.y-=i*-Math.cos(2*Math.PI/360*this.angle)}getDirection(){return new r.Vector2f(-Math.sin(2*Math.PI/360*this.angle),-Math.cos(2*Math.PI/360*this.angle))}turnLeft(t,e){const i=t*e;this.angle+=i}turnRight(t,e){const i=t*e;this.angle-=i}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerStateMachine=void 0;const r=i(85);e.PlayerStateMachine=class{constructor(t,e){this.pl=e,this.activeState=null,this.md2=t,this.setState(new r.PlayerStandingState(this))}upButton(){this.activeState.upButton()}upButtonNot(){this.activeState.upButtonNot()}setState(t){null!==this.activeState&&this.activeState.exit(),this.activeState=t,this.activeState.entry()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerRunningState=void 0;const r=i(56),o=i(85),n=i(86);class s extends n.PlayerState{entry(){this.context.md2.setAnim(r.MD2Animation.RUN,0,!0)}upButtonNot(){this.context.setState(new o.PlayerStandingState(this.context))}}e.PlayerRunningState=s},function(t,e,i){"use strict";i.r(e),e.default=i.p+"167c00bfa49bddd5ecd044f4a2c2bac7.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"608c064515c98e1fd2d9f3f95fcb5f9c.md2"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"d12a4a13883e26a714cdb57bcff314f4.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"2b2983e86d6555fefb86e2beabb55feb.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"deadf21897808097d293d4f228b97c00.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractCube=void 0;const r=i(8),o=i(20),n=i(21),s=i(19),a=i(9),h=i(23),l=i(44);class c extends s.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.renderingPipeline=new n.FlatShadingRenderingPipeline(t),this.renderingPipeline.setCullFace(r.CullFace.BACK),Promise.all([l.BlenderLoader.load(i(124)).then(t=>this.scene=t),h.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),h.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t,e){t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawBlenderScene2(t,e);const i=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene2(t,e){t.clearDepthBuffer();const i=o.Matrix4f.constructTranslationMatrix(0,0,-12).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(2e-4*e).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(2e-4*e)));let r=i.multiplyMatrix(o.Matrix4f.constructScaleMatrix(5,16,5)),n=this.scene[0];this.renderingPipeline.draw(n,r),r=i.multiplyMatrix(o.Matrix4f.constructZRotationMatrix(.5*Math.PI*t.cosineInterpolate(0,600,Math.floor(.7*e)%4e3)).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(.5*Math.PI*t.cosineInterpolate(2e3,2600,Math.floor(.7*e)%4e3)))),n=this.scene[1],this.renderingPipeline.draw(n,r)}}e.AbstractCube=c},function(t,e,i){"use strict";i.r(e),e.default=i.p+"cdc0b80877df29ca96d4a05162fc8a1a.jsx"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BakedLighting=void 0;const r=i(8),o=i(20),n=i(19),s=i(79),a=i(9),h=i(23),l=i(44);class c extends n.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),t.setCullFace(r.CullFace.BACK),this.skyBox=new s.SkyBox,Promise.all([this.skyBox.init(),l.BlenderLoader.loadWithTexture(i(126)).then(t=>this.blenderObj8=t),h.TextureUtils.load(i(89),!1).then(t=>this.baked=t),h.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t,e){t.texturedRenderingPipeline.setCullFace(r.CullFace.BACK),this.drawBlenderScene7(t,e-11e5);const i=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene7(t,e){e*=.2,t.clearDepthBuffer();const i=o.Matrix4f.constructTranslationMatrix(0,0,17*(.5*Math.sin(7e-5*e)+.5)-134).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(6e-4*e).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(5e-4*-e).multiplyMatrix(o.Matrix4f.constructTranslationMatrix(0,-25,0)))).multiplyMatrix(o.Matrix4f.constructScaleMatrix(13,13,13));this.skyBox.draw(t,i),t.clearDepthBuffer(),t.setTexture(this.baked),t.texturedRenderingPipeline.setModelViewMatrix(i),t.texturedRenderingPipeline.drawMeshArray(this.blenderObj8)}}e.BakedLighting=c},function(t,e,i){"use strict";i.r(e),e.default=i.p+"c0190c8ec953bd7420ee373319a3f0c1.jsx"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockFade=e.TransitionMethods=void 0;const r=i(53),o=i(28),n=i(19),s=i(42);var a;!function(t){t[t.FADEIN=1]="FADEIN",t[t.FADEOUT=2]="FADEOUT",t[t.BLOCKFADE=3]="BLOCKFADE",t[t.CROSSFADE=4]="CROSSFADE",t[t.CIRCLE=5]="CIRCLE",t[t.WIPE=6]="WIPE",t[t.RADIAL=7]="RADIAL"}(a=e.TransitionMethods||(e.TransitionMethods={}));class h extends n.AbstractScene{constructor(){super(...arguments),this.startTime=Date.now()}init(t){return this.transitionTemp=new s.Texture(new Uint32Array(t.width*t.height),t.width,t.height),Promise.all([s.TextureUtils.load(i(48),!1).then(t=>this.ledTexture=t),s.TextureUtils.load(i(128),!1).then(t=>this.transitionWipe=t),s.TextureUtils.load(i(129),!1).then(t=>this.transitionRadial=t),s.TextureUtils.load(i(130),!1).then(t=>this.transitionCircle=t)])}render(t){const e=Date.now()-this.startTime;t.clear(),this.blockFade(t,this.ledTexture,e,0)}transition(t,e,i,o,n,s){switch(i.render(t,s),t.fastFramebufferCopy(this.transitionTemp.texture,t.framebuffer),e.render(t,s),o){case a.BLOCKFADE:this.blockFade(t,this.transitionTemp,r.Utils.map(n,0,255,0,12e3),0);break;case a.CROSSFADE:this.crossFade(t,this.transitionTemp,r.Utils.map(n,0,255,0,512));break;case a.FADEIN:this.fadeIn(t,this.transitionTemp,n,0);break;case a.FADEOUT:this.fadeOut(t,this.transitionTemp,n,0);break;case a.WIPE:this.crossFadeImage(t,this.transitionTemp,r.Utils.map(n,0,255,0,512),this.transitionWipe);break;case a.RADIAL:this.crossFadeImage(t,this.transitionTemp,r.Utils.map(n,0,255,0,512),this.transitionRadial);break;case a.CIRCLE:this.crossFadeImage(t,this.transitionTemp,r.Utils.map(n,0,255,0,512),this.transitionCircle);break;default:this.crossFade(t,this.transitionTemp,r.Utils.map(n,0,255,0,12e3))}}blockFade(t,e,i,r){const n=new Array(160),s=new o.default;s.setSeed(366);for(let t=0;t<10;t++)for(let e=0;e<16;e++)n[e+16*t]=500+Math.round(6e5*s.getFloat())%1e4;for(let o=0;o<10;o++)for(let s=0;s<16;s++)t.drawTextureRect(20*s,20*o,20*s,20*o,20,20,e,t.interpolate(r+n[s+16*o],r+n[s+16*o]+700,i))}crossFade(t,e,i){for(let o=0;o<t.height;o++)for(let n=0;n<t.width;n++)t.drawPixel(n,o,t.blend(t.framebuffer[n+o*t.width],e.texture[n+o*t.width],r.Utils.clamp(i,0,255)))}crossFadeImage(t,e,i,o){for(let n=0;n<t.height;n++)for(let s=0;s<t.width;s++)t.drawPixel(s,n,t.blend(t.framebuffer[s+n*t.width],e.texture[s+n*t.width],r.Utils.clamp(i-(o.texture[s+n*t.width]>>8&255),0,255)))}fadeIn(t,e,i,r){for(let o=0;o<t.height;o++)for(let n=0;n<t.width;n++)t.drawPixel(n,o,t.blend(r,e.texture[n+o*t.width],i))}fadeOut(t,e,i,r){for(let o=0;o<t.height;o++)for(let n=0;n<t.width;n++)t.drawPixel(n,o,t.blend(e.texture[n+o*t.width],r,i))}}e.BlockFade=h},function(t,e,i){"use strict";i.r(e),e.default=i.p+"971bf4bd499a162d305d6f11bdedb333.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"4e4fa63bed749506159dfe1772904714.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"afd81e746758e690c29a6f703fc6e269.png"},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BumpMap=void 0;const r=i(19),o=i(9),n=i(23);class s extends r.AbstractScene{init(t){this.normals=new Array(t.width*t.height),this.phong=new o.Texture(new Uint32Array(65536),256,256);for(let t=0;t<255;t++)for(let e=0;e<255;e++){const i=(t-128)/128,r=(e-128)/128;let o=1-Math.sqrt(i*i+r*r);o<0&&(o=0);const n=255&Math.round(255*o);this.phong.texture[t+256*e]=n|n<<8|n<<16|255<<24}return Promise.all([n.TextureUtils.load(i(133),!1).then(t=>this.map=t),n.TextureUtils.load(i(134),!1).then(t=>this.bump=t)]).then(()=>{let e=0;for(let i=0;i<t.height;i++)for(let r=0;r<t.width;r++){const t=(255&this.bump.getPixel3(this.bump,r-1,i))-(255&this.bump.getPixel3(this.bump,r+1,i)),o=(255&this.bump.getPixel3(this.bump,r,i-1))-(255&this.bump.getPixel3(this.bump,r,i+1));this.normals[e++]=[t,o]}})}render(t,e){let i=0;const r=-Math.sin(2*e*8e-4)*(t.width/2)-t.width/2,o=-Math.sin(3*e*8e-4)*(t.height/2)-t.height/2;for(let e=0;e<t.height;e++)for(let n=0;n<t.width;n++){const s=n+r,a=e+o,h=this.normals[i],l=-h[0]-s+128|0,c=-h[1]-a+128|0,u=this.phong.getPixel2(this.phong,Math.max(0,Math.min(l,255)),Math.max(0,Math.min(c,255))),f=Math.min(80+(255&u),255)/255,d=this.map.texture[i],m=d>>0&255,p=d>>8&255,x=d>>16&255;t.framebuffer[i++]=Math.round(m*f)|Math.round(p*f)<<8|Math.round(x*f)<<16|255<<24}}}e.BumpMap=s},function(t,e,i){"use strict";i.r(e),e.default=i.p+"f07125dd4d9001872d18278db85623a4.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"cea0bca78f8deb1e570693b1c99ee713.png"},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubeTunnelScene=void 0;const r=i(7),o=i(8),n=i(54),s=i(20),a=i(28),h=i(21),l=i(19),c=i(0),u=i(27),f=i(25);class d extends l.AbstractScene{constructor(){super(...arguments),this.cubeMesh=new n.Cube}init(t){this.accumulationBuffer=new Uint32Array(t.width*t.height),t.setCullFace(o.CullFace.BACK),this.renderingPipeline=new h.FlatShadingRenderingPipeline(t);const e=new f.PointLight;e.ambientIntensity=new c.Vector4f(1,1,1,1),e.diffuseIntensity=new c.Vector4f(1,1,1,1),e.specularIntensity=new c.Vector4f(1,1,1,1),e.position=new c.Vector4f(0,0,-10,1),this.renderingPipeline.setLights([e]);const i=new u.Material;return i.ambientColor=new c.Vector4f(.12,.14,.1,0),i.diffuseColor=new c.Vector4f(.38,.4,.4,1),i.specularColor=new c.Vector4f(.8,.5,.5,0),i.shininess=2,this.renderingPipeline.setMaterial(i),Promise.all([])}render(t,e){t.clearColorBuffer(d.BACKGROUND_COLOR),t.clearDepthBuffer();const i=new a.default;i.setSeed(22);for(let t=0;t<40;t++){const r=.3*i.getFloat()+.2;for(let o=0;o<25;o++){const n=2.3*i.getFloat()+.7+.2*Math.sin(.0044*e+3*i.getFloat()),a=39*.7,h=s.Matrix4f.constructXRotationMatrix(.2*Math.sin(44e-5*e)).multiplyMatrix(s.Matrix4f.constructYRotationMatrix(.2*Math.sin(4e-4*e)).multiplyMatrix(s.Matrix4f.constructTranslationMatrix(0,0,-20-(.7*t+.002*e)%a+a).multiplyMatrix(s.Matrix4f.constructZRotationMatrix(2*Math.PI/25*o+e*r*.002+.2*t).multiplyMatrix(s.Matrix4f.constructTranslationMatrix(3,0,0).multiplyMatrix(s.Matrix4f.constructScaleMatrix(n,.5,.5))))));this.renderingPipeline.draw(this.cubeMesh.getMesh(),h)}}}}e.CubeTunnelScene=d,d.BACKGROUND_COLOR=r.Color.DARK_GRAY.toPackedFormat()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubeScene=void 0;const r=i(7),o=i(8),n=i(54),s=i(0),a=i(21),h=i(19);class l extends h.AbstractScene{constructor(){super(...arguments),this.cubeMesh=new n.Cube}init(t){return t.setCullFace(o.CullFace.BACK),this.renderingPipeline=new a.FlatShadingRenderingPipeline(t),Promise.all([])}render(t,e){const i=.02*e;t.clearColorBuffer(l.BACKGROUND_COLOR),t.clearDepthBuffer(),this.renderingPipeline.draw(this.cubeMesh.getMesh(),this.getModelViewMatrix(i))}renderBackground(t,e){const i=.02*e;t.clearDepthBuffer(),this.renderingPipeline.draw(this.cubeMesh.getMesh(),this.getModelViewMatrix(i))}getModelViewMatrix(t){return s.Matrix4f.constructTranslationMatrix(0,0,-9).multiplyMatrix(s.Matrix4f.constructScaleMatrix(3.2,3.2,3.2).multiplyMatrix(s.Matrix4f.constructYRotationMatrix(.05*t)).multiplyMatrix(s.Matrix4f.constructXRotationMatrix(.08*t)))}}e.CubeScene=l,l.BACKGROUND_COLOR=r.Color.BLACK.toPackedFormat()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetalHeadzScene=void 0;const r=i(8),o=i(0),n=i(19),s=i(79),a=i(42),h=i(44);class l extends n.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),t.setCullFace(r.CullFace.BACK),this.skyBox=new s.SkyBox,Promise.all([this.skyBox.init(),h.BlenderLoader.loadWithTexture(i(90)).then(t=>this.blenderObjMetal=t),a.TextureUtils.load(i(78),!1).then(t=>this.metalheadz=t),a.TextureUtils.load(i(91),!0).then(t=>this.texture11=t),a.TextureUtils.load(i(92),!0).then(t=>this.texture13=t),a.TextureUtils.generateProceduralNoise().then(t=>this.noise=t),a.TextureUtils.load(i(93),!0).then(t=>this.dirt=t)])}render(t,e){t.texturedRenderingPipeline.setCullFace(r.CullFace.BACK);const i=.2*e;t.clearDepthBuffer();const n=this.computeCameraMovement(i),s=n.multiplyMatrix(o.Matrix4f.constructScaleMatrix(7,7,7));this.skyBox.draw(t,s),t.clearDepthBuffer(),t.setTexture(this.metalheadz);const h=t.texturedRenderingPipeline;h.setModelViewMatrix(s),h.drawMeshArray(this.blenderObjMetal);const l=t.project(n.getRotation().multiply(new o.Vector3f(22,40,-18)));t.drawLensFlare(l,1.2*i,[{tex:this.texture11,scale:2.3,alpha:.5},{tex:this.texture13,scale:1.6,alpha:.25},{tex:this.texture13,scale:.7,alpha:.22},{tex:this.texture13,scale:-.4,alpha:.22}],this.dirt);const c=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,c,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}computeCameraMovement(t){return o.Matrix4f.constructTranslationMatrix(0,0,17*(.5*Math.sin(7e-5*t)+.5)-134).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(8e-4*t).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(9e-4*-t).multiplyMatrix(o.Matrix4f.constructTranslationMatrix(0,0,0))))}}e.MetalHeadzScene=l},function(t,e,i){"use strict";i.r(e),e.default=i.p+"9003a9d97f4e76a622510d33cb5a9680.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlaneDeformationFloorScene=void 0;const r=i(19),o=i(23),n=i(55),s=i(57);class a extends r.AbstractScene{constructor(){super(...arguments),this.startTime=Date.now(),this.PlaneDeformationFloorScene=new n.PlaneDeformationScene(8,i(51))}init(t){return this.fontRenderer2=new s.FontRenderer(t,32,32," !\"    '    ,-. 0123456789:; = ? ABCDEFGHIJKLMNOPQRSTUVWXYZ ",i(80)),Promise.all([o.TextureUtils.load(i(81),!0).then(t=>this.hoodlumLogo=t),this.fontRenderer2.init(),this.PlaneDeformationFloorScene.init(t)])}render(t,e){this.PlaneDeformationFloorScene.drawPlaneDeformation(t,e>>3,0),this.fontRenderer2.drawText(0,t.height-32-16,"              WELCOME TO A NEW RELEASE FROM YOUR FRIENDS IN CRIME! HOW DO YOU LIKE THIS INTRO?",.8*(e-this.startTime),!1),t.drawTexture(0,t.height/2-this.hoodlumLogo.height/2|0,this.hoodlumLogo,1)}}e.PlaneDeformationFloorScene=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlaneDeformationTunnelScene=void 0;const r=i(19),o=i(42),n=i(29),s=i(55);class a extends r.AbstractScene{init(t){return this.scaleClipBlitter=new n.ScaleClipBlitter(t),this.PlaneDeformationScene=new s.PlaneDeformationScene(3,i(142)),Promise.all([o.TextureUtils.load(i(52),!0).then(t=>this.hoodlumLogo=t),this.PlaneDeformationScene.init(t)])}render(t,e){this.PlaneDeformationScene.render(t,e);const i=e%(6e4/140*2),r=35*(t.cosineInterpolate(0,15,i)-t.cosineInterpolate(15,200,i)+.4*t.cosineInterpolate(200,300,i)-.4*t.cosineInterpolate(300,400,i));this.scaleClipBlitter.drawScaledTextureClip(t.width/2-(this.hoodlumLogo.width+r)/2|0,t.height/2-(this.hoodlumLogo.height-r)/2|0,this.hoodlumLogo.width+r,this.hoodlumLogo.height-r|0,this.hoodlumLogo,1)}}e.PlaneDeformationTunnelScene=a},function(t,e,i){"use strict";i.r(e),e.default=i.p+"dde80f7d8d6c1038a9b029af6509cf8f.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlasmaScene=void 0;const r=i(19),o=i(0),n=i(7);class s extends r.AbstractScene{constructor(){super(...arguments),this.GRADIENTLEN=1500,this.SWINGLEN=3*this.GRADIENTLEN,this.SWINGMAX=this.GRADIENTLEN/2-1}init(t){return this.makeGradient(this.GRADIENTLEN),this.makeSwingCurve(this.SWINGLEN,this.SWINGMAX),Promise.all([])}render(t,e){this.drawPlasma(t,e)}makeSwingCurve(t,e){this.swingCurve=new Array(this.SWINGLEN);const i=e/2;for(let e=0;e<t;e++){const r=e*(2*Math.PI)/t;this.swingCurve[e]=Math.round(Math.cos(2*r)*Math.cos(3*r)*Math.cos(6*r)*i+i)}}makeGradient(t){this.colorGrad=new Array(this.GRADIENTLEN);for(let e=0;e<t;e++){const i=this.cos256(t/2,e+818),r=this.cos256(t/4,e+1095),o=this.cos256(t/4,e+1351);this.colorGrad[e]=new n.Color(i,r,o,255).toPackedFormat()}}cos256(t,e){return Math.trunc(127*Math.cos(e*(2*Math.PI)/t)+127)}swing(t){return this.swingCurve[t%this.SWINGLEN]}gradient(t){return this.colorGrad[t%this.GRADIENTLEN]}drawPlasma(t,e){let i=0;const r=Math.trunc(e>>3),o=this.swing(r);for(let e=0;e<t.height;e++){const n=this.swing(e),s=this.swing(e+r);for(let e=0;e<t.width;e++)t.framebuffer[i++]=this.gradient(this.swing(this.swing(e+o)+s)+this.swing(this.swing(e+r)+n))}}drawOldSchoolPlasma(t,e){const i=7e-4*e*1,r=new o.Vector3f(Math.sin(i),Math.cos(i),0),n=new o.Vector3f(235,115,0).add(new o.Vector3f(235*Math.sin(-i),115*Math.cos(-i),0)),s=new o.Vector3f(0,0,0);let a=0;for(let e=0;e<t.height;e++)for(let o=0;o<t.width;o++){const h=.5*Math.sin(.02*(o*r.x+e*r.y)+i+1);s.x=o-n.x,s.y=e-n.y;const l=.5*(.5*(Math.cos(.03*s.length())+1)+h),c=.5*(Math.cos(Math.PI*l/.5+i)+1)*255,u=.5*(Math.sin(Math.PI*l/.5+i)+1)*255,f=.5*(Math.sin(i)+1)*255;t.framebuffer[a++]=255<<24|f<<16|u<<8|c}}}e.PlasmaScene=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DofBallsScene=void 0;const r=i(20),o=i(1),n=i(19),s=i(9),a=i(23);class h extends n.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.start=Date.now(),Promise.all([a.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),a.TextureUtils.load(i(145),!0).then(t=>this.particleTexture2=t),a.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t,e){t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawParticleTorus(t,e,this.particleTexture2,!0);const i=new s.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.6),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}computeDepthBlur(t,e,i,r){let o;return o=r>e?(r-e)/(t-e):(r-e)/(i-e),Math.min(o,1)}drawParticleTorus(t,e,i,n=!1){n||t.clearColorBuffer(-13617080),t.clearDepthBuffer();const s=new Array;for(let t=0;t<50;t++){const i=5.2*Math.cos(t*Math.PI*2/50*3.7+.0016*e),r=.4*(t-25),n=5.2*Math.sin(t*Math.PI*2/50*3.7+.0016*e);s.push(new o.Vector3f(i,r,n))}const a=r.Matrix4f.constructTranslationMatrix(0,0,-12).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(4e-4*e).multiplyMatrix(r.Matrix4f.constructXRotationMatrix(4e-4*e))),h=new Array(s.length);s.forEach(e=>{h.push(t.project(a.multiply(e)))}),h.sort((t,e)=>t.z-e.z),h.forEach(e=>{const r=-846.8/e.z,o=Math.round(13*this.computeDepthBlur(0,-15,-70,e.z));t.drawParticle2Sub(e.x-r/2,e.y-r/2,r,r,i,1/e.z,1,o,128)})}}e.DofBallsScene=h},function(t,e,i){"use strict";i.r(e),e.default=i.p+"8cac1eea6b337bec7dab2e78b989f1d7.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DistortedSphereScene=void 0;const r=i(2),o=i(0),n=i(19),s=i(23),a=i(5),h=i(3),l=i(7),c=i(8);class u extends n.AbstractScene{init(t){return Promise.all([s.TextureUtils.load(i(94),!1).then(t=>this.heightmapSphere=t),s.TextureUtils.load(i(95),!1).then(t=>this.env=t)]).then(()=>{this.obj=this.createSphereDistplaced(this.heightmapSphere)})}render(t,e){t.setCullFace(c.CullFace.BACK),t.setTexture(this.env);const i=.002*e;let r=o.Matrix4f.constructScaleMatrix(3.7,3.7,3.7).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(.35*i).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(.3*i)));r=o.Matrix4f.constructTranslationMatrix(-0,-0,-10-6*(.5*Math.sin(.3*i)+.5)).multiplyMatrix(r),t.clearDepthBuffer(),t.clearColorBuffer(l.Color.BLACK.toPackedFormat()),this.shadingSphereEnvDisp2(t,2e-4*e,r)}createSphere(){const t=[new o.Vector4f(0,-1,0),new o.Vector4f(1,0,0),new o.Vector4f(0,0,1),new o.Vector4f(-1,0,0),new o.Vector4f(0,0,-1),new o.Vector4f(0,1,0)],e=this.divideSphere(t,[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1],4),i=[],r=[],n=[],s=[],a=[];return e.index.forEach(t=>{const r=e.points[t],o=i.find(t=>t.sub(r).length()<.001);if(o){const t=i.indexOf(o);a.push(t)}else a.push(i.push(r)-1)}),i.forEach(t=>{n.push(new o.Vector4f(0,0,0)),s.push(new o.Vector4f(0,0,0)),r.push(new o.Vector4f(0,0,0))}),{points:i,points2:r,normals:n,normals2:s,index:a}}divideSphere(t,e,i){const r=[],o=[],n=[];let s=0;for(let i=0;i<e.length;i+=3){const a=t[e[i]],h=t[e[i+1]],l=t[e[i+2]],c=h.sub(a).mul(.5).add(a).normalize(),u=l.sub(h).mul(.5).add(h).normalize(),f=a.sub(l).mul(.5).add(l).normalize();r.push(a),r.push(c),r.push(f),o.push(a),o.push(c),o.push(f),n.push(s++),n.push(s++),n.push(s++),r.push(c),r.push(h),r.push(u),o.push(c),o.push(h),o.push(u),n.push(s++),n.push(s++),n.push(s++),r.push(c),r.push(u),r.push(f),o.push(c),o.push(u),o.push(f),n.push(s++),n.push(s++),n.push(s++),r.push(f),r.push(u),r.push(l),o.push(f),o.push(u),o.push(l),n.push(s++),n.push(s++),n.push(s++)}return i>0?this.divideSphere(r,n,--i):{points:r,normals:o,index:n}}createSphereDistplaced(t){const e=this.createSphere(),i=new Array;return e.points.forEach(e=>{const r=e.x,o=e.y,n=e.z,s=Math.floor(255*(.5+Math.atan2(n,r)/(2*Math.PI))),a=Math.floor(255*(.5-Math.asin(o)/Math.PI)),h=1+(255&t.texture[s+256*a])/255*1.4;i.push(e.mul(h))}),e.points=i,e}shadingSphereEnvDisp2(t,e,i){const n=this.obj;Math.sin(1.8*e);for(let t=0;t<n.points.length;t++){const i=n.points[t].z,r=n.points[t].x,o=Math.sqrt(r*r+i*i);let s=4.5*Math.sin(.539*n.points[t].y+.05*(10-o)+.9*e);s*=.5*Math.sin(.25*e)+.5,n.points2[t].y=n.points[t].y,n.points2[t].x=n.points[t].x*Math.cos(s)-n.points[t].z*Math.sin(s),n.points2[t].z=n.points[t].x*Math.sin(s)+n.points[t].z*Math.cos(s),n.normals[t].x=0,n.normals[t].y=0,n.normals[t].z=0}const s=n.points2,l=n.index,c=n.normals;new o.Vector4f(0,0,0),new o.Vector4f(0,0,0),new o.Vector4f(0,0,0);for(let t=0;t<l.length;t+=3){const e=s[l[t]],i=s[l[t+1]],r=s[l[t+2]],o=i.sub(e).cross(r.sub(e));c[l[t]]=c[l[t]].add(o),c[l[t+1]]=c[l[t+1]].add(o),c[l[t+2]]=c[l[t+2]].add(o)}for(let t=0;t<c.length;t++)c[t]=c[t].normalize();const u=n.points2,f=n.normals2,d=i.computeNormalMatrix();for(let t=0;t<c.length;t++)d.multiplyHomArr(c[t],f[t]);for(let e=0;e<s.length;e++){const r=i.multiplyHom(s[e]);u[e].x=Math.round(.5*t.width+r.x/(.0078*-r.z)),u[e].y=Math.round(.5*t.height-r.y/(.0078*-r.z)),u[e].z=r.z}const m=new a.Vertex;m.textureCoordinate=new h.TextureCoordinate;const p=new a.Vertex;p.textureCoordinate=new h.TextureCoordinate;const x=new a.Vertex;x.textureCoordinate=new h.TextureCoordinate;const M=new Array(m,p,x);for(let e=0;e<l.length;e+=3){const i=u[l[e]],o=f[l[e]],n=u[l[e+1]],s=f[l[e+1]],a=u[l[e+2]],h=f[l[e+2]];if(t.isTriangleCCW(i,n,a)){M[0].position=i,t.fakeSphere(o,m),M[1].position=n,t.fakeSphere(s,p),M[2].position=a,t.fakeSphere(h,x),i.x<r.Framebuffer.minWindow.x||n.x<r.Framebuffer.minWindow.x||a.x<r.Framebuffer.minWindow.x||i.x>r.Framebuffer.maxWindow.x||n.x>r.Framebuffer.maxWindow.x||a.x>r.Framebuffer.maxWindow.x||i.y<r.Framebuffer.minWindow.y||n.y<r.Framebuffer.minWindow.y||a.y<r.Framebuffer.minWindow.y||i.y>r.Framebuffer.maxWindow.y||n.y>r.Framebuffer.maxWindow.y||a.y>r.Framebuffer.maxWindow.y?t.texturedRenderingPipeline.clipConvexPolygon2(M):t.texturedTriangleRasterizer.drawTriangleDDA(M[0],M[1],M[2])}}}}e.DistortedSphereScene=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gears2Scene=void 0;const r=i(8),o=i(20),n=i(21),s=i(19),a=i(9),h=i(23),l=i(44);class c extends s.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.renderingPipeline=new n.FlatShadingRenderingPipeline(t),this.renderingPipeline.setCullFace(r.CullFace.FRONT),Promise.all([l.BlenderLoader.load(i(61)).then(t=>this.gearsMesh=t),h.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),h.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t,e){t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawBlenderScene4(t,e);const i=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene4(t,e){t.clearDepthBuffer();const i=o.Matrix4f.constructTranslationMatrix(0,0,-14).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(7e-4*e).multiplyMatrix(o.Matrix4f.constructZRotationMatrix(7e-4*-e+2*Math.PI/360*13).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(2*Math.PI/360*90)))),r=o.Matrix4f.constructTranslationMatrix(-4.8,0,-14).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(7e-4*e).multiplyMatrix(o.Matrix4f.constructZRotationMatrix(7e-4*e).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(2*Math.PI/360*90))));this.renderingPipeline.draw(this.gearsMesh[0],i),this.renderingPipeline.draw(this.gearsMesh[0],r)}}e.Gears2Scene=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GearsScene=void 0;const r=i(8),o=i(20),n=i(21),s=i(19),a=i(9),h=i(23),l=i(44);class c extends s.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.renderingPipeline=new n.FlatShadingRenderingPipeline(t),this.renderingPipeline.setCullFace(r.CullFace.FRONT),Promise.all([l.BlenderLoader.load(i(61)).then(t=>this.gearsMesh=t),h.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),h.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t,e){t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawBlenderScene4(t,e);const i=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene4(t,e){t.clearDepthBuffer();const i=o.Matrix4f.constructTranslationMatrix(0,0,-21).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(2e-4*e).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(2e-4*e)));let r=.1*2.1*2.1,n=2.1-.09-.09;const s=.5*Math.sin(1e-5*e)+.5;for(let t=1;t<6;t++){r*=n,n-=.09;const o=this.getModelViewMatrix(i,s,r,t,e);this.renderingPipeline.draw(this.gearsMesh[0],o)}}getModelViewMatrix(t,e,i,r,n){const s=o.Matrix4f.constructXRotationMatrix(6e-4*n+.7*e*(4-r)).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(5e-4*n+.7*e*(4-r)).multiplyMatrix(o.Matrix4f.constructScaleMatrix(i,i,i)));return t.multiplyMatrix(s)}}e.GearsScene=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HoodlumScene=void 0;const r=i(8),o=i(0),n=i(28),s=i(19),a=i(42),h=i(44);class l extends s.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),Promise.all([a.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),h.BlenderLoader.loadWithTexture(i(150)).then(t=>this.spaceLabMesh=t),h.BlenderLoader.load(i(151)).then(t=>this.hoodlumLogoMesh=t),a.TextureUtils.load(i(96),!1).then(t=>this.lab2=t),a.TextureUtils.generateProceduralNoise().then(t=>this.noise=t),this.createProceduralTexture3().then(t=>this.particleTexture2=t)])}render(t,e){t.texturedRenderingPipeline.setCullFace(r.CullFace.BACK),t.setCullFace(r.CullFace.BACK),t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),t.setCullFace(r.CullFace.BACK),t.setTexture(this.lab2),this.drawBlenderScene9(t,e,this.particleTexture2);const i=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene9(t,e,i){t.clearDepthBuffer();const r=o.Matrix4f.constructTranslationMatrix(0,0,7*(.5*Math.sin(7e-5*e)+.5)-34).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(.5*(.5*Math.sin(14e-5*e)+.5)-.2).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(2e-4*-e).multiplyMatrix(o.Matrix4f.constructTranslationMatrix(0,1.9,0))));let n=r.multiplyMatrix(o.Matrix4f.constructScaleMatrix(13,13,13));t.texturedRenderingPipeline.setModelViewMatrix(n),t.texturedRenderingPipeline.drawMeshArray(this.spaceLabMesh),n=r.multiplyMatrix(o.Matrix4f.constructTranslationMatrix(0,-5.5,0).multiplyMatrix(o.Matrix4f.constructScaleMatrix(413,413,413).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(.5*Math.PI))));const s=this.hoodlumLogoMesh[0];t.renderingPipeline.draw(s,n);const a=new Array;for(let i=0;i<10;i++)for(let r=0;r<6;r++){const n=(i+.001*e)%10*2.5-12,s=(1+4*t.interpolate(-10,10,n))*(.5*(.5*Math.sin(.0012*e+2*Math.PI/10*i*2)+.5)+.5),h=s*Math.sin(2*Math.PI/6*r+8e-4*e),l=s*Math.cos(2*Math.PI/6*r+8e-4*e);a.push(new o.Vector3f(h,n,l))}const h=r.multiplyMatrix(o.Matrix4f.constructTranslationMatrix(0,-0,0)),l=new Array(a.length);a.forEach(e=>{const i=t.project(h.multiply(e));l.push(i)}),l.sort((t,e)=>t.z-e.z),l.forEach(e=>{const r=-4.3*192/e.z;t.drawSoftParticle(Math.round(e.x-r/2),Math.round(e.y-r/2),Math.round(r),Math.round(r),i,1/e.z,.7)})}createProceduralTexture3(){return new Promise(t=>{const e=new a.Texture;e.texture=new Uint32Array(65536),(new n.default).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const r=127-i,o=127-t,n=Math.sqrt(r*r+o*o)/127;let s=1-n;s*=s*s,n>1&&(s=0),s=Math.min(1,2.9*s),e.texture[i+256*t]=15466475|255*s<<24}e.width=256,e.height=256,t(e)})}}e.HoodlumScene=l},function(t,e,i){"use strict";i.r(e),e.default=i.p+"8eb469a522c3ae4c7819174e340086dd.jsx"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"362cf30681aa40b46d218290191cab6d.jsx"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LedPlasmaScene=void 0;const r=i(1),o=i(19),n=i(23);class s extends o.AbstractScene{init(t){return Promise.all([n.TextureUtils.load(i(97),!1).then(t=>this.ledTexture=t)])}render(t,e){this.led(t,e,this.ledTexture)}led(t,e,i){const o=7e-4*e*1,n=new r.Vector3f(Math.sin(o),Math.cos(o),0),s=new r.Vector3f(20,17.5,0).add(new r.Vector3f(20*Math.sin(1.2*-o),17.5*Math.cos(1.2*-o),0)),a=new r.Vector3f(0,0,0);for(let e=0;e<25;e++)for(let r=0;r<40;r++){const h=.5*(Math.sin(.8*(r*n.x+e*n.y)+o)+1);a.x=r-s.x,a.y=e-s.y;const l=(15*(.5*(.5*(Math.cos(.7*a.length())+1)+h))|0)%16;t.drawTextureRectNoAlpha(8*r,8*e,0,8*l,8,8,i)}}}e.LedPlasmaScene=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LensScene=void 0;const r=i(10),o=i(19),n=i(42);class s extends o.AbstractScene{constructor(){super(...arguments),this.lensDiameter=100,this.lensRadius=this.lensDiameter/2,this.lensArrayA=[this.lensDiameter*this.lensDiameter],this.lensArrayB=[this.lensDiameter*this.lensDiameter],this.rightBorder=r.Canvas.WIDTH-this.lensDiameter,this.ballBase=r.Canvas.HEIGHT-this.lensDiameter,this.ballX=0,this.ballY=0,this.ballXV=2,this.ballYV=0}init(t){return this.calculateTransformation(20),Promise.all([n.TextureUtils.load(i(48),!1).then(t=>this.textureBackground=t),n.TextureUtils.load(i(154),!0).then(t=>this.textureLens=t)])}render(t,e){t.fastFramebufferCopy(t.framebuffer,this.textureBackground.texture),this.moveWave(e),this.drawLensFast(t,this.textureBackground,this.textureLens)}drawLens(t,e,i){for(let i=-this.lensRadius;i<=this.lensRadius;i++)for(let r=-this.lensRadius;r<=this.lensRadius;r++)if(r*r+i*i<=this.lensRadius*this.lensRadius){const o=Math.round(r+this.ballX),n=Math.round(i+this.ballY),s=1+.03*Math.sqrt(this.lensRadius*this.lensRadius-r*r-i*i),a=Math.round(r/s+this.ballX),h=Math.round(i/s+this.ballY),l=e.texture[a+h*t.width];t.framebuffer[o+n*t.width]=l}t.drawTexture(Math.round(this.ballX-50),Math.round(this.ballY-50),i,1)}drawLensFast(t,e,i){let r=0;for(let i=0;i<this.lensDiameter;i++){const o=this.ballX+(i+this.ballY)*t.width;for(let i=0;i<this.lensDiameter;i++)t.framebuffer[i+o]=e.texture[this.ballX+this.lensArrayA[r]+(this.ballY+this.lensArrayB[r++])*t.width]}t.drawTexture(this.ballX,this.ballY,i,1)}calculateTransformation(t){let e,i;const r=this.lensRadius*this.lensRadius-t*t;for(let o=-this.lensRadius;o<this.lensRadius;o++)for(let n=-this.lensRadius;n<this.lensRadius;n++){if(n*n+o*o>=r)e=n,i=o;else{const r=Math.sqrt(this.lensRadius*this.lensRadius-n*n-o*o);e=Math.floor(n*t/r),i=Math.floor(o*t/r)}const s=(o+this.lensRadius)*this.lensDiameter+(n+this.lensRadius),a=(i+this.lensRadius)*this.lensDiameter+(e+this.lensRadius);this.lensArrayA[s]=Math.floor(a%this.lensDiameter),this.lensArrayB[s]=Math.floor(a/this.lensDiameter)}}moveWave(t){this.ballX=r.Canvas.WIDTH/2+Math.cos(3*t*4e-4)*(r.Canvas.WIDTH/2-this.lensRadius),this.ballY=r.Canvas.HEIGHT/2+Math.sin(2*t*4e-4)*(r.Canvas.HEIGHT/2-this.lensRadius),this.ballX=Math.floor(this.ballX-this.lensRadius),this.ballY=Math.floor(this.ballY-this.lensRadius)}moveBounce(t){this.ballX+=this.ballXV,(this.ballX<1||this.ballX>this.rightBorder)&&(this.ballXV=-this.ballXV),this.ballY+=this.ballYV,this.ballYV>0&&this.ballY>this.ballBase&&(this.ballY=this.ballBase-(this.ballY-this.ballBase),this.ballYV=-this.ballYV),this.ballYV++}}e.LensScene=s},function(t,e,i){"use strict";i.r(e),e.default=i.p+"de5b12ba36149b2b29c6ccb02c4fedf3.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Md2ModelScene=void 0;const r=i(7),o=i(8),n=i(19),s=i(23),a=i(62),h=i(58);class l extends n.AbstractScene{constructor(){super(...arguments),this.modelViewMatrix=new h.ModelViewMatrix,this.fpsStartTime=Date.now(),this.fpsCount=0,this.fps=0}init(t){return t.texturedRenderingPipeline.setCullFace(o.CullFace.FRONT),this.startTime=Date.now(),Promise.all([s.TextureUtils.load(i(98),!1).then(t=>this.ogroTexture=t),a.MD2Loader.load(i(156)).then(t=>this.md2=t)])}render(t,e){t.texturedRenderingPipeline.setCullFace(o.CullFace.FRONT),e>this.fpsStartTime+1e3&&(this.fpsStartTime=e,this.fps=this.fpsCount,this.fpsCount=0),this.fpsCount++,t.clearColorBuffer(l.CLEAR_COLOR),t.clearDepthBuffer(),this.computeCameraMovement(.6*e),t.setTexture(this.ogroTexture),t.texturedRenderingPipeline.setModelViewMatrix(this.modelViewMatrix.getMatrix()),t.texturedRenderingPipeline.draw(this.md2.getMesh(e))}computeCameraMovement(t){this.modelViewMatrix.setIdentity(),this.modelViewMatrix.trans(0,0,87*(.5*Math.sin(7e-4*t)+.5)-120),this.modelViewMatrix.yRotate(.006*-t),this.modelViewMatrix.xRotate(2*Math.PI/360*-90)}}e.Md2ModelScene=l,l.CLEAR_COLOR=r.Color.SLATE_GRAY.toPackedFormat()},function(t,e,i){"use strict";i.r(e),e.default=i.p+"b06319803327d678755e45514be6b869.md2"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RazorScene=void 0;const r=i(8),o=i(54),n=i(158),s=i(159),a=i(160),h=i(0),l=i(19),c=i(42),u=i(7);class f extends l.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),t.setCullFace(r.CullFace.BACK),this.cube=new o.Cube,this.dodecahedron=new n.Dodecahedron,this.pyramid=new s.Pyramid,this.icosahedron=new a.Sphere(6,10),Promise.all([c.TextureUtils.load(i(161),!0).then(t=>this.texture10=t),c.TextureUtils.load(i(162),!0).then(t=>this.texture11=t),c.TextureUtils.load(i(163),!0).then(t=>this.texture13=t),c.TextureUtils.load(i(164),!0).then(t=>this.dirt=t),c.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t){const e=Date.now();this.reproduceRazorScene(t,.0025*e,[{tex:this.texture10,scale:0,alpha:1},{tex:this.texture11,scale:2.3,alpha:.5},{tex:this.texture13,scale:1.6,alpha:.25},{tex:this.texture13,scale:.7,alpha:.22},{tex:this.texture13,scale:-.4,alpha:.22}],this.dirt);const i=new c.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise,.04)}reproduceRazorScene(t,e,i,r){let o;t.clearColorBuffer(-13617080),t.clearDepthBuffer();const n=h.Matrix4f.constructTranslationMatrix(0,0,-6.4-5*(.5*Math.sin(.06*e)+.5)).multiplyMatrix(h.Matrix4f.constructXRotationMatrix(.5*(.5*Math.sin(.08*e)+.5)).multiplyMatrix(h.Matrix4f.constructYRotationMatrix(.1*e)));let s=2;o=h.Matrix4f.constructYRotationMatrix(.2*e).multiplyMatrix(h.Matrix4f.constructScaleMatrix(s,s,s)),o=h.Matrix4f.constructTranslationMatrix(0,1,0).multiplyMatrix(o.multiplyMatrix(h.Matrix4f.constructXRotationMatrix(.2*-e))),o=n.multiplyMatrix(o);let a=this.dodecahedron.getMesh();t.renderingPipeline.draw(a,o);s=1,o=h.Matrix4f.constructScaleMatrix(s,s,s),o=h.Matrix4f.constructTranslationMatrix(2.8,-.5,2.8).multiplyMatrix(o),o=n.multiplyMatrix(o),a=this.icosahedron.getMesh(),t.renderingPipeline.draw(a,o),s=1,o=h.Matrix4f.constructScaleMatrix(.5*s,2*s,.5*s),o=h.Matrix4f.constructTranslationMatrix(-2.8,-.5,2.8).multiplyMatrix(o),o=n.multiplyMatrix(o),a=this.cube.getMesh(),t.renderingPipeline.draw(a,o),s=1,o=h.Matrix4f.constructScaleMatrix(s,s,s),o=h.Matrix4f.constructTranslationMatrix(2.8,-1,-2.8).multiplyMatrix(o),o=n.multiplyMatrix(o),a=this.cube.getMesh(),t.renderingPipeline.draw(a,o),s=1,o=h.Matrix4f.constructScaleMatrix(s,s,s),o=h.Matrix4f.constructTranslationMatrix(-2.8,-1,-2.8).multiplyMatrix(o),o=n.multiplyMatrix(o),a=this.pyramid.getMesh(),t.renderingPipeline.draw(a,o),t.renderingPipeline.enableLighting(!1),t.renderingPipeline.setColor(u.Color.DARK_GRAY),s=2,o=h.Matrix4f.constructYRotationMatrix(.2*e).multiplyMatrix(h.Matrix4f.constructScaleMatrix(s,s,s)),o=h.Matrix4f.constructTranslationMatrix(0,1,0).multiplyMatrix(o.multiplyMatrix(h.Matrix4f.constructXRotationMatrix(.2*-e))),o=n.multiplyMatrix(h.Matrix4f.constructShadowMatrix(o).multiplyMatrix(o)),t.renderingPipeline.draw(this.dodecahedron.getMesh(),o),s=1,o=h.Matrix4f.constructScaleMatrix(s,s,s),o=h.Matrix4f.constructTranslationMatrix(-2.8,-1,-2.8).multiplyMatrix(o),o=n.multiplyMatrix(h.Matrix4f.constructShadowMatrix(o).multiplyMatrix(o)),t.renderingPipeline.draw(this.pyramid.getMesh(),o),s=1,o=h.Matrix4f.constructScaleMatrix(s,s,s),o=h.Matrix4f.constructTranslationMatrix(2.8,-1,-2.8).multiplyMatrix(o),o=n.multiplyMatrix(h.Matrix4f.constructShadowMatrix(o).multiplyMatrix(o)),t.renderingPipeline.draw(this.cube.getMesh(),o),s=1,o=h.Matrix4f.constructScaleMatrix(.5*s,2*s,.5*s),o=h.Matrix4f.constructTranslationMatrix(-2.8,-.5,2.8).multiplyMatrix(o),o=n.multiplyMatrix(h.Matrix4f.constructShadowMatrix(o).multiplyMatrix(o)),t.renderingPipeline.draw(this.cube.getMesh(),o),s=1,o=h.Matrix4f.constructScaleMatrix(s,s,s),o=h.Matrix4f.constructTranslationMatrix(2.8,-.5,2.8).multiplyMatrix(o),o=n.multiplyMatrix(h.Matrix4f.constructShadowMatrix(o).multiplyMatrix(o)),t.renderingPipeline.draw(this.icosahedron.getMesh(),o),t.renderingPipeline.enableLighting(!0);const l=t.project(n.multiply(new h.Vector3f(12,4,0)));t.drawLensFlare(l,100*e,i,r)}}e.RazorScene=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Dodecahedron=void 0;const r=i(22),o=i(4);class n extends r.AbstractGeometricObject{constructor(){super();const t=.5*(1+Math.sqrt(5)),e=1/t,i=2-t,r=[new o.Vector4f(i,0,1),new o.Vector4f(-i,0,1),new o.Vector4f(-e,e,e),new o.Vector4f(0,1,i),new o.Vector4f(e,e,e),new o.Vector4f(e,-e,e),new o.Vector4f(0,-1,i),new o.Vector4f(-e,-e,e),new o.Vector4f(i,0,-1),new o.Vector4f(-i,0,-1),new o.Vector4f(-e,-e,-e),new o.Vector4f(0,-1,-i),new o.Vector4f(e,-e,-e),new o.Vector4f(e,e,-e),new o.Vector4f(0,1,-i),new o.Vector4f(-e,e,-e),new o.Vector4f(1,i,0),new o.Vector4f(-1,i,0),new o.Vector4f(-1,-i,0),new o.Vector4f(1,-i,0)];this.buildMesh(r,[0,4,1,1,3,2,1,4,3,1,7,0,0,6,5,0,7,6,8,12,9,9,11,10,9,12,11,9,15,8,8,14,13,8,15,14,14,3,13,13,4,16,13,3,4,3,14,2,2,15,17,2,14,15,11,6,10,10,7,18,10,6,7,6,11,5,5,12,19,5,11,12,16,4,19,19,0,5,19,4,0,19,12,16,16,8,13,16,12,8,17,15,18,18,9,10,18,15,9,18,7,17,17,1,2,17,7,1])}}e.Dodecahedron=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pyramid=void 0;const r=i(4),o=i(22);class n extends o.AbstractGeometricObject{constructor(){super();const t=.5,e=(Math.sqrt(5),[new r.Vector4f(0,t,0),new r.Vector4f(t,-t,-t),new r.Vector4f(-t,-t,-t),new r.Vector4f(t,-t,t),new r.Vector4f(-t,-t,t)]);this.buildMesh(e,[0,1,2,0,3,1,0,4,3,0,2,4])}}e.Pyramid=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sphere=void 0;const r=i(4),o=i(22);class n extends o.AbstractGeometricObject{constructor(t=16,e=16){super();const i=[],r=t,o=e;for(let t=0;t<=r;t++)for(let e=0;e<o;e++)i.push(this.sphereFunction(-t*Math.PI/r-Math.PI/2,2*-e*Math.PI/o));const n=[];for(let t=0;t<r;t++)for(let e=0;e<o;e++)n.push(o*t+(1+e)%o),n.push(o*t+(0+e)%o),n.push(o*t+o+(1+e)%o),n.push(o*t+o+(0+e)%o),n.push(o*t+o+(1+e)%o),n.push(o*t+(0+e)%o);this.buildMesh(i,n)}sphereFunction(t,e){return new r.Vector4f(Math.cos(t)*Math.cos(e),Math.cos(t)*Math.sin(e),Math.sin(t),1)}}e.Sphere=n},function(t,e,i){"use strict";i.r(e),e.default=i.p+"64c8d0e56a947ade8a449a3ecda79d4b.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"76ae06b027ad8d3a84d87f9801f62db9.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"8a09527b06eeee9b52984520552f3610.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"59b860b8c26e2787d9a2d2c486ccb637.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetaballsScene=void 0;const r=i(0),o=i(19);class n extends o.AbstractScene{render(t){this.drawMetaballs(t)}drawMetaballs(t){const e=[new r.Vector3f(100*Math.sin(.002*Date.now())+t.width/2,70*Math.cos(.0035*Date.now())+100,0),new r.Vector3f(100*Math.sin(.0015*Date.now())+t.width/2,70*Math.cos(.002*Date.now())+100,0),new r.Vector3f(100*Math.sin(.003*Date.now())+t.width/2,70*Math.cos(.0045*Date.now())+100,0)];let i=0;for(let r=0;r<t.height;r++)for(let o=0;o<t.width;o++){let n=0;for(let t=0;t<3;t++){const i=e[t].x-o,s=e[t].y-r;n+=5500/Math.sqrt(i*i+s*s)}t.framebuffer[i++]=255<<24|this.mapColor(n)}}interpolateColor(t,e,i,r,o){const n=this.interpolate(t,e,i);return(r>>0&255)*(1-n)+n*(o>>0&255)|(r>>8&255)*(1-n)+n*(o>>8&255)<<8|(r>>16&255)*(1-n)+n*(o>>16&255)<<16}interpolate(t,e,i){return i<=t?0:i>=e?1:(i-t)/(e-t)}mapColor(t){return t>=235?255:t>=230?this.interpolateColor(230,235,t,65535,255):t>=100?this.interpolateColor(100,230,t,65280,65535):65280}}e.MetaballsScene=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MovingTorusScene=void 0;const r=i(8),o=i(24),n=i(0),s=i(19),a=i(42);class h extends s.AbstractScene{constructor(){super(...arguments),this.torus=new o.Torus}init(t){return t.setCullFace(r.CullFace.BACK),Promise.all([a.TextureUtils.load(i(48),!0).then(t=>this.background=t)])}render(t){const e=Date.now();t.fastFramebufferCopy(t.framebuffer,this.background.texture),this.shadingTorus2(t,.02*e)}shadingTorus2(t,e){t.clearDepthBuffer();let i=n.Matrix4f.constructYRotationMatrix(.09*e);i=i.multiplyMatrix(n.Matrix4f.constructXRotationMatrix(.08*e)),i=n.Matrix4f.constructTranslationMatrix(25*Math.sin(.04*e),9*Math.sin(.05*e),-24).multiplyMatrix(i),t.renderingPipeline.draw(this.torus.getMesh(),i)}}e.MovingTorusScene=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleStreamsScene=void 0;const r=i(19),o=i(0),n=i(9),s=i(42);class a extends r.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),Promise.all([s.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),s.TextureUtils.generateProceduralParticleTexture().then(t=>this.particleTexture2=t),s.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t){const e=Date.now();t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawParticleStreams(t,e,this.particleTexture2,!0);const i=new n.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.55),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawParticleStreams(t,e,i,r=!1){const n=new Array;for(let t=0;t<50;t++){const i=2.8,r=2.9+3*Math.sin(2*Math.PI*t/50-.002*e);for(let s=0;s<10;s++){const a=(2.1*(t-25)-.008*e)%105+52.5,h=Math.cos(2*Math.PI/10*s+.02*t+5e-4*e)*i+8+r,l=Math.sin(2*Math.PI/10*s+.02*t+5e-4*e)*i;n.push(o.Matrix3f.constructXRotationMatrix(2*Math.PI*t/50-Math.sin(3e-4*e+2*Math.PI*t/50)).multiply(new o.Vector3f(a,h,l)))}}for(let r=0;r<3;r++){const s=o.Matrix4f.constructTranslationMatrix(0,-0,-49).multiplyMatrix(o.Matrix4f.constructZRotationMatrix(.17*Math.PI).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(15e-5*e).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(2*Math.PI/3*r+6e-4*e)))),a=new Array(n.length);n.forEach(e=>{const i=t.project(s.multiply(e));a.push(i)}),a.sort((t,e)=>t.z-e.z),a.forEach(e=>{const r=-1.3*192/e.z;e.z<-4&&t.drawParticleNoDepth(Math.round(e.x-r/2),Math.round(e.y-r/2),Math.round(r),Math.round(r),i,t.interpolate(-90,-55,e.z))})}}}e.ParticleStreamsScene=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleSystemScene=void 0;const r=i(20),o=i(19),n=i(9),s=i(23),a=i(169);class h extends o.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.particleSystem=new a.ParticleSystem(.8*Date.now()),Promise.all([s.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),s.TextureUtils.generateProceduralParticleTexture().then(t=>this.particleTexture2=t),s.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t){const e=.8*Date.now();t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),t.clearDepthBuffer();const i=this.getMV(3*e);this.particleSystem.drawParticleStreams(t,e,this.particleTexture2,i);const r=new n.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,r,.55),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}getMV(t){return r.Matrix4f.constructTranslationMatrix(0,0,2*(.5*Math.sin(7e-5*t)+.5)-24).multiplyMatrix(r.Matrix4f.constructXRotationMatrix(35e-5*t).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(3e-4*-t))).multiplyMatrix(r.Matrix4f.constructScaleMatrix(3,3,3))}}e.ParticleSystemScene=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleSystem=void 0;const r=i(170);e.ParticleSystem=class{constructor(t){this.lastTime=0,this.particles=Array(600).fill(null).map(()=>new r.Particle(t))}drawParticleStreams(t,e,i,r){const o=e-this.lastTime;this.lastTime=e;for(let i=0;i<this.particles.length;i++){const n=this.particles[i];n.dead&&n.init(e),n.update(e,o),n.transformedPosition=t.project(r.multiply(n.position))}this.particles.sort((t,e)=>t.transformedPosition.z-e.transformedPosition.z);for(let e=0;e<this.particles.length;e++)this.drawParticle(this.particles[e],t,i)}drawParticle(t,e,i){const r=-192*t.size/t.transformedPosition.z;!t.dead&&t.transformedPosition.z<-4&&e.drawSoftParticle(Math.round(t.transformedPosition.x-r/2),Math.round(t.transformedPosition.y-r/2),Math.round(r),Math.round(r),i,1/t.transformedPosition.z,t.alpha)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Particle=void 0;const r=i(0);e.Particle=class{constructor(t){this.init(t)}init(t){this.position=new r.Vector3f(2.3*Math.sin(1*t*.002),2.3*Math.cos(2*t*.002),2.3*+Math.sin(2*t*.002));this.velocity=new r.Vector3f(1.3*(Math.random()-.5),1.3*(Math.random()-.5),1.3*(Math.random()-.5)).mul(Math.random()),this.alpha=Math.random(),this.size=1.8*(Math.random()+.5),this.start=t,this.lifespan=900*Math.random()+500,this.dead=!1}update(t,e){this.position=this.position.add(this.velocity.mul(e/1e3)),this.alpha=1-(t-this.start)/this.lifespan,this.start+this.lifespan<t&&(this.dead=!0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleTorusScene=void 0;const r=i(20),o=i(1),n=i(19),s=i(9),a=i(23);class h extends n.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.start=Date.now(),Promise.all([a.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),a.TextureUtils.generateProceduralParticleTexture().then(t=>this.particleTexture2=t),a.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t){const e=Date.now();t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawParticleTorus(t,e,this.particleTexture2,!0);const i=new Uint32Array(t.width*t.height);t.fastFramebufferCopy(i,t.framebuffer);const r=new s.Texture;r.texture=i,r.width=t.width,r.height=t.height;const o=(Date.now()-this.start)%(6e4/140*2),n=35*(t.cosineInterpolate(0,20,o)-t.cosineInterpolate(20,300,o)),a=Math.round(t.width+n*t.width/100),h=Math.round(t.height+n*t.height/100);t.drawScaledTextureClipBi(Math.round(t.width/2-a/2),Math.round(t.height/2-h/2),a,h,r,1);const l=new s.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,l,.85),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawParticleTorus(t,e,i,n=!1){n||t.clearColorBuffer(-13617080),t.clearDepthBuffer();const s=new Array;for(let t=0;t<300;t++){const i=3.4*(2+Math.sin(t*Math.PI/150*2+4e-4*e)),r=.0015*e,n=i*Math.cos((r+t)*Math.PI/150*7),a=i*Math.cos((r+t)*Math.PI/150*4),h=i*Math.sin((r+t)*Math.PI/150*7);s.push(new o.Vector3f(n,a,h))}const a=r.Matrix4f.constructTranslationMatrix(0,0,-20).multiplyMatrix(r.Matrix4f.constructYRotationMatrix(3e-4*e).multiplyMatrix(r.Matrix4f.constructXRotationMatrix(3e-4*e))),h=new Array(s.length);s.forEach(e=>{const i=t.project(a.multiply(e));h.push(i)}),h.sort((t,e)=>t.z-e.z),h.forEach(e=>{const r=-2.2*192/e.z;t.drawParticle(Math.round(e.x)-Math.round(r/2),Math.round(e.y)-Math.round(r/2),Math.round(r),Math.round(r),i,1/e.z,1)})}}e.ParticleTorusScene=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PixelEffectScene=void 0;const r=i(19),o=i(23),n=i(57),s=i(173),a=i(0),h=i(55);class l extends r.AbstractScene{constructor(){super(...arguments),this.startTime=Date.now(),this.pixels=new Array,this.PlaneDeformationFloorScene=new h.PlaneDeformationScene(8,i(51))}init(t){return this.fontRenderer2=new n.FontRenderer(t,32,32," !\"    '    ,-. 0123456789:; = ? ABCDEFGHIJKLMNOPQRSTUVWXYZ ",i(80)),Promise.all([o.TextureUtils.load(i(81),!0).then(t=>this.hoodlumLogo=t),this.fontRenderer2.init(),this.PlaneDeformationFloorScene.init(t)]).then(()=>{let t=0;for(let e=0;e<this.hoodlumLogo.width;e++)for(let i=0;i<this.hoodlumLogo.height;i++){const r=this.hoodlumLogo.getPixel2(this.hoodlumLogo,e,i);255==(r>>24&255)&&(this.pixels.push(new s.PixelInterpolator(new a.Vector2f(Math.round(150*Math.sin(4*t*4e-4*Math.PI*2)+160),Math.round(90*Math.cos(3*t*4e-4*Math.PI*2)+100)),new a.Vector2f(e,i+67),r,3*t)),t++)}})}render(t,e){this.PlaneDeformationFloorScene.drawPlaneDeformation(t,e>>3,0),this.fontRenderer2.drawText(0,t.height-32-16,"              WELCOME TO A NEW RELEASE FROM YOUR FRIENDS IN CRIME! HOW DO YOU LIKE THIS INTRO?",.8*(Date.now()-this.startTime),!1);for(let e=0;e<this.pixels.length;e++){const i=this.pixels[e].getPos(2e-4*(Date.now()-this.startTime-this.pixels[e].startTime),e);if(i.x<0||i.x>t.width-1||i.y<0||i.y>t.height-1)continue;const r=Math.max(0,Math.min(1,.001*(Date.now()-this.startTime-this.pixels[e].startTime)));t.drawPixel4(i.x,i.y,this.pixels[e].pixel,r)}}}e.PixelEffectScene=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PixelInterpolator=void 0;const r=i(0);function o(t,e,i){let r;return r=(1-Math.cos(i*Math.PI))/2,t*(1-r)+e*r}e.PixelInterpolator=class{constructor(t,e,i,r=0){this.start=t,this.end=e,this.pixel=i,this.startTime=r}getPos(t,e){return t<=0?this.start:t>=1?this.end:new r.Vector2f(Math.round(o(this.start.x,this.end.x,t)+40*Math.sin(55*t+.15*e)*(1-t)),Math.round(o(this.start.y,this.end.y,t)+40*Math.cos(55*t+.15*e)*(1-t)))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlatonianScene=void 0;const r=i(8),o=i(0),n=i(19),s=i(42),a=i(44);class h extends n.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),t.setCullFace(r.CullFace.BACK),Promise.all([a.BlenderLoader.loadWithTexture(i(175)).then(t=>this.platonianMesh=t),s.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),s.TextureUtils.load(i(99),!1).then(t=>this.platonian=t),s.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t,e){t.setCullFace(r.CullFace.BACK),t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawBlenderScene8(t,e);const i=new s.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene8(t,e){t.clearDepthBuffer();const i=o.Matrix4f.constructTranslationMatrix(0,0,17*(.5*Math.sin(7e-5*e)+.5)-64).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(35e-5*e).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(3e-4*-e))).multiplyMatrix(o.Matrix4f.constructScaleMatrix(13,13,13));t.setTexture(this.platonian),t.texturedRenderingPipeline.setModelViewMatrix(i),t.texturedRenderingPipeline.drawMeshArray(this.platonianMesh)}}e.PlatonianScene=h},function(t,e,i){"use strict";i.r(e),e.default=i.p+"221eeedd3ebbf56676272dab5daf9c06.jsx"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolarVoxelsScene=void 0;const r=i(19),o=i(42);class n extends r.AbstractScene{init(t){return Promise.all([o.TextureUtils.load(i(51),!1).then(t=>this.heightmap=t),o.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t){const e=3*Date.now();this.drawVoxelLandscape4(t,this.heightmap,e);const i=new o.Texture;i.texture=new Uint32Array(65536);for(let e=0;e<256;e++)for(let r=0;r<256;r++){const o=t.height-1-Math.round(t.height/256*r),n=Math.round(t.width/256*e);i.texture[r+256*e]=t.framebuffer[n+o*t.width]}t.drawPolarDistotion2(e,i),t.noise(e,this.noise)}drawVoxelLandscape4(t,e,i){t.clearColorBuffer(255<<24);const r=.02*i;for(let o=0;o<t.width;o++){let n,s;n=1.99*Math.cos(1e-4*i+2*Math.PI/t.width*o),s=1.99*Math.sin(1e-4*i+2*Math.PI/t.width*o);let a=0,h=r+14*n,l=0+14*s;for(let i=14;i<80;i++){const r=(255&e.texture[(255&h)+256*(255&l)])*Math.sin(Math.abs(.5*(i-14)/66))*3.5,c=Math.round(29.7*(r-10)/i+90)-50,u=(200*Math.round(r)/255+55)*Math.min(1,1-(i-14)/66),f=255<<24|.7*u<<16|u<<8|.8*u;if(c>a){let e=o+(t.height-1-a)*t.width;const i=Math.min(c,t.height);for(let r=a;r<i;r++)t.framebuffer[e]=f,e-=t.width;if(i===t.height)break;a=c}h+=n,l+=s}}}}e.PolarVoxelsScene=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RotatingGearsScene=void 0;const r=i(8),o=i(0),n=i(21),s=i(19),a=i(42),h=i(44);class l extends s.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.renderingPipeline=new n.FlatShadingRenderingPipeline(t),this.renderingPipeline.setCullFace(r.CullFace.FRONT),Promise.all([h.BlenderLoader.load(i(61)).then(t=>this.gearsMesh=t),a.TextureUtils.load(i(43),!1).then(t=>this.blurred=t),a.TextureUtils.generateProceduralNoise().then(t=>this.noise=t),a.TextureUtils.load(i(52),!0).then(t=>this.hoodlumLogo=t)])}render(t){const e=Date.now();t.fastFramebufferCopy(t.framebuffer,this.blurred.texture),this.drawBlenderScene3(t,e),t.drawTexture(Math.floor((t.width-this.hoodlumLogo.width)/2),75,this.hoodlumLogo,.6);const i=new a.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer),t.noise(e,this.noise)}drawBlenderScene3(t,e){t.clearDepthBuffer();const i=o.Matrix4f.constructTranslationMatrix(0,0,-5).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(2e-4*e).multiplyMatrix(o.Matrix4f.constructXRotationMatrix(2e-4*e)));for(let t=0;t<10;t++){const r=.2*Math.sin(2*Math.PI/10*t+.002*e)+.2+.3,n=i.multiplyMatrix(o.Matrix4f.constructTranslationMatrix(0,(t+8e-4*e)%10-5,0).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(.36*t+.0016*e).multiplyMatrix(o.Matrix4f.constructScaleMatrix(r,1,r))));this.renderingPipeline.draw(this.gearsMesh[0],n)}}}e.RotatingGearsScene=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RotoZoomerScene=void 0;const r=i(19),o=i(42);class n extends r.AbstractScene{init(t){return Promise.all([o.TextureUtils.load(i(63),!1).then(t=>this.logoTexture=t)])}render(t,e){this.drawRotoZoomer(t,e)}drawRotoZoomer(t,e){const i=Math.sin(5e-4*e)+1.1,r=Math.sin(3e-4*e)*i,o=Math.cos(3e-4*e)*i,n=o,s=-r;let a=512*Math.sin(2e-4*e),h=512*Math.cos(2e-4*e),l=0,c=0,u=0;for(let e=0;e<t.height;e++){c=h,l=a;for(let e=0;e<t.width;e++)t.framebuffer[u++]=this.logoTexture.texture[(63&c)+64*(255&l)],c+=n,l+=s;h+=r,a+=o}}}e.RotoZoomerScene=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SineScrollerScene=void 0;const r=i(7),o=i(26),n=i(28),s=i(19),a=i(23),h=i(57);class l extends s.AbstractScene{init(t){this.startTime=Date.now();this.fontRenderer=new h.FontRenderer(t,32,34,"ABCDEFGHIJKLMNOPQRSTUVWXYZ@+# 0123456789!'()?-/.,",i(180));return this.fontRenderer2=new h.FontRenderer(t,16,18,"ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789*:?!-(),'.+~<>>#// ",i(181)),Promise.all([a.TextureUtils.load(i(52),!0).then(t=>this.texture2=t),this.fontRenderer.init(),this.fontRenderer2.init()])}render(t,e){this.drawStarField(t,e),t.drawTexture(0,0,this.texture2,1),this.fontRenderer.drawText(0,102," # TEAM GENESIS # IS BACK IN 2018 WITH A NEW PC FIRST! 'STAR WARS - EMPIRE AT WAR' DO YOU LIKE THIS?    ",e),this.fontRenderer2.drawText(0,t.height-20,"   * WE REALLY LOVE SCROLLERS * HOW ABOUT YOU? THIS PRODUCTION IS FROM HOODLUM~< LETS GO ON WITH THE GENERAL BLAH BLAH      ",1.6*e,!1);for(let i=0;i<20;i++){const r=.003*e,o=i/20*.6,n=.5*(Math.cos(Math.PI*o/.5+r)+1)*255,s=.5*(Math.sin(Math.PI*o/.5+r)+1)*255,a=255<<24|.5*(Math.sin(r)+1)*255<<16|s<<8|n;t.drawRect(16*i,68,16,a),t.drawRect(16*(19-i),168,16,a)}}drawStarField(t,e){const i=new n.default;i.setSeed(666);const s=new Array,a=new Array;for(let e=0;e<100;e++)s.push(new o.Vector2f(i.getFloat()*t.width,Math.round(100*i.getFloat()+68)));for(let e=0;e<60;e++)a.push(new o.Vector2f(i.getFloat()*t.width,Math.round(100*i.getFloat()+68)));t.clearColorBuffer(-16777216),t.drawRect2(0,68,t.width,100,r.Color.DARK_BLUE.toPackedFormat());for(let i=0;i<100;i++)t.drawPixel((s[i].x+.02*e|0)%t.width,s[i].y,-8355712);for(let i=0;i<60;i++)t.drawPixel((a[i].x+.04*e|0)%t.width,a[i].y,-1)}}e.SineScrollerScene=l},function(t,e,i){"use strict";i.r(e),e.default=i.p+"1c9a3c7bf86ce3ec74b515b10b9f5f17.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"660539e872dc7488532f602c4b1b9c9b.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StarfieldScene=void 0;const r=i(0),o=i(28),n=i(19);class s extends n.AbstractScene{render(t){this.drawStarField(t,Date.now())}drawStarField(t,e){const i=new o.default;i.setSeed(666);const n=new Array,s=new Array;for(let e=0;e<100;e++)n.push(new r.Vector3f(i.getFloat()*t.width,Math.round(i.getFloat()*t.height),0));for(let e=0;e<60;e++)s.push(new r.Vector3f(i.getFloat()*t.width,Math.round(i.getFloat()*t.height),0));t.clearColorBuffer(-11059665);for(let i=0;i<100;i++)t.drawPixel((n[i].x+.02*e|0)%t.width,n[i].y,-8355712);for(let i=0;i<60;i++)t.drawPixel((s[i].x+.04*e|0)%t.width,s[i].y,-1)}}e.StarfieldScene=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TexturedTorusScene=void 0;const r=i(8),o=i(0),n=i(19),s=i(42),a=i(3);class h extends n.AbstractScene{init(t){return t.setCullFace(r.CullFace.BACK),this.torusMesh=this.computeTexturedTorusMesh(),Promise.all([s.TextureUtils.load(i(50),!0).then(t=>this.texture4=t),s.TextureUtils.load(i(64),!1).then(t=>this.abstract=t),s.TextureUtils.load(i(48),!1).then(t=>this.texture5=t)])}render(t){const e=Date.now();t.setTexture(this.abstract),t.fastFramebufferCopy(t.framebuffer,this.texture5.texture),this.shadingTorus4(t,.001*e),this.cinematicScroller(t,this.texture4,e)}shadingTorus4(t,e){t.clearDepthBuffer();let i=o.Matrix4f.constructScaleMatrix(2.1,2.1,2.1).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(.25*e));i=i.multiplyMatrix(o.Matrix4f.constructXRotationMatrix(.3*e)),i=o.Matrix4f.constructTranslationMatrix(26*Math.sin(.3*e),10*Math.sin(.2*e),-45).multiplyMatrix(i),t.texturedRenderingPipeline.setModelViewMatrix(i),t.texturedRenderingPipeline.draw(this.torusMesh)}torusFunction(t){return new o.Vector3f(10*Math.sin(t),0,10*Math.cos(t))}computeTexturedTorusMesh(){const t=[],e=[];for(let i=0;i<16;i++){const r=this.torusFunction(2*i*Math.PI/15),n=this.torusFunction(2*i*Math.PI/15+.1),s=new o.Vector3f(0,4,0),h=n.sub(r).cross(s);for(let n=0;n<9;n++){const l=s.mul(Math.sin(2*n*Math.PI/8)).add(h.mul(Math.cos(2*n*Math.PI/8))).add(r);t.push(new o.Vector4f(l.x,l.y,l.z));const c=new a.TextureCoordinate;c.u=1/8*n,c.v=1/15*i,e.push(c)}}const i=[];for(let t=0;t<15;t++)for(let e=0;e<8;e++)i.push({uv:[9*t+(1+e),9*t+(0+e),9*t+9+(1+e)],vertices:[9*t+(1+e),9*t+(0+e),9*t+9+(1+e)]}),i.push({uv:[9*t+9+(0+e),9*t+9+(1+e),9*t+(0+e)],vertices:[9*t+9+(0+e),9*t+9+(1+e),9*t+(0+e)]});return{points:t,points2:t.map(()=>new o.Vector4f(0,0,0)),uv:e,faces:i}}cinematicScroller(t,e,i){const r=["","","","","","","","","","","","","","","","","","","","","","","","","","YOU HAVE BEEN WATCHING","","D A R K   M A T T E R","","A JAVASCRIPT DEMO MADE FOR","NORDLICHT 2018","","CREDITS","","CODE BY","TRIGGER","","GRAFICS BY","PREMIUM","","MUSIC BY","VIRGILL"];i*=.6;const o=Math.round(8*t.interpolate(0,250,255&i));for(let n=1;n<t.height/8;n++){const s=r[Math.floor(n+i/256)%r.length],a=t.width/2-8*s.length/2|0,h=8*n-o;t.drawText(a,h,s,e)}}}e.TexturedTorusScene=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TitanEffectScene=void 0;const r=i(19),o=i(9),n=i(23);class s extends r.AbstractScene{init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),this.startTime=Date.now(),Promise.all([n.TextureUtils.load(i(48),!1).then(t=>this.atlantisBackground=t),n.TextureUtils.load(i(52),!0).then(t=>this.hoodlumLogo=t)])}render(t){const e=.004*(Date.now()-this.startTime);t.fastFramebufferCopy(t.framebuffer,this.atlantisBackground.texture);for(let i=0;i<this.hoodlumLogo.width;i++)this.drawVerticalSpan(t,this.hoodlumLogo,i,Math.round(60*Math.sin(.009*i+.9*e+2*Math.PI/4)+100),Math.round(60*Math.sin(.009*i+.9*e+2*Math.PI/4*2)+100),.85*Math.max(0,Math.sin(.009*i+.9*e+2*Math.PI/4*2.5))+.15);const i=new o.Texture(this.accumulationBuffer,t.width,t.height);t.drawTexture(0,0,i,.65),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer)}drawVerticalSpan(t,e,i,r,o,n=1){const s=Math.abs(o-r),a=e.height/s;let h=0;const l=o>r?t.width:-t.width;let c=i+r*t.width;const u=Math.pow(n,20);for(let r=0;r<s;r++){const r=e.texture[i+Math.round(h)*e.width];let o=(r>>24&255)/255;const s=1-o;o*=n;const f=t.framebuffer[c],d=(f>>0&255)*s+Math.min(255,(r>>0&255)+180*u)*o|0,m=(f>>8&255)*s+Math.min(255,(r>>8&255)+100*u)*o|0,p=(f>>16&255)*s+Math.min(255,(r>>16&255)+100*u)*o|0;t.framebuffer[c]=d|m<<8|p<<16|255<<24,h+=a,c+=l}}}e.TitanEffectScene=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TorusKnotScene=void 0;const r=i(8),o=i(82),n=i(0),s=i(20),a=i(28),h=i(19),l=i(83),c=i(9),u=i(23);class f extends h.AbstractScene{constructor(){super(...arguments),this.torus=new o.TorusKnot}init(t){return t.renderingPipeline.setCullFace(r.CullFace.BACK),t.renderingPipeline.setFog(new l.LinearFog(-160,-380,new n.Vector4f(0,0,0,1))),this.startTime=Date.now(),Promise.all([u.TextureUtils.load(i(101),!1).then(t=>this.rave=t),u.TextureUtils.load(i(102),!1).then(t=>this.micro=t),u.TextureUtils.generateProceduralNoise().then(t=>this.noise=t)])}render(t){const e=Date.now()-this.startTime;this.raveMoview(t,5*e,this.rave),this.glitchScreen(t,e,this.noise),t.drawScaledTextureClipAdd(t.width-(.13*e|0)%(2*this.micro.width+t.width),t.height/2-20,2*this.micro.width,2*this.micro.height,this.micro,.5),t.drawScaledTextureClipAdd((.1*e|0)%(this.micro.width+t.width)-t.width,t.height/2-60,this.micro.width,this.micro.height,this.micro,.5),t.setCullFace(r.CullFace.BACK),this.shadingTorus5(t,.03*Date.now())}raveMoview(t,e,i){t.fastFramebufferCopyOffset(t.framebuffer,i.texture,-Math.round(e/200)%11*200)}glitchScreen(t,e,i,r=!0){const o=.5*Math.sin(3e-4*e)+.5,n=new a.default;n.setSeed(e/250|0);const s=new c.Texture;s.height=t.height,s.width=t.width,s.texture=t.framebuffer;for(let e=0;e<16;e++)for(let i=0;i<10;i++)n.getFloat()>.25||t.drawTextureRect(20*(16-e),20*(16*n.getFloat()|0),20*e,20*i,20,20,s,.1+.35*o);if(r)for(let r=0;r<16;r++)for(let n=0;n<10;n++)t.drawTextureRect(20*r,20*n,Math.round(e/100+r+n)%12*20,0,20,20,i,.1+.3*o);t.fastFramebufferCopy(t.tmpGlitch,t.framebuffer);const h=new a.default;for(let i=0;i<8;i++){let i=Math.round(180*n.getFloat());const r=3+Math.round(20*n.getFloat());h.setSeed(e/250|0);const s=h.getFloat()*o,a=n.getFloat()*o;for(let o=0;o<r;o++){const r=Math.abs(Math.round(25*a)+Math.round(3*h.getFloat())+Math.round(Math.cos(.01*o+.002*e+a)*s*5));let n=i*t.width,l=i*t.width+t.width-r;for(let e=0;e<Math.max(0,r);e++)t.framebuffer[n++]=t.tmpGlitch[l++];l=i*t.width;const c=t.width-r;for(let e=0;e<c;e++)t.framebuffer[n++]=t.tmpGlitch[l++];i++}}}shadingTorus5(t,e){t.clearDepthBuffer();let i=s.Matrix4f.constructScaleMatrix(1,1,1).multiplyMatrix(s.Matrix4f.constructYRotationMatrix(.035*e));i=i.multiplyMatrix(s.Matrix4f.constructXRotationMatrix(.04*e));const r=10*e%(6e4/65),o=12*(t.cosineInterpolate(0,15,r)-t.cosineInterpolate(15,200,r)+.4*t.cosineInterpolate(200,300,r)-.4*t.cosineInterpolate(300,400,r));i=s.Matrix4f.constructTranslationMatrix(20*Math.sin(.04*e),8*Math.sin(.05*e)-5*o,-278).multiplyMatrix(i),t.renderingPipeline.draw(this.torus.getMesh(),i)}}e.TorusKnotScene=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TorusKnotTunnelScene=void 0;const r=i(8),o=i(82),n=i(20),s=i(4),a=i(19),h=i(83),l=i(9),c=i(23),u=i(28);class f extends a.AbstractScene{constructor(){super(...arguments),this.torusKnot=new o.TorusKnot(!0),this.fog=new h.LinearFog(-50,-240,new s.Vector4f(.67,.4,.5,1))}init(t){return t.renderingPipeline.setCullFace(r.CullFace.FRONT),t.renderingPipeline.setFog(this.fog),Promise.all([c.TextureUtils.generateProceduralNoise().then(t=>this.noise=t),c.TextureUtils.load(i(187),!1).then(t=>this.cocoon=t),c.TextureUtils.generateProceduralParticleTexture2().then(t=>this.particleTexture=t)])}render(t){const e=Date.now();this.torusTunnel(t,.019*e,this.particleTexture),t.drawScaledTextureClipAdd(t.width/2-this.cocoon.width/2,t.height/2-this.cocoon.height/2,this.cocoon.width,this.cocoon.height,this.cocoon,.67),this.glitchScreen(t,5*e,this.noise)}glitchScreen(t,e,i,r=!0){const o=.9*Math.sin(2e-5*e)+.1,n=new u.default;n.setSeed(e/250|0);const s=new l.Texture;s.height=t.height,s.width=t.width,s.texture=t.framebuffer;for(let e=0;e<16;e++)for(let i=0;i<10;i++)n.getFloat()>.25||t.drawTextureRect(20*(16-e),20*(16*n.getFloat()|0),20*e,20*i,20,20,s,.03+.35*o);if(r)for(let r=0;r<16;r++)for(let n=0;n<10;n++)t.drawTextureRect(20*r,20*n,Math.round(e/100+r+n)%12*20,0,20,20,i,.1+.3*o);t.fastFramebufferCopy(t.tmpGlitch,t.framebuffer);const a=new u.default;for(let i=0;i<8;i++){let i=Math.round(180*n.getFloat());const r=3+Math.round(20*n.getFloat());a.setSeed(e/250|0);const s=a.getFloat()*o,h=n.getFloat()*o;for(let o=0;o<r;o++){const r=Math.abs(Math.round(25*h)+Math.round(3*a.getFloat())+Math.round(Math.cos(.01*o+.002*e+h)*s*5));let n=i*t.width,l=i*t.width+t.width-r;for(let e=0;e<Math.max(0,r);e++)t.framebuffer[n++]=t.tmpGlitch[l++];l=i*t.width;const c=t.width-r;for(let e=0;e<c;e++)t.framebuffer[n++]=t.tmpGlitch[l++];i++}}}torusTunnel(t,e,i){t.clearDepthBuffer();const r=this.torusFunction3(.02*e),o=this.torusFunction3(.02*e+.4),s=o.sub(r).normalize();let a=r.add(o).normalize();const h=s.cross(a).normalize();a=h.cross(s).normalize();const l=n.Matrix4f.constructIdentityMatrix();l.m14=-r.x,l.m24=-r.y,l.m34=-r.z;const c=n.Matrix4f.constructIdentityMatrix();c.m11=h.x,c.m21=h.y,c.m31=h.z,c.m12=a.x,c.m22=a.y,c.m32=a.z,c.m13=-s.x,c.m23=-s.y,c.m33=-s.z;const u=c.transpose().multiplyMatrix(l);let f=n.Matrix4f.constructScaleMatrix(1,1,1).multiplyMatrix(n.Matrix4f.constructYRotationMatrix(.035*e));f=n.Matrix4f.constructTranslationMatrix(0,0,-10).multiplyMatrix(f.multiplyMatrix(n.Matrix4f.constructXRotationMatrix(.04*e))),f=n.Matrix4f.constructZRotationMatrix(.01*e).multiplyMatrix(u),t.renderingPipeline.draw(this.torusKnot.getMesh(),f)}torusFunction3(t){const e=.5*(2+Math.sin(3*t));return new s.Vector4f(e*Math.cos(2*t),e*Math.cos(3*t),e*Math.sin(2*t)).mul(70)}}e.TorusKnotTunnelScene=f},function(t,e,i){"use strict";i.r(e),e.default=i.p+"7fe555ee73184c72e031821a22f0d544.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TorusScene=void 0;const r=i(8),o=i(24),n=i(20),s=i(19),a=i(23);class h extends s.AbstractScene{constructor(){super(...arguments),this.torus=new o.Torus}init(t){return t.setCullFace(r.CullFace.BACK),Promise.all([a.TextureUtils.load(i(189),!0).then(t=>this.razorLogo=t)])}render(t){const e=.02*Date.now();this.drawTitanEffect(t),this.shadingTorus(t,e),t.drawTexture(32,1,this.razorLogo,1)}shadingTorus(t,e){t.clearDepthBuffer();let i=n.Matrix4f.constructYRotationMatrix(.05*e);i=i.multiplyMatrix(n.Matrix4f.constructXRotationMatrix(.08*e)),i=n.Matrix4f.constructTranslationMatrix(0,0,-24).multiplyMatrix(i),t.renderingPipeline.draw(this.torus.getMesh(),i)}drawTitanEffect(t){t.clear();const e=t.width/20,i=t.height/20;for(let r=0;r<e;r++)for(let e=0;e<i;e++){const i=(Math.sin(.004*Date.now()+.7*r+.4*e)+1)/2,o=2*Math.round(8*i+1),n=10-o/2|0,s=255<<24|85*i<<16|55*i<<8|55*i;t.drawBox2(20*r+n,20*e+n,o,o,s)}}}e.TorusScene=h},function(t,e,i){"use strict";i.r(e),e.default=i.p+"d3132c4de2ae05ba66ad9637600796c5.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToxicDotsScene=void 0;const r=i(2),o=i(0),n=i(19);class s extends n.AbstractScene{init(t){return this.tmp=new Uint32Array(t.width*t.height),this.tmp2=new Uint32Array(t.width*t.height),Promise.all([])}render(t){const e=Date.now();this.blur(t),this.shadingTorus3(t,.003*e)}shadingTorus3(t,e){const i=[];for(let e=0;e<30;e++){const r=t.torusFunction(2*e*Math.PI/30),n=t.torusFunction(2*e*Math.PI/30+.1),s=new o.Vector3f(0,4,0),a=n.sub(r).cross(s);for(let t=0;t<24;t++){const e=s.mul(Math.sin(2*t*Math.PI/24)).add(a.mul(Math.cos(2*t*Math.PI/24))).add(r);i.push(e)}}let n=o.Matrix4f.constructScaleMatrix(1.2,1.2,1.2).multiplyMatrix(o.Matrix4f.constructYRotationMatrix(.09*e));n=n.multiplyMatrix(o.Matrix4f.constructXRotationMatrix(.08*e));const s=new Array;n=o.Matrix4f.constructTranslationMatrix(25*Math.sin(.04*e),9*Math.sin(.05*e),-34).multiplyMatrix(n);for(let e=0;e<i.length;e++){const r=n.multiply(i[e]),a=r.x,h=r.y,l=r.z,c=.5*t.width+a/(.0078*-l),u=.5*t.height+h/(.0078*-l);s.push(new o.Vector3f(Math.round(c),Math.round(u),l))}for(let e=0;e<s.length;e++){const i=s[e],o=4290510779;i.x>r.Framebuffer.minWindow.x&&i.x<r.Framebuffer.maxWindow.x&&i.y>r.Framebuffer.minWindow.y&&i.y<r.Framebuffer.maxWindow.y&&t.drawPixel(i.x,i.y,o)}}blur(t){let e,i=0,r=0,o=0,n=1+t.width,s=t.width;for(let a=0;a<t.height-2;a++){for(let a=0;a<t.width-2;a++)e=t.framebuffer[s],i=255&e,r=e>>8&255,o=e>>16&255,s++,e=t.framebuffer[s],i+=255&e,r+=e>>8&255,o+=e>>16&255,s++,e=t.framebuffer[s],i+=255&e,r+=e>>8&255,o+=e>>16&255,s++,s-=2,i*=1/3.1,r*=1/3.1,o*=1/3.1,this.tmp[n]=i|r<<8|o<<16|255<<24,n++;s+=2,n+=2}n=t.width+1,s=1;for(let a=1;a<t.width-1;a++){s=a;for(let a=0;a<t.height-2;a++)e=this.tmp[s],i=255&e,r=e>>8&255,o=e>>16&255,s+=t.width,e=this.tmp[s],i+=255&e,r+=e>>8&255,o+=e>>16&255,s+=t.width,e=this.tmp[s],i+=255&e,r+=e>>8&255,o+=e>>16&255,s+=t.width,s-=2*t.width,i*=1/3.1,r*=1/3.1,o*=1/3.1,this.tmp2[n]=i|r<<8|o<<16|255<<24,n+=t.width;n+=-(t.height-2)*t.width+1}t.fastFramebufferCopy(t.framebuffer,this.tmp2)}}e.ToxicDotsScene=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TwisterScene=void 0;const r=i(19),o=i(23);class n extends r.AbstractScene{init(t){return Promise.all([o.TextureUtils.load(i(48),!1).then(t=>this.backgroundTexture=t),o.TextureUtils.load(i(63),!1).then(t=>this.logoTexture=t)])}render(t){const e=Date.now();t.drawScaledTextureClipBi(0,0,t.width,t.height,this.backgroundTexture,1),this.draw(t,this.logoTexture,e)}draw(t,e,i){const r=.001*i;for(let i=10;i<t.height-10;i++){const o=50*Math.sin(r+.01*i)|0,n=Math.sin(.4*r+.0021*i)*Math.PI*2;let s=32;const a=Math.sin(n)*s|0,h=Math.sin(2*Math.PI/4+n)*s|0,l=Math.sin(2*Math.PI/4*2+n)*s|0,c=Math.sin(2*Math.PI/4*3+n)*s|0;if(h>a){s=Math.max(0,Math.sin(2*Math.PI/4*1.5+n));const r=h-a,l=a+120+o;this.drawSpan(t,r,l,i,s,e)}if(l>h){s=Math.max(0,Math.sin(2*Math.PI/4*2.5+n));const r=l-h,a=h+120+o;this.drawSpan(t,r,a,i,s,e)}if(c>l){s=Math.max(0,Math.sin(2*Math.PI/4*3.5+n));const r=c-l,a=l+120+o;this.drawSpan(t,r,a,i,s,e)}if(a>c){s=Math.max(0,Math.sin(2*Math.PI/4*4.5+n));const r=a-c,h=c+120+o;this.drawSpan(t,r,h,i,s,e)}}}drawSpan(t,e,i,r,o,n){let s=i+r*t.width,a=(255&(r-.029*Date.now()|0))*n.width;const h=n.width/e,l=115*Math.pow(o,11);for(let i=0;i<e;i++){const e=n.texture[0|a],i=Math.min((e>>0&255)*o+l,255),r=Math.min((e>>8&255)*o+l,255),c=Math.min((e>>16&255)*o+l,255);t.framebuffer[s]=i|r<<8|c<<16|255<<24,s++,a+=h}}}e.TwisterScene=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VoxelBallsScene=void 0;const r=i(7),o=i(8),n=i(54),s=i(0),a=i(21),h=i(19),l=i(42);class c extends h.AbstractScene{constructor(){super(...arguments),this.cubeMesh=new n.Cube}init(t){return this.accumulationBuffer=new Uint32Array(t.width*t.height),t.setCullFace(o.CullFace.BACK),this.renderingPipeline=new a.FlatShadingRenderingPipeline(t),Promise.all([l.TextureUtils.load(i(43),!1).then(t=>this.blurred=t)])}render(t){t.fastFramebufferCopy(t.framebuffer,this.blurred.texture);Date.now();t.clearDepthBuffer();for(let t=0;t<5;t++)for(let e=0;e<5;e++)for(let i=0;i<5;i++){let r=.5*(Math.sin(.3*t+9e-4*Date.now())+1)*(Math.sin(.4*e+.002*Date.now())+1)*.5*(Math.sin(.3*i+.001*Date.now())+1)*.5;r=.8;const o=s.Matrix4f.constructTranslationMatrix(0,0,-11).multiplyMatrix(s.Matrix4f.constructYRotationMatrix(3e-4*Date.now()).multiplyMatrix(s.Matrix4f.constructXRotationMatrix(5e-4*Date.now()).multiplyMatrix(s.Matrix4f.constructZRotationMatrix(4e-4*Date.now()).multiplyMatrix(s.Matrix4f.constructTranslationMatrix(t-2.5+.5,e-2.5+.5,i-2.5+.5).multiplyMatrix(s.Matrix4f.constructScaleMatrix(r,r,r))))));this.renderingPipeline.draw(this.cubeMesh.getMesh(),o)}const e=new l.Texture(this.accumulationBuffer,t.width,t.height);t.drawTextureFullscreen(e,.75),t.fastFramebufferCopy(this.accumulationBuffer,t.framebuffer)}}e.VoxelBallsScene=c,c.BACKGROUND_COLOR=r.Color.YELLOW.toPackedFormat()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VoxelLandScapeFadeScene=void 0;const r=i(19),o=i(42);class n extends r.AbstractScene{constructor(){super(...arguments),this.MAP_BIT_SIZE=8,this.playerX=20,this.playerY=0,this.playerZ=2048e3,this.playerDistance=567296,this.playerSpeed=1,this.playerAngle=0,this.angleSpeed=0,this.viewportHeight=0}init(t){return this.MAP_BIT_SIZE=8,this.RENDERWIDTH=t.width,this.RENDERHEIGHT=t.height,this.RENDERLENGTH=this.RENDERWIDTH*this.RENDERHEIGHT,this.MAPWIDTH=1<<this.MAP_BIT_SIZE,this.MAPWIDTH_MIN_1=this.MAPWIDTH-1,this.MAPSIZE=this.MAPWIDTH*this.MAPWIDTH,this.sinTable=[3600],this.cosTable=[3600],this.heightMap=new Uint32Array(this.MAPSIZE),this.texelMap=new Uint32Array(this.RENDERLENGTH),this.colorLut=new Uint32Array(65536),Promise.all([o.TextureUtils.load(i(194),!1).then(t=>this.voxelmap=t),o.TextureUtils.load(i(195),!0).then(t=>this.colormap=t)]).then(()=>{this.setup()})}render(t){this.playerAngle+=this.angleSpeed,this.playerAngle<0?this.playerAngle+=3600:this.playerAngle>=3600&&(this.playerAngle-=3600),this.playerX+=3600,this.playerY+=0,this.renderVoxel(this.playerX,this.playerY,this.playerZ,this.playerAngle,this.playerDistance,t)}setup(){this.texelMap=this.colormap.texture;let t=0;do{const e=255&this.voxelmap.texture[t];this.heightMap[t]=e<<12}while(++t<this.MAPSIZE);for(let t=0;t<3600;t++)this.sinTable[t]=this.toFP(Math.sin(2*Math.PI*t/3600)),this.cosTable[t]=this.toFP(Math.cos(2*Math.PI*t/3600));for(let t=0;t<256;t++)for(let e=0;e<256;e++){const i=(t<<8)+e,r=t*e/256;this.colorLut[i]=Math.round(r)}}toFP(t){const e=Math.abs(t),i=Math.round(e);let r=(i<<12)+(Math.round(1e4*(e-i))<<12)/1e4;return t<0&&(r*=-1),r}renderVoxel(t,e,i,r,o,n){n.clearColorBuffer(0);let s=r-(this.RENDERWIDTH>>1);s<0&&(s+=3600);let a=0;const h=i-this.viewportHeight,l=o/20008;do{const r=this.RENDERLENGTH-this.RENDERWIDTH+a,c=this.cosTable[s],u=this.sinTable[s],f=i,d=t,m=e,p=0,x=h/o<<12;this.iterate(m,d,f,x,u,c,p,l,r,256,n),++s>=3600&&(s=0)}while(++a<this.RENDERWIDTH)}iterate(t,e,i,r,o,n,s,a,h,l,c){for(let u=0;u<l;u++){t+=o,i-=r,s+=a;const l=(e+=n)>>11&this.MAPWIDTH_MIN_1,f=((t>>11&this.MAPWIDTH_MIN_1)<<this.MAP_BIT_SIZE)+l,d=this.heightMap[f]>>2;let m;for(m=c.blend(this.texelMap[f],4278190080,u);d>i;)c.framebuffer[h]=m,h-=this.RENDERWIDTH,r-=a,i+=s;if(h<0)break}}blend32(t,e,i){const r=(16711680&t)>>16,o=(16711680&e)>>16,n=(65280&t)>>8,s=(65280&e)>>8,a=255&t,h=255&e;return 4278190080+(this.colorLut[255-i+(r<<8)]+this.colorLut[(o<<8)+i]<<16)+(this.colorLut[255-i+(n<<8)]+this.colorLut[(s<<8)+i]<<8)+(this.colorLut[255-i+(a<<8)]+this.colorLut[(h<<8)+i])}}e.VoxelLandScapeFadeScene=n},function(t,e,i){"use strict";i.r(e),e.default=i.p+"dd3a76db78db155762215467687f3cf7.png"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"8bcbbc698090a5deaafb4f7e39b0a999.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VoxelLandscapeScene=void 0;const r=i(19),o=i(23);class n extends r.AbstractScene{init(t){return Promise.all([o.TextureUtils.load(i(103),!0).then(t=>this.texture2=t),o.TextureUtils.load(i(51),!1).then(t=>this.heightmap=t),o.TextureUtils.load(i(64),!1).then(t=>this.abstract=t)])}render(t){const e=Date.now();this.drawVoxelLandscape3(t,this.heightmap,e),t.drawTexture(32,1,this.texture2,1)}drawVoxelLandscape2(t,e,i){t.clearColorBuffer(255<<24);const r=.008*i;for(let o=0;o<t.width;o++){const n=.4*Math.cos(5e-4*i+.005*o),s=.4*Math.sin(5e-4*i+.005*o);let a=0,h=r+45*n,l=0+45*s;for(let i=45;i<200;i++){const r=e.getBilinearFilteredPixel(h,l),c=Math.round(125.7*(r-260)/i+300),u=Math.round(r)*Math.min(1,10*(1-(i-45)/155)),f=255<<24|u+10<<16|u+20<<8|u+13;if(c>a){let e=o+(t.height-1-a)*t.width;const i=Math.min(c,t.height);for(let r=a;r<i;r++)t.framebuffer[e]=f,e-=t.width;if(i===t.height)break;a=c}h+=n,l+=s}}}drawVoxelLandscape3(t,e,i){t.clearColorBuffer(255<<24);const r=.008*i;for(let o=0;o<t.width;o++){const n=.4*Math.cos(5e-4*i+.0018*o),s=.4*Math.sin(5e-4*i+.0018*o);let a=0,h=r+35*n,l=0+35*s;for(let i=35;i<300;i++){const r=255&e.getPixel(e,h,l),c=Math.round(45*(r-480)/i+300),u=e.getPixel(this.abstract,h,l)|255<<24;if(c>a){let e=o+(t.height-1-a)*t.width;const i=Math.min(c,t.height);for(let r=a;r<i;r++)t.framebuffer[e]=u,e-=t.width;if(i===t.height)break;a=c}h+=n,l+=s}}}}e.VoxelLandscapeScene=n},,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(10),o=i(220);(class{static main(){new r.Canvas(r.Canvas.WIDTH,r.Canvas.HEIGHT,new o.DemoScene).init()}}).main()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DemoScene=void 0;const r=i(19),o=i(42),n=i(221),s=i(7),a=i(127),h=i(225);class l extends r.AbstractScene{constructor(){super(...arguments),this.BPM=120,this.ROWS_PER_BEAT=8,this.ROW_RATE=this.BPM/60*this.ROWS_PER_BEAT,this._demoMode=!0,this.FOV=50,this._row=0,this.tickerPointer=document.getElementById("ticker_pointer")}init(t){this.sm=new n.SoundManager,this.sceneList=new Array,this.statsMEM=new h,this.statsMEM.showPanel(2),this.statsMEM.dom.style.cssText=`position:absolute;top:0px;left:${2*t.width}px;`,document.body.appendChild(this.statsMEM.dom),this.statsFPS=new h,this.statsFPS.showPanel(0),this.statsFPS.dom.style.cssText=`position:absolute;top:50px;left:${2*t.width}px;`,document.body.appendChild(this.statsFPS.dom);const e=document.getElementById("ticker"),r=document.getElementById("ticker_play"),l=document.getElementById("ticker_pause");document.getElementById("loading");return r.addEventListener("click",()=>{this.onPlay()}),l.addEventListener("click",()=>{this.onPause()}),e.addEventListener("click",t=>{const i=t.offsetX*this.sm._audio.duration/e.getBoundingClientRect().width;this.sm._audio.currentTime=i,this._demoMode||this.sm._syncDevice.update(this.sm._audio.currentTime*this.ROW_RATE)}),this.BlockFade=new a.BlockFade,this.allProgress([this.sm.loadOgg(i(226).default),o.TextureUtils.load(i(50),!0).then(t=>this.bmpFont=t),this.prepareSync(),this.BlockFade.init(t),Promise.resolve().then(()=>i(138)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(123)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(55)).then(e=>this.initScene(t,e,8,i(139))),Promise.resolve().then(()=>i(140)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(141)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(143)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(144)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(125)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(132)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(137)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(136)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(146)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(147)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(148)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(149)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(152)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(153)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(155)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(157)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(165)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(166)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(167)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(168)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(171)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(172)).then(e=>{this.initScene(t,e)}),Promise.resolve().then(()=>i(174)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(176)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(177)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(178)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(179)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(182)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(183)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(112)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(184)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(185)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(186)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(188)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(190)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(191)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(192)).then(e=>{this.initScene(t,e)}),Promise.resolve().then(()=>i(193)).then(e=>this.initScene(t,e)),Promise.resolve().then(()=>i(196)).then(e=>this.initScene(t,e))],e=>{const i=Math.ceil(t.width*e);t.drawRect2(0,t.height/2-5,i,10,s.Color.WHITE.toPackedFormat()),document.getElementById("aisa-canvas").getContext("2d").putImageData(t.getImageData(),0,0),this.statsMEM.update()})}onInit(){}allProgress(t,e){let i=0;for(const r of t)r.then(()=>{i++,e(i/t.length)});return Promise.all(t)}initScene(t,e,...i){const r=Object.keys(e)[0];return this.sceneList.push(new e[r](...i)),this.sceneList[this.sceneList.length-1].init(t)}render(t){this.updateMusic(t);const e=Number(this._currentEffect-1);if(Number.isInteger(e))this.sceneList[Math.trunc(e)].render(t,this.timeMilliseconds);else{const i=Math.trunc(e<1?0:e),r=Math.trunc(e+1),o=Math.round(10*(this._currentEffect-parseInt(this._currentEffect.toString(),10)));this.BlockFade.transition(t,this.sceneList[i],this.sceneList[r],o,this._transition.getValue(this._row),this.timeMilliseconds)}this.drawStats(t)}updateMusic(t){this.sm._syncDevice.connected||this._demoMode?(this.timeSeconds=this.sm._audio.currentTime,this.timeMilliseconds=1e3*this.timeSeconds,this._row=this.timeSeconds*this.ROW_RATE,this._currentEffect=this._effect.getValue(this._row).toFixed(1),!1===this.sm._audio.paused&&this.sm._syncDevice.update(this._row),this.tickerPointer.style.left=100*this.timeSeconds/this.sm._audio.duration+"%"):t.drawText(8,18,"Rocket not connected".toUpperCase(),this.bmpFont)}drawStats(t){t.drawText(8,18,"TIME: "+this.timeSeconds.toFixed(2),this.bmpFont),t.drawText(8,36,"ROTATION: "+this._cameraRotation.getValue(this._row).toFixed(0),this.bmpFont),t.drawText(8,54,"EFFECT: "+this._currentEffect,this.bmpFont),this.statsFPS.update(),this.statsMEM.update()}prepareSync(){return new Promise(t=>{this._demoMode?(this.sm._syncDevice.setConfig({rocketXML:i(227).default}),this.sm._syncDevice.init("demo")):this.sm._syncDevice.init(),this.sm._syncDevice.on("ready",()=>this.onSyncReady()),this.sm._syncDevice.on("update",t=>this.onSyncUpdate(t)),this.sm._syncDevice.on("play",()=>this.onPlay()),this.sm._syncDevice.on("pause",()=>this.onPause()),t()})}onSyncReady(){this.sm._syncDevice.connected=!0,this._effect=this.sm._syncDevice.getTrack("effect"),this._snare=this.sm._syncDevice.getTrack("snare"),this._bass=this.sm._syncDevice.getTrack("bass"),this._cameraRotation=this.sm._syncDevice.getTrack("rotation"),this._cameraDistance=this.sm._syncDevice.getTrack("distance"),this._fov=this.sm._syncDevice.getTrack("FOV"),this._transition=this.sm._syncDevice.getTrack("transition")}onSyncUpdate(t){isNaN(t)||(this._row=t),this.sm._audio.currentTime=t/this.ROW_RATE}onPlay(){this.sm._audio.currentTime=this._row/this.ROW_RATE,this.sm._audio.play(),console.log("[onPlay] time in seconds",this.sm._audio.currentTime)}onPause(){console.info("[onPause]"),this._row=this.sm._audio.currentTime*this.ROW_RATE,this.sm._audio.pause()}}e.DemoScene=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SoundManager=void 0,i(222),i(223),i(224);e.SoundManager=class{constructor(){this._syncDevice=new JSRocket.SyncDevice,this._audio=new Audio,this._syncDevice=new JSRocket.SyncDevice,this._syncDevice.connected=!1}playExtendedModule(t){return fetch(t).then(t=>t.arrayBuffer()).then(e=>{e?(XMPlayer.load(e),XMPlayer.play()):console.log("unable to load",t)})}initXM(){XMPlayer.init(),this.audioContext=XMPlayer.audioctx}playOgg(t){return fetch(t).then(t=>t.arrayBuffer()).then(e=>{e?this.audioContext.decodeAudioData(e,t=>{const e=this.audioContext.createBufferSource();console.info("ogg create buffer"),e.buffer=t,e.connect(this.audioContext.destination),console.info("ogg connect"),e.loop=!0,e.start(this.audioContext.currentTime),console.info("ogg ready")}):console.log("unable to load",t)})}loadOgg(t){return fetch(t).then(e=>{this._audio.src=t,this._audio.load(),this._audio.preload="true",this._audio.loop=!0,this._audio.autoplay=!1})}}},function(t,e){!function(t){t.XMPlayer||(t.XMPlayer={});var e=t.XMPlayer;t.XMView||(t.XMView={});var i=t.XMView;e.periodForNote=f,e.prettify_effect=h,e.init=v,e.load=function(t){var i=new DataView(t);e.xm={},e.xm.songname=c(i,17,20);var r=i.getUint32(60,!0)+60,o=i.getUint16(64,!0);e.xm.song_looppos=i.getUint16(66,!0),e.xm.nchan=i.getUint16(68,!0);var n,s,h,l=i.getUint16(70,!0),u=i.getUint16(72,!0);for(e.xm.flags=i.getUint16(74,!0),e.xm.tempo=i.getUint16(76,!0),e.xm.bpm=i.getUint16(78,!0),e.xm.channelinfo=[],e.xm.global_volume=e.max_global_volume,n=0;n<e.xm.nchan;n++)e.xm.channelinfo.push({number:n,filterstate:new Float32Array(3),vol:0,pan:128,period:1152,vL:0,vR:0,vLprev:0,vRprev:0,mute:0,volE:0,panE:0,retrig:0,vibratopos:0,vibratodepth:1,vibratospeed:1,vibratotype:0});for(console.log("header len "+r),console.log("songlen %d, %d channels, %d patterns, %d instruments",o,e.xm.nchan,l,u),console.log("loop @%d",e.xm.song_looppos),console.log("flags=%d tempo %d bpm %d",e.xm.flags,e.xm.tempo,e.xm.bpm),e.xm.songpats=[],n=0;n<o;n++)e.xm.songpats.push(i.getUint8(80+n));console.log("song patterns: ",e.xm.songpats);var f=r;for(e.xm.patterns=[],n=0;n<l;n++){var d=[],p=(i.getUint32(f,!0),i.getUint16(f+5,!0)),x=i.getUint16(f+7,!0);for(console.log("pattern %d: %d bytes, %d rows",n,x,p),f+=9,s=0;x>0&&s<p;s++){for(row=[],h=0;h<e.xm.nchan;h++){var M=i.getUint8(f);f++;var w=-1,g=-1,v=-1,P=0,C=0;128&M?(1&M&&(w=i.getUint8(f)-1,f++),2&M&&(g=i.getUint8(f),f++),4&M&&(v=i.getUint8(f),f++),8&M&&(P=i.getUint8(f),f++),16&M&&(C=i.getUint8(f),f++)):(w=M-1,g=i.getUint8(f),f++,v=i.getUint8(f),f++,P=i.getUint8(f),f++,C=i.getUint8(f),f++);var T=[w,g,v,P,C];row.push(T)}d.push(row)}e.xm.patterns.push(d)}for(e.xm.instruments=[],n=0;n<u;n++){var S=i.getUint32(f,!0),I=c(i,f+4,22),_=i.getUint16(f+27,!0);g={name:I,number:n};if(_>0){var R=new Uint8Array(t,f+33,96),A=i.getUint8(f+225),z=i.getUint8(f+233),F=i.getUint8(f+227),j=i.getUint8(f+228),D=i.getUint8(f+229),V=i.getUint8(f+226),E=i.getUint8(f+234),O=i.getUint8(f+230),B=i.getUint8(f+231),L=i.getUint8(f+232),U=i.getUint16(f+239,!0),N=[];for(s=0;s<2*A;s++)N.push(i.getUint16(f+129+2*s,!0));var k=[];for(s=0;s<2*V;s++)k.push(i.getUint16(f+177+2*s,!0));var W=i.getUint32(f+29,!0);console.log("hdrsiz %d; instrument %s: '%s' %d samples, samphdrsiz %d",S,(n+1).toString(16),I,_,W),f+=S;var G=0,H=[];for(s=0;s<_;s++){var X=i.getUint32(f,!0),Y=i.getUint32(f+4,!0),K=i.getUint32(f+8,!0),Z=i.getUint8(f+12),q=i.getInt8(f+13),J=i.getUint8(f+14),Q=i.getUint8(f+15),$=i.getInt8(f+16),tt=c(i,f+18,22),et=G;0===K&&(J&=-4),console.log("sample %d: len %d name '%s' loop %d/%d vol %d offset %s",s,X,tt,Y,K,Z,et.toString(16)),console.log("           type %d note %s(%d) finetune %d pan %d",J,a($+48),$,q,Q),console.log("           vol env",N,F,j,D,"type",z,"fadeout",U),console.log("           pan env",k,O,B,L,"type",E);var it={len:X,loop:Y,looplen:K,note:$,fine:q,pan:Q,type:J,vol:Z,fileoffset:et};H.push(it),f+=W,G+=X}for(s=0;s<_;s++){(it=H[s]).sampledata=b(new Uint8Array(t,f+it.fileoffset,it.len),16&it.type),16&it.type&&(it.len/=2,it.loop/=2,it.looplen/=2),3&it.type&&(it.looplen<2048||2&it.type)&&y(it)}if(f+=G,g.samplemap=R,g.samples=H,z){var rt=N[N.length-2];if(2&z||(F=N.length/2),U>0){var ot=65536/U;N.push(rt+ot),N.push(0)}g.env_vol=new m(N,z,F,j,D)}else g.env_vol=new m([0,64,1,0],2,0,0,0);E?(2&E||(O=k.length/2),g.env_pan=new m(k,E,O,B,L)):g.env_pan=new m([0,32],0,0,0,0)}else f+=S,console.log("empty instrument",n,S,f);e.xm.instruments.push(g)}return console.log('loaded "'+e.xm.songname+'"'),!0},e.play=function(){if(!e.playing){i.resume&&i.resume(),r.connect(o);var t=e.audioctx.createOscillator();t.connect(e.audioctx.destination),t.start?t.start(0):t.noteOn(0),t.stop?t.stop(0):t.noteOff(0),t.disconnect()}e.playing=!0},e.pause=function(){e.playing&&(r.disconnect(o),i.pause&&i.pause());e.playing=!1},e.stop=function(){e.playing&&(r.disconnect(o),e.playing=!1);e.cur_pat=-1,e.cur_row=64,e.cur_songpos=-1,e.cur_ticksamp=0,e.xm.global_volume=e.max_global_volume,i.stop&&i.stop();v()},e.cur_songpos=-1,e.cur_pat=-1,e.cur_row=64,e.cur_ticksamp=0,e.cur_tick=6,e.xm={},e.xm.global_volume=e.max_global_volume=128,e.nextTick=x,e.nextRow=d,e.Envelope=m;var r,o,n=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],s=44100;function a(t){return t<0?"---":96==t?"^^^":n[t%12]+~~(t/12)}function h(t,e){return t>=10&&(t=String.fromCharCode(55+t)),t+(e=e<16?"0"+e.toString(16):e.toString(16))}function l(t){return a(t[0])+" "+((-1==(e=t[1])?"--":e<10?"0"+e:e)+" ")+function(t){return t<16?"--":t.toString(16)}(t[2])+" "+h(t[3],t[4]);var e}function c(t,e,i){for(var r=[],o=e;o<e+i;o++){var n=t.getUint8(o);if(0===n)break;r.push(String.fromCharCode(n))}return r.join("")}function u(t,e){var i=8363*Math.pow(2,(1152-e)/192);isNaN(i)?console.log("invalid period!",e):(t.doff=i/s,t.filter=function(t){t>.5&&(t=.5);var e=Math.sqrt(2)*Math.PI*t,i=Math.exp(-e),r=i*Math.cos(e);return[(1-2*r+i*i)/2,2*r,-i*i]}(t.doff/2))}function f(t,e){return 1920-16*(e+t.samp.note)-t.fine/8}function d(){void 0===e.next_row&&(e.next_row=e.cur_row+1),e.cur_row=e.next_row,e.next_row++,(-1==e.cur_pat||e.cur_row>=e.xm.patterns[e.cur_pat].length)&&(e.cur_row=0,e.next_row=1,e.cur_songpos++,e.cur_songpos>=e.xm.songpats.length&&(e.cur_songpos=e.xm.song_looppos),function(){for(var t=e.xm.songpats[e.cur_songpos];t>=e.xm.patterns.length;)e.cur_songpos+1<e.xm.songpats.length?e.cur_songpos++:e.cur_songpos===e.xm.song_looppos&&0!==e.cur_songpos||e.xm.song_looppos>=e.xm.songpats.length?e.cur_songpos=0:e.cur_songpos=e.xm.song_looppos,t=e.xm.songpats[e.cur_songpos];e.cur_pat=t}());for(var t=e.xm.patterns[e.cur_pat][e.cur_row],i=0;i<t.length;i++){var r=e.xm.channelinfo[i],o=r.inst,n=!1;if(-1!=t[i][1]&&(o=e.xm.instruments[t[i][1]-1])&&o.samplemap&&(r.inst=o,n=!0,r.note&&o.samplemap&&(r.samp=o.samples[o.samplemap[r.note]],r.vol=r.samp.vol,r.pan=r.samp.pan,r.fine=r.samp.fine)),-1!=t[i][0])if(96==t[i][0])r.release=1,n=!1;else if(o&&o.samplemap){var s=t[i][0];r.note=s,r.samp=o.samples[o.samplemap[r.note]],n&&(r.pan=r.samp.pan,r.vol=r.samp.vol,r.fine=r.samp.fine),n=!0}if(r.voleffectfn=void 0,-1!=t[i][2]){var a=t[i][2];r.voleffectdata=15&a,a<16?console.log("channel",i,"invalid volume",a.toString(16)):a<=80?r.vol=a-16:a>=96&&a<112?r.voleffectfn=function(t){t.vol=Math.max(0,t.vol-t.voleffectdata)}:a>=112&&a<128?r.voleffectfn=function(t){t.vol=Math.min(64,t.vol+t.voleffectdata)}:a>=128&&a<144?r.vol=Math.max(0,r.vol-(15&a)):a>=144&&a<160?r.vol=Math.min(64,r.vol+(15&a)):a>=160&&a<176?r.vibratospeed=15&a:a>=176&&a<192?(r.vibratodepth=15&a,r.voleffectfn=e.effects_t1[4],e.effects_t1[4](r)):a>=192&&a<208?r.pan=17*(15&a):a>=240&&a<=255?(15&a&&(r.portaspeed=(15&a)<<4),r.voleffectfn=e.effects_t1[3]):console.log("channel",i,"volume effect",a.toString(16))}if(r.effect=t[i][3],r.effectdata=t[i][4],r.effect<36){r.effectfn=e.effects_t1[r.effect];var h=e.effects_t0[r.effect];h&&h(r,r.effectdata)&&(n=!1)}else console.log("channel",i,"effect > 36",r.effect);(3==r.effect||5==r.effect||t[i][2]>=240)&&(-1!=t[i][0]&&(r.periodtarget=f(r,r.note)),n=!1,o&&o.samplemap&&(null==r.env_vol?n=!0:r.release&&(r.envtick=0,r.release=0,r.env_vol=new p(o.env_vol),r.env_pan=new p(o.env_pan)))),n&&(9!=r.effect&&(r.off=0),r.release=0,r.envtick=0,r.env_vol=new p(o.env_vol),r.env_pan=new p(o.env_pan),r.note&&(r.period=f(r,r.note)),r.vibratotype<4&&(r.vibratopos=0))}}function m(t,e,i,r,o){this.points=t,this.type=e,this.sustain=i,this.loopstart=t[2*r],this.loopend=t[2*o]}function p(t){this.env=t,this.tick=0}function x(){var t,i;for(e.cur_tick++,t=0;t<e.xm.nchan;t++)(i=e.xm.channelinfo[t]).periodoffset=0;for(e.cur_tick>=e.xm.tempo&&(e.cur_tick=0,d()),t=0;t<e.xm.nchan;t++){var r=(i=e.xm.channelinfo[t]).inst;0!==e.cur_tick&&(i.voleffectfn&&i.voleffectfn(i),i.effectfn&&i.effectfn(i)),isNaN(i.period)&&console.log(l(e.xm.patterns[e.cur_pat][e.cur_row][t]),"set channel",t,"period to NaN"),void 0!==r&&(void 0!==i.env_vol?(i.volE=i.env_vol.Tick(i.release),i.panE=i.env_pan.Tick(i.release),u(i,i.period+i.periodoffset)):console.log(l(e.xm.patterns[e.cur_pat][e.cur_row][t]),"set channel",t,"env_vol to undefined, but note is playing"))}}function M(t,e,i,r,o){var n=t.filterstate[1];if(isNaN(n))console.log("NaN filterstate?",t.filterstate,t.filter);else{for(var s=e;s<i;s++){if(Math.abs(n)<1526e-8){n=0;break}r[s]+=n*t.vL,o[s]+=n*t.vR,n*=.9837}if(t.filterstate[1]=n,t.filterstate[2]=n,!isNaN(n))return 0;console.log("NaN filterstate after adding silence?",t.filterstate,t.filter,s)}}function w(t,i,r,o,n){var s=t.inst,a=t.samp,h=!1,l=0,c=0;if(null==a||null==s||t.mute)return M(t,i,r,o,n);var u=a.sampledata,f=a.len;1==(3&a.type)&&a.looplen>0&&(h=!0,f=(c=a.loop)+(l=a.looplen));a.len;var d=t.volE/64,m=4*(t.panE-32),p=m+t.pan-128,x=e.xm.global_volume*d*(128-p)*t.vol/1048576,w=e.xm.global_volume*d*(128+p)*t.vol/1048576;if(x<0&&(x=0),w<0&&(w=0),0!==w||0!==x){if(!isNaN(w)&&!isNaN(x)){var g=t.off,b=t.doff,y=0,v=t.filter[0],P=t.filter[1],C=t.filter[2],T=t.filterstate[0],S=t.filterstate[1],I=t.filterstate[2],_=.9837*t.vL+(1-.9837)*(x+t.vLprev)*.5,R=.9837*t.vR+(1-.9837)*(w+t.vRprev)*.5,A=Math.pow(.9837,8);t.vLprev=x,t.vRprev=w;for(var z=i,F=100;z<r;){if(0==F--){console.log("failsafe in mixing loop! channel",t.number,g,f,c,l,b);break}if(g>=f){if(!h)return t.inst=void 0,y+M(t,z,r,o,n);g=c+(g-c)%l}for(var j,D,V=Math.max(1,Math.min(r,z+(f-g)/b));z+7<V;z+=8)D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z]+=_*D,n[z]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+1]+=_*D,n[z+1]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+2]+=_*D,n[z+2]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+3]+=_*D,n[z+3]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+4]+=_*D,n[z+4]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+5]+=_*D,n[z+5]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+6]+=_*D,n[z+6]+=R*D,y+=(_+R)*D*D,D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,g+=b,o[z+7]+=_*D,n[z+7]+=R*D,y+=(_+R)*D*D,_=A*_+(1-A)*x,R=A*R+(1-A)*w;for(;z<V;z++)D=v*((j=u[0|g])+T)+P*S+C*I,I=S,S=D,T=j,o[z]+=_*D,n[z]+=R*D,y+=(_+R)*D*D,g+=b}return t.off=g,t.filterstate[0]=T,t.filterstate[1]=S,t.filterstate[2]=I,t.vL=_,t.vR=R,.5*y}console.log("NaN volume!?",t.number,x,w,d,m,t.vol)}}function g(t){s=e.audioctx.sampleRate;var r,o,n,a=t.outputBuffer.length,h=t.outputBuffer.getChannelData(0),l=t.outputBuffer.getChannelData(1);for(r=0;r<a;r++)h[r]=0,l[r]=0;for(var c=0,u=0|2.5*s/e.xm.bpm,f=i.scope_width;a>0;){(-1==e.cur_pat||e.cur_ticksamp>=u)&&(x(),e.cur_ticksamp-=u);var d=Math.min(a,u-e.cur_ticksamp),m=new Float32Array(e.xm.nchan),p=void 0;for(o=0;o<e.xm.nchan;o++){var M;if(d>=4*f)for(M=new Float32Array(f),n=0;n<f;n++)M[n]=-h[c+4*n]-l[c+4*n];if(m[o]=w(e.xm.channelinfo[o],c,c+d,h,l)/d,d>=4*f){for(n=0;n<f;n++)M[n]+=h[c+4*n]+l[c+4*n];void 0===p&&(p=[]),p.push(M)}}i.pushEvent&&i.pushEvent({t:t.playbackTime+(0+c)/s,vu:m,scopes:p,songpos:e.cur_songpos,pat:e.cur_pat,row:e.cur_row}),c+=d,e.cur_ticksamp+=d,a-=d}}function b(t,e){var i,r,o,n=t.length,s=0;if(0===e){for(i=new Float32Array(n),o=0;o<n;o++)128&(r=255&(s+=t[o]))&&(r-=256),i[o]=r/128;return i}for(n/=2,i=new Float32Array(n),o=0;o<n;o++)32768&(r=t[2*o]+(t[2*o+1]<<8))&&(r-=65536),s=Math.max(-1,Math.min(1,s+r/32768)),i[o]=s;return i}function y(t){var e=(2048+t.looplen-1)/t.looplen|0,i=2&t.type;i&&(e=e+1&-2);for(var r=t.loop+e*t.looplen,o=new Float32Array(r),n=0;n<t.loop;n++)o[n]=t.sampledata[n];for(var s=0;s<e;s++){var a;if(1&s&&i)for(a=t.looplen-1;a>=0;a--)o[n++]=t.sampledata[t.loop+a];else for(a=0;a<t.looplen;a++)o[n++]=t.sampledata[t.loop+a]}console.log("unrolled sample loop; looplen",t.looplen,"x",e," = ",r),t.sampledata=o,t.looplen=e*t.looplen,t.type=1}function v(){if(!e.audioctx){var i=t.AudioContext||t.webkitAudioContext;e.audioctx=new i,(o=e.audioctx.createGain()).gain.value=.1}(r=void 0===e.audioctx.createScriptProcessor?e.audioctx.createJavaScriptNode(16384,0,2):e.audioctx.createScriptProcessor(16384,0,2)).onaudioprocess=g,o.connect(e.audioctx.destination)}m.prototype.Get=function(t){for(var e,i=this.points,r=0;r<i.length;r+=2)if(e=i[r+1],t<i[r]){var o=i[r-2];e=i[r-1];var n=i[r]-o;return e+(t-o)*(i[r+1]-e)/n}return e},p.prototype.Tick=function(t){var e=this.env.Get(this.tick);return!t&&this.tick>=this.env.points[2*this.env.sustain]?this.env.points[2*this.env.sustain+1]:(this.tick++,4&this.env.type&&!t&&this.tick>=this.env.loopend&&(this.tick-=this.env.loopend-this.env.loopstart),e)},e.playing=!1}(window)},function(t,e){!function(t){t.XMPlayer||(t.XMPlayer={});var e=t.XMPlayer;function i(t){if(0!==t.effectdata&&void 0!==t.inst){var i=[0,t.effectdata>>4,15&t.effectdata],r=t.note+i[e.cur_tick%3];t.period=e.periodForNote(t,r)}}function r(t){void 0!==t.periodtarget&&void 0!==t.portaspeed&&(t.period>t.periodtarget?t.period=Math.max(t.periodtarget,t.period-t.portaspeed):t.period=Math.min(t.periodtarget,t.period+t.portaspeed))}function o(t){t.periodoffset=function(t,e){var i=0;switch(3&t){case 1:i=(1+2*e/64)%2-1;break;case 2:case 3:i=e<32?1:-1;break;case 0:default:i=Math.sin(e*Math.PI/32)}return i}(t.vibratotype,t.vibratopos)*t.vibratodepth,isNaN(t.periodoffset)&&(console.log("vibrato periodoffset NaN?",t.vibratopos,t.vibratospeed,t.vibratodepth),t.periodoffset=0),e.cur_tick>0&&(t.vibratopos+=t.vibratospeed,t.vibratopos&=63)}function n(t,e){e&&(t.volumeslide=(e>>4)-(15&e))}function s(t){void 0!==t.volumeslide&&(t.vol=Math.max(0,Math.min(64,t.vol+t.volumeslide)))}function a(){}function h(t,i){console.log("unimplemented effect",e.prettify_effect(t.effect,i))}e.effects_t0=[i,function(t,e){0!==e&&(t.slideupspeed=e)},function(t,e){0!==e&&(t.slidedownspeed=e)},function(t,e){0!==e&&(t.portaspeed=e)},function(t,e){15&e&&(t.vibratodepth=2*(15&e)),e>>4&&(t.vibratospeed=e>>4),o(t)},n,n,h,function(t,e){t.pan=e},function(t,e){t.off=256*e},n,function(t,i){i<e.xm.songpats.length&&(e.cur_songpos=i-1,e.cur_pat=-1,e.cur_row=-1)},function(t,e){t.vol=Math.min(64,e)},function(t,i){e.cur_songpos++,e.cur_songpos>=e.xm.songpats.length&&(e.cur_songpos=e.xm.song_looppos),e.cur_pat=e.xm.songpats[e.cur_songpos],e.next_row=10*(i>>4)+(15&i)},function(t,i){var r=i>>4;switch(i&=15,r){case 1:t.period-=i;break;case 2:t.period+=i;break;case 4:t.vibratotype=7&i;break;case 5:t.fine=(i<<4)+i-128;break;case 6:0==i?t.loopstart=e.cur_row:(void 0===t.loopend&&(t.loopend=e.cur_row,t.loopremaining=i),0!==t.loopremaining?(t.loopremaining--,e.next_row=t.loopstart||0):(delete t.loopend,delete t.loopstart));break;case 8:t.pan=17*i;break;case 10:0===i&&void 0!==t.finevolup&&(i=t.finevolup),t.vol=Math.min(64,t.vol+i),t.finevolup=i;break;case 11:0===i&&void 0!==t.finevoldown&&(i=t.finevoldown),t.vol=Math.max(0,t.vol-i),t.finevoldown=i;break;case 12:break;default:console.log("unimplemented extended effect E",t.effectdata.toString(16))}},function(t,i){0!==i?i<32?e.xm.tempo=i:e.xm.bpm=i:console.log("tempo 0?")},function(t,i){e.xm.global_volume=i<=64?Math.max(0,2*i):e.max_global_volume},function(t,i){i&&(e.xm.global_volumeslide=2*((i>>4)-(15&i)))},h,h,h,h,h,h,h,h,h,function(t,e){switch(15&e&&(t.retrig=(240&t.retrig)+(15&e)),240&e&&(t.retrig=(15&t.retrig)+(240&e)),t.retrig>>4){case 1:t.vol-=1;break;case 2:t.vol-=2;break;case 3:t.vol-=4;break;case 4:t.vol-=8;break;case 5:t.vol-=16;break;case 6:t.vol*=2,t.vol/=3;break;case 7:t.vol/=2;break;case 9:t.vol+=1;break;case 10:t.vol+=2;break;case 11:t.vol+=4;break;case 12:t.vol+=8;break;case 13:t.vol+=16;break;case 14:t.vol*=3,t.vol/=2;break;case 15:t.vol*=2}t.vol=Math.min(64,Math.max(0,t.vol))},h,h,h,h,h,h,h,h],e.effects_t1=[i,function(t){void 0!==t.slideupspeed&&(t.period-=t.slideupspeed)},function(t){void 0!==t.slidedownspeed&&(t.period=Math.min(1728,t.period+t.slidedownspeed))},r,o,function(t){s(t),r(t)},function(t){s(t),o(t)},a,null,null,s,null,null,null,function(t){switch(t.effectdata>>4){case 12:e.cur_tick==(15&t.effectdata)&&(t.vol=0)}},null,null,function(t){void 0!==e.xm.global_volumeslide&&(e.xm.global_volume=Math.max(0,Math.min(e.max_global_volume,e.xm.global_volume+e.xm.global_volumeslide)))},a,a,a,a,a,a,a,a,a,function(t){e.cur_tick%(15&t.retrig)==0&&(t.off=0)},a,a,a,a,a,a,a,a]}(window)},function(t,e){!function(t){t.JSRocket||(t.JSRocket={}),JSRocket.SyncData=function(){"use strict";var t=[];return{getTrack:function(e){return t[e]},getIndexForName:function(e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return-1},getTrackLength:function(){return t.length},createIndex:function(e){var i=new JSRocket.Track;i.name=e,t.push(i)}}},JSRocket.Track=function(){"use strict";var t=[];return{getValue:function(e){var i=Object.keys(t);if(!i.length)return 0;var r=function(t,e){for(var i=0,r=t.length;i<r;){var o=(r+i)/2|0;if(t[o]<e)i=o+1;else{if(!(t[o]>e))return o;r=o}}return i-1}(i,Math.floor(e));if(r<0)return t[i[0]].value;if(r>i.length-2)return t[i[i.length-1]].value;var o=i[r],n=i[r+1],s=t[o].value,a=t[n].value,h=(e-o)/(n-o);switch(t[o].interpolation){case 0:return s;case 1:return s+(a-s)*h;case 2:return s+(a-s)*h*h*(3-2*h);case 3:return s+(a-s)*Math.pow(h,2)}},add:function(e,i,r){t[e]={value:i,interpolation:r}},remove:function(e){delete t[e]}}},JSRocket.SyncDevicePlayer=function(t){"use strict";var e,i=new JSRocket.SyncData,r={ready:function(){},error:function(){}};function o(t){null!==(e=new XMLHttpRequest)?(e.open("GET",t,!0),e.onreadystatechange=n,e.send()):r.error()}function n(){4===e.readyState&&(e.status<300?function(t){var e,i,o,n=0,a=0,h=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tracks")[0].getElementsByTagName("track");for(i=h.length;n<i;n++){var l=s(h[n].getAttribute("name")),c=h[n].getElementsByTagName("key");for(a=0,o=c.length;a<o;a++)e=c[a],l.add(parseInt(e.getAttribute("row"),10),parseFloat(e.getAttribute("value")),parseInt(e.getAttribute("interpolation"),10))}r.ready()}(e.responseText):r.error())}function s(t){var e=i.getIndexForName(t);return e>-1?i.getTrack(e):(i.createIndex(t),i.getTrack(i.getTrackLength()-1))}if(""===t.rocketXML||void 0===t.rocketXML||void 0===t.rocketXML)throw"[jsRocket] rocketXML is not set, try _syncDevice.setConfig({'rocketXML':'url/To/RocketXML.rocket'})";return o(t.rocketXML),{load:o,getTrack:s,update:function(){},on:function(t,e){r[t]=e}}},JSRocket.SyncDeviceClient=function(t){"use strict";var e=new WebSocket(t.socketURL),i=new JSRocket.SyncData,r={ready:function(){},update:function(){},play:function(){},pause:function(){},save:function(){}};function o(t){for(var e=0,i=new DataView(new ArrayBuffer(t.length));e<t.length;e++)i.setUint8(e,t[e]);return 1===i.byteLength?i.getInt8(0):i.getInt32(0)}return e.onopen=function(){e.binaryType="arraybuffer",e.send("hello, synctracker!")},e.onmessage=function(t){var e,n,s,a,h,l,c=new Uint8Array(t.data),u=c[0];104===u?r.ready():4===u?1===c[1]?r.pause():r.play():3===u?(n=o(c.subarray(1,5)),r.update(n)):0===u?(e=o(c.subarray(1,5)),n=o(c.subarray(5,9)),h=c.subarray(9,13),(l=new DataView(new ArrayBuffer(4))).setUint8(0,h[0]),l.setUint8(1,h[1]),l.setUint8(2,h[2]),l.setUint8(3,h[3]),s=l.getFloat32(0),a=o(c.subarray(13,14)),i.getTrack(e).add(n,s,a)):1===u?(e=o(c.subarray(1,5)),n=o(c.subarray(5,9)),i.getTrack(e).remove(n)):5===u&&r.save()},e.onclose=function(t){console.warn(">> connection closed",t)},e.onerror=function(t){console.error(">> connection error'd",t)},{getTrack:function(t){var r=i.getIndexForName(t);if(r>-1)return i.getTrack(r);for(var o=encodeURIComponent(t).replace(/%([\dA-F]{2})/g,(function(t,e){return String.fromCharCode("0x"+e)})),n=[2,o.length>>24&255,o.length>>16&255,o.length>>8&255,255&o.length],s=0;s<o.length;s++)n.push(o.charCodeAt(s));return e.send(new Uint8Array(n).buffer),i.createIndex(t),i.getTrack(i.getTrackLength()-1)},update:function(t){var i=[t>>24&255,t>>16&255,t>>8&255,255&t];e.send(new Uint8Array([3,i[0],i[1],i[2],i[3]]).buffer)},on:function(t,e){r[t]=e}}},JSRocket.SyncDevice=function(){"use strict";var t,e,i=!1,r={socketURL:"ws://localhost:1339",rocketXML:""},o={ready:function(){},update:function(){},play:function(){},pause:function(){}};function n(){i=!0,o.ready()}function s(t){o.update(t)}function a(){o.play()}function h(){o.pause()}return{init:function(e){(t="demo"===e?new JSRocket.SyncDevicePlayer(r):new JSRocket.SyncDeviceClient(r)).on("ready",n),t.on("update",s),t.on("play",a),t.on("pause",h)},setConfig:function(t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r},getConfig:function(){return r},getTrack:function(e){return i?t.getTrack(e):null},update:function(i){Math.floor(i)!==e&&(e=Math.floor(i),t.update(e))},on:function(t,e){o[t]=e}}}}(window)},function(t,e,i){var r;t.exports=((r=function(){function t(t){return o.appendChild(t.dom),t}function e(t){for(var e=0;e<o.children.length;e++)o.children[e].style.display=e===t?"block":"none";i=t}var i=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",(function(t){t.preventDefault(),e(++i%o.children.length)}),!1);var n=(performance||Date).now(),s=n,a=0,h=t(new r.Panel("FPS","#0ff","#002")),l=t(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new r.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:o,addPanel:t,showPanel:e,begin:function(){n=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-n,200),t>s+1e3&&(h.update(1e3*a/(t-s),100),s=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:o,setMode:e}}).Panel=function(t,e,i){var r=1/0,o=0,n=Math.round,s=n(window.devicePixelRatio||1),a=80*s,h=48*s,l=3*s,c=2*s,u=3*s,f=15*s,d=74*s,m=30*s,p=document.createElement("canvas");p.width=a,p.height=h,p.style.cssText="width:80px;height:48px";var x=p.getContext("2d");return x.font="bold "+9*s+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=i,x.fillRect(0,0,a,h),x.fillStyle=e,x.fillText(t,l,c),x.fillRect(u,f,d,m),x.fillStyle=i,x.globalAlpha=.9,x.fillRect(u,f,d,m),{dom:p,update:function(h,M){r=Math.min(r,h),o=Math.max(o,h),x.fillStyle=i,x.globalAlpha=1,x.fillRect(0,0,a,f),x.fillStyle=e,x.fillText(n(h)+" "+t+" ("+n(r)+"-"+n(o)+")",l,c),x.drawImage(p,u+s,f,d-s,m,u,f,d-s,m),x.fillRect(u+d-s,f,s,m),x.fillStyle=i,x.globalAlpha=.9,x.fillRect(u+d-s,f,s,n((1-h/M)*m))}}},r)},function(t,e,i){"use strict";i.r(e),e.default=i.p+"772facb88c077a564e1c3093e23840dc.ogg"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"d815de31d7d0ad0102af8e7ccbdb018c.rocket"}]);